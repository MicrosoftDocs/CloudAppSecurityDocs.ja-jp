---
title: "Cloud App Security プロキシの操作 | Microsoft Docs"
description: "このトピックでは、Cloud App Security プロキシのしくみに関する情報を提供します。"
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 7/31/2017
ms.topic: article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: 28317b70-1851-4610-b1d6-863bc5994bb6
ms.reviewer: reutam
ms.suite: ems
ms.openlocfilehash: 82e1ee0b5161dce88db815dc8eea06340bdbc532
ms.sourcegitcommit: f9851779aa15b11f559e56ac818f1333f027c000
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2017
---
# <a name="working-with-the-cloud-app-security-proxy"></a>Cloud App Security プロキシの操作

現在のワークプレースでは、多くの場合、クラウド環境で起こっていることを後で知るようでは十分ではありません。従業員が意図的に、または誤ってデータと組織を危険にさらす前に、リアルタイムで違反やリークを防げるようにする必要があります。 組織内のユーザーが、クラウド アプリのほとんどのサービスとツールを利用できるようにし、個人所有デバイスで作業できるようにする必要があります。 同時に、データ リーク、ランサムウェア攻撃および大量のデータ盗難から組織を保護するのに役立つツールが必要です。 

## <a name="introducing-the-cloud-app-security-proxy"></a>Cloud App Security プロキシの概要
Cloud App Security のプロキシでは、クラウド環境へのアクセスおよびクラウド環境内で実行されるアクティビティのリアルタイムの監視と制御を実行するのに必要なツールが提供されます。
Cloud App Security プロキシでは、次のようにして組織を保護することができます。
- データのダウンロードをブロックして、事前にデータ リークを防ぐ
- パスワードが保護されていないか、ウイルス対策ソフトウェアがインストールされていない可能性のある非管理対象デバイスからのネットワークへのアクセスを管理してブロックすることで、ランサムウェアへの露出を最小化する
- 暗号化によって保護されるように、クラウドでのデータの格納とクラウドからのデータのダウンロードを強制するルールを設定する
- 非管理対象デバイスでの実行内容を監視できるように、保護されていないエンドポイントを把握する
- 危険な IP アドレスと従来の ID プロバイダーからのアクセスを制御する

これらの固有の機能を有効にするには、プロキシで提供されるアクセス制御とセッション制御という 2 つのレベルの制御を使用します。 両方のタイプの制御では、ユーザー情報、場所情報、およびデバイス情報 (管理対象デバイスと非管理対象デバイスを識別する場合に使用) を利用して、各アプリのポリシーを決定します。

### <a name="access-control"></a>アクセス制御
<more information about what is access control including examples> プロキシのアクセス制御では、クラウド アプリの強力なアクセス ポリシーを作成でき、以下の機能が提供されます。

Cloud App Security でアクセス制御を使用するには、既存の ID プロバイダー構成をいくつか変更してプロキシを展開し、クラウド アプリを制御するためのポリシーを設定します。 

> [!NOTE]
> -  ID プロバイダーの既存のポリシーを変更する必要はありません。

#### <a name="supported-apps-and-identity-providers"></a>サポートされているアプリと ID プロバイダー

プロキシのアクセス制御は、SAML または WS-Federation プロトコルをサポートするすべての ID プロバイダーとアプリをサポートするように設計されています。 Cloud App Security チームは、アクセス制御機能を使用して、大手の ID プロバイダーと最先端アプリをテストしています。 ただし、ID プロバイダーとクラウド アプリは多数存在するため、ID プロバイダーとアプリのすべての組み合わせがテストされるわけではありません。 運用環境で展開する前に、サンドボックスまたはテスト環境で ID プロバイダーとアプリを使用してシングル サインオン プロセスをテストすることをお勧めします。

### <a name="session-control"></a>セッション制御

セッション制御は、プロキシで提供される追加の制御レイヤーです。 クラウド アプリケーションをより細かく、リアルタイムに制御することができます。 特定のアプリへのアクセスを許可またはブロックするための一括ポリシーを設定する代わりに、アクセスを許可してから、アプリでの各ユーザー セッションを監視している間に、さまざまな方法でアクセスを制限できます。 たとえば、特定のデバイスから、または特定の場所からのセッションについて、ユーザーにアプリケーションへのアクセスを許可するが、機密性の高いファイルのダウンロードは制限することを決定できます。

#### <a name="supported-apps-and-flows"></a>サポートされているアプリとフロー

現時点では、セッション制御で Salesforce.com のレポートのエクスポートとファイルのダウンロードをブロックできます。 ユーザー、場所、デバイス、およびダウンロードするコンテンツに基づいて、ポリシーを作成することができます。

さらに、このバージョンでは、ブラウザーからのユーザー ログインに対する制限されたセッションがサポートされます。 たとえば、ネイティブ アプリからのセッションでのアクセスを制限する場合、フィルターの**ユーザー エージェント タグ**が**ネイティブ クライアント**と等しい場合にアクセスをブロックするアクセス ポリシーを定義する必要があります。

Salesforce はすべての標準フローでテストされます。 ただし、Salesforce にはサード パーティ製アプリが多数あるため、その一部はテストされておらず、セッション制御で機能しない可能性があり、また、一部のページが動作しなくなる場合もあります。 これが実際にサード パーティ製アプリの問題であることを確認するには、サード パーティ製アプリをすべて削除し、セッション制御でアプリをテストします。 すべて正常に動作する場合は、問題のあるアプリが見つかるまでサード パーティ製アプリを 1 つずつ追加します。 

## <a name="device-management"></a>デバイス管理

Cloud App Security を使用すれば、デバイスの状況に基づいて、プロキシ ポリシーを特定し、作成することができます。 デバイスが管理されているかどうかを特定するために、Cloud App Security ではクライアント証明書メカニズムを利用します。このメカニズムでは、クライアント証明書は組織の管理対象デバイスに展開されます。 ユーザーは、アプリにログインすると、自分のデバイスにインストールされているクライアント証明書を提供するように要求されます。 クライアント証明書が提供されている場合、Cloud App Security はデバイスを管理対象と見なします。 
> [!NOTE]
>  ユーザーがクライアント証明書の送信を拒否する場合があります。その場合、デバイスは非管理対象と見なされます。
<了解、これで管理されているかどうかがわかりますが、それでどうするのですか?>

### <a name="supported-browsers-and-native-apps"></a>サポートされているブラウザーとネイティブ アプリ

Cloud App Security プロキシでは、 クライアント証明書に基づいて...を行うことができます。

クライアント証明書は、ブラウザー開発者とネイティブ アプリケーション開発者が実装するかどうかを決定できる既知のメカニズムです。 ほとんどのプラットフォーム上のほとんどのブラウザーでサポートされていますが、ネイティブ アプリの場合はより複雑です。

デスクトップ アプリとモバイル アプリの両方を含む、ネイティブ アプリのクライアント証明書のサポートは、プラットフォームやデバイスの状態によっても異なる場合があります。 たとえば、Salesforce1 (Salesforce モバイル アプリ) では、クライアント証明書が機能するのは、デバイスに MDM が展開されており、Salesforce1 がクライアント証明書を送信するように構成されている場合のみです。

クライアント証明書は、最新バージョンの Windows、OSX、Android、および iOS 上の Internet Explorer、Edge、Chrome、Safari、および Firefox では正常にテストされました (それぞれ関連ブラウザーを使用)。

> [!NOTE]
> iOS では、クライアント証明書が機能するのは Safari ブラウザーのみです。

ブラウザーまたはネイティブ アプリでクライアント証明書がサポートされる場合でも、ユーザーが証明書を提供する際に問題が発生することがあります。たとえば、ユーザーが一度クライアント証明書の送信を拒否した場合、ブラウザーまたはネイティブ アプリがその選択内容を記憶している可能性があり、ユーザーに再度証明書が要求されなくなります。 このような問題を解決するには、ブラウザーの開いたインスタンスをすべて閉じてから、新しいインスタンスを開くか、Cookie をすべてクリアしてから再試行することをお勧めします。

一方、クライアント証明書を要求し、代わりに自動送信するポップアップを抑制するオプションをサポートするブラウザーとネイティブ アプリもあります。

一般に、ポリシーを適用せず、監視モードでのみユーザーからのクライアント証明書要求をテストすることをお勧めします。 この操作は、管理対象デバイスを特定するための**ログのみ**のポリシーを作成して行うことができます。

## <a name="architecture"></a>アーキテクチャ

プロキシは ID プロバイダーとアプリの両方に統合されるため、プロキシにログイン要求をリダイレクトするように両方を構成する必要があります。

さらに、管理対象デバイスを特定するために、プロキシは管理対象デバイスからのクライアント証明書を要求できます。 クライアント証明書がプロキシで受信されると、デバイスは管理対象と見なされ、管理対象デバイスと非管理対象デバイスのポリシーが有効になります。

展開プロセスの詳細については、展開に関するセクションを参照してください。

![Cloud App Security プロキシのアーキテクチャ](./media/proxy-architecture.png)

## <a name="user-login-flow"></a>ユーザー ログイン フロー

上記の図は、ID プロバイダーから開始されるログイン (*ID プロバイダー開始によるログイン*とも呼ばれる) を説明したものです。 ユーザーがアプリから開始した場合 (*サービス プロバイダー開始によるログイン*と呼ばれる)、Cloud App Security プロキシに移動し、そこから ID プロバイダーに移動します。ログイン プロセスの残りの部分は *ID プロバイダー開始によるログイン* フローと同様です。

以下は、*ID プロバイダー開始によるログイン* フローです。
-   ユーザーは ID プロバイダーに要求を送信し、資格情報を提供します。

-   アクセスが許可された場合、ID プロバイダーはユーザーを Cloud App Security プロキシにリダイレクトします。

-   ユーザーがクライアント証明書をインストールしており、管理対象デバイスまたは非管理対象デバイスを確認する関連ポリシーが存在する場合、クライアント証明書の提供を求めるメッセージが表示されます。 いずれの場合も、アクセス ポリシーが評価されます。

-   この時点で、以下の 3 つの使用可能なオプションがあります。

    -   ユーザーによるアプリへのアクセスを許可する

    -   ユーザーによるアプリへのアクセスをブロックする

    -   ユーザーによるアプリへのアクセスを許可する (ただし、監視モードで)

        -   この場合、ユーザーは再度 Cloud App Security プロキシにリダイレクトされ、ユーザーとアプリ間のセッション全体が監視されます。

        -   監視中に、プロキシはセッション ポリシーを評価し、適宜、ブロック アクションを実行できます。

## <a name="how-access-control-works"></a>アクセス制御のしくみ

プロキシの展開の一環として、制御対象のアプリと ID プロバイダーの両方の構成を変更する必要があります。 これには URL の変更が含まれるため、ID プロバイダーとアプリの両方がプロキシにログイン要求をリダイレクトします。 さらに、必要に応じて、証明書も同様に置き換えられます。

これらの手順が完了すると、すべてのログイン イベントはプロキシを経由し、プロキシは、アプリへのアクセスを許可するか、拒否するか、あるいは監視モードでアクセスを許可するかを決定できます。 この段階で、プロキシはデバイスからのクライアント証明書を要求し、デバイスの状態を使用してポリシーを決定できることに注意してください。

## <a name="how-session-control-works"></a>セッション制御のしくみ

プロキシのセッション制御はアクセス制御を基に作成されます。 アプリへのアクセスを制御してから、アクセス ポリシーに基づいてセッションの監視を決定できます。その場合、そのセッションをプロキシのセッション制御にリダイレクトします。 それ以降、ユーザーの要求と応答は、直接アプリにではなく、プロキシを介して行われます。

セッション内でユーザーを保持するために、プロキシは、アプリ内の関連するすべての URL、Java スクリプト、および Cookie をプロキシの重複するページに置き換えます。 たとえば、アプリが、末尾が *myapp.com* のリンクを含むページを返した場合、プロキシはそれらを、末尾が *myapp.com.cas.ms* などのページに置き換えます。

セッションがプロキシを介して送られると、プロキシはトラフィックを検査し、Cloud App プロキシ ポータルで識別したイベントを表示し、セッションにポリシーを適用できます。

## <a name="how-identifying-managed-devices-works"></a>管理対象デバイスの識別のしくみ

管理対象デバイスを識別する場合、プロキシはクライアント証明書のメカニズムを使用します。 このメカニズムは次のように機能します。

-   ユーザーが自分のデバイスにクライアント証明書をインストールしており、管理対象デバイスまたは非管理対象デバイスを確認する関連ポリシーが存在する場合。

    -   ユーザーがログイン フェーズ中にプロキシのページに到達すると、プロキシはユーザーのデバイスからのクライアント証明書を要求します。

    -   ユーザー デバイスはクライアント証明書の提供を要求され、承認した場合、クライアント証明書がプロキシに送られます。

    -   その後、プロキシは、管理者が提供したルート証明書に対してクライアント証明書を認証します。

    -   デバイスによって提供されたクライアント証明書がルート証明書で正常に認証された場合、デバイスは管理対象と見なされます。

-   前のフェーズのいずれかが完了していない場合、デバイスは非管理対象と見なされます。



## <a name="see-also"></a>参照  
[プロキシの展開](proxy-deployment.md)   
[テクニカル サポートが必要な場合は、Cloud App Security のサポート ページをご利用ください。](http://support.microsoft.com/oas/default.aspx?prid=16031)   
[Premier サポートをご利用のお客様は、Premier ポータルから直接 Cloud App Security を選択することもできます。](https://premier.microsoft.com/)  
  