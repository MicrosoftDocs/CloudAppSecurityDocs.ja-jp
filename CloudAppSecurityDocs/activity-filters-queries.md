---
title: Cloud App Security のアクティビティのフィルターとクエリの操作
description: この記事では、Cloud App Security のアクティビティのフィルターとクエリの一覧を示し、それらを使用する方法について説明します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 12/10/2018
ms.topic: how-to
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: 1b0e6f838435b84d285881353c6a7b0f371b7670
ms.sourcegitcommit: 29a8e66c665f51d831516924ae4d9d8047b39276
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/24/2020
ms.locfileid: "88779374"
---
# <a name="activity-filters-and-queries"></a>アクティビティ フィルターとクエリ

*適用対象:Microsoft Cloud App Security*

この記事では、Cloud App Security のアクティビティのフィルターとクエリについて説明し、操作手順を示します。

## <a name="activity-filters"></a>アクティビティ フィルター

以下に示すのは、適用できるアクティビティ フィルターの一覧です。 ほとんどのフィルターでは NOT をはじめとする複数値がサポートされているため、ポリシー作成時の強力なツールとなります。

- アクティビティ ID - ID を使用して特定のアクティビティのみを検索します。 このフィルターは、(SIEM エージェントを使用して) Cloud App Security を SIEM に接続する場合や、Microsoft Cloud App Security ポータル内でアラートをさらに詳細に調査する場合に便利です。

- アクティビティ オブジェクト - アクティビティが実行されたオブジェクトを検索します。 このフィルターは、ファイル、フォルダー、ユーザー、またはアプリのオブジェクトに適用されます。
  - アクティビティのオブジェクト ID - オブジェクトの ID (ファイル、フォルダー、ユーザー、またはアプリの ID)。
  <!-- - File, folder or site URL - Enables you to select files, folders and URLs that start with a specific string.-->
  <!-- - Target object (file/folder) - Enables you to select a specific file or folder. -->
  - アイテム - アクティビティ オブジェクトの名前または ID で検索できます (例: ユーザー名、ファイル、パラメーター、サイト)。 **[アクティビティ オブジェクト項目]** フィルターでは、特定の項目について **[次の値を含む]** 、 **[等しい]** 、または **[次の値で始まる]** を選択して項目をフィルターできます。

- アクティビティの種類 - アプリ アクティビティを検索します。

- 管理アクティビティ - 管理アクティビティのみを検索します。

- アラート ID: アラート ID で検索します。

- アプリ - 特定のアプリ内のアクティビティのみを検索します。

- 適用されたアクション - 適用されているガバナンス アクション ([ブロック]、[プロキシのバイパス]、[暗号化解除されました]、[暗号化]、[暗号化できませんでした]、[アクションなし]) で検索します。

- 日付 - アクティビティが発生した日付。 フィルターでは、日付の前後と日付の範囲がサポートされます。

<!--- Description – Specific keyword in the activity description, for example, all activities that include the string **user** in their description.  -->

- デバイス タグ - **[Intune compliant]\(Intune 準拠\)** 、 **[Hybrid Azure AD joined]\(Hybrid Azure AD 参加済み\)** 、または **[有効なクライアント証明書]** によって検索します。

- デバイスの種類 - 特定の種類のデバイスを使用して行われたアクティビティのみを検索します。 たとえば、モバイル デバイス、PC、またはタブレットからのすべてのアクティビティを検索します。

- ファイルとフォルダー - アクティビティが実行されたファイルとフォルダーを検索します。
  - ファイル ID - アクティビティが実行されたファイル ID で検索できます。
  - 名前 - ファイルまたはフォルダーの名前に対してフィルター処理を行います。 名前と検索値の関係を **[ends with]\(次の値で終わる\)** 、 **[が次と等しい]** 、または **[starts with]\(が次で始まる\)** から選択できます。
  - 特定のファイルまたはフォルダー - 特定のファイルまたはフォルダーを含める、または除外することができます。 ファイルまたはフォルダーを選択するとき、 **[アプリ]** 、 **[所有者]** 、または部分的な **[ファイル名]** でリストの絞り込みができます。

- IP アドレス - アクティビティの実行元の生 IP アドレス、カテゴリ、またはタグ。
  - 生 IP アドレス - 生の IP アドレスで、またはそのアドレスによって実行されたアクティビティを検索できます。 特定のシーケンスとの一致、不一致、前方一致、または前方不一致で生 IP アドレスを検索できます。
  - IP カテゴリ - アクティビティの実行元の IP アドレスのカテゴリ。管理者の IP アドレス範囲から実行されたすべてのアクティビティなどを指定できます。 カテゴリは、関連する IP アドレスを含むように構成する必要があります。ただし、構成済みで、匿名プロキシおよび Tor の 2 つの IP タグを含む "危険" カテゴリは除きます。 IP カテゴリの構成方法については、「[ニーズに応じたデータの管理](ip-tags.md)」を参照してください。
  - IP タグ - 匿名のプロキシ IP アドレスから実行されたすべてのアクティビティなどの、アクティビティの実行元の IP アドレスのタグ。 Cloud App Security は、構成できない一連の組み込み IP タグを作成します。 さらに、ユーザーが独自の IP タグを構成することができます。 独自の IP タグの構成の詳細については、「[ニーズに応じたデータの管理](ip-tags.md)」を参照してください。
  組み込み IP タグには次のようなものがあります。
    - Microsoft アプリ (このうち 14 個)
    - 匿名プロキシ
    - ボットネット (アクティビティがボットネットで実行された場合、リンクからボットネットの詳細を確認できます)
    - IP をスキャンするダークネット
    - マルウェア C&C サーバー
    - リモート接続アナライザー
    - サテライト プロバイダー
    - スマート プロキシとアクセス プロキシ (意図的に除外)
    - Tor 出口ノード
    - Zscaler

- 偽装されたアクティビティ - 別のユーザーの名前で実行されたアクティビティのみを検索します。

- インスタンス - アクティビティが実行された、または実行されなかったアプリ インスタンス。

- 場所 – アクティビティが実行された国または地域。

- 一致したポリシー - ポータルで設定されている特定のポリシーに一致したアクティビティを検索します。

- 登録された ISP - アクティビティの実行元の ISP。

- ソース - アクティビティが検出されたソースで検索します。 ソースは次のいずれかとなります。
  - アプリ コネクタ - アプリの API コネクタから直接届くログ。
  - アプリ コネクタ分析 - API コネクタによる情報スキャンに基づく Cloud App Security 拡張。

- ユーザー - アクティビティを実行したユーザー。ドメイン、グループ、名前、または組織でフィルターできます。 [が設定されていない] 演算子を使用すると、特定のユーザーが存在しないアクティビティをフィルターできます。
  - ユーザー ドメイン - 特定のユーザー ドメインを検索します。
  - ユーザー組織 - EMEA マーケティング ユーザーが実行したすべてのアクティビティなどの、アクティビティを実行したユーザーの組織単位。 これは、組織単位を使用して接続された G Suite インスタンスのみに関連します。
  - ユーザー グループ - Office 365 管理者など、接続されているアプリからインポートできる特定のユーザー グループ。
  - ユーザー名 - 特定のユーザー名を検索します。 特定のユーザー グループ内のユーザーの一覧を表示するには、 **[アクティビティ ドロアー]** で、ユーザー グループの名前をクリックします。 クリックすると、グループ内のすべてのユーザーが表示された [アカウント] ページに移動します。 そこから、グループ内の特定ユーザーのアカウントの詳細にドリルダウンできます。
  - **[ユーザー グループ]** と **[ユーザー名]** のフィルターは、 **[条件]** フィルターを使用し、次のいずれかのユーザーのロールを選択することで、さらにフィルターすることができます。
    - アクティビティ オブジェクトのみ - 対象のアクティビティを実行しておらず、アクティビティのオブジェクトである選択されたユーザーまたはユーザー グループ。
    - アクターのみ - アクティビティを実行したユーザーまたはユーザー グループ。
    - すべてのロール - アクティビティを実行した、またはアクティビティのオブジェクトとしてアクティビティに関係している、ユーザーまたはユーザー グループ。

- ユーザー エージェント - アクティビティの実行元のユーザー エージェント。

- ユーザー エージェント タグ - 組み込みのユーザー エージェント タグ。古いブラウザーや古いオペレーティング システムから実行されたすべてのアクティビティなどを検索できます。

<!--
>[!NOTE]
> If at any point you want to clear the filters, you can do so by clicking the clear filters icon ![clear filters icon](media/clear-filters.png). -->

## <a name="activity-queries"></a>アクティビティ クエリ

調査をさらに簡単にするために、カスタム クエリを作成して、後で使用できるように保存することができます。

1. **[アクティビティ ログ]** ページで、前述のフィルターを使用して、必要に応じてアプリにドリルダウンします。

2. クエリの作成が完了したら、フィルターの右上隅にある **[名前を付けて保存]** ボタンをクリックします。

3. **[クエリの保存]** ポップアップで、クエリに名前を付けます。

   ![新しいクエリ](media/new-activity-query.png)

4. 後でこのクエリを使用するには、 **[クエリ]** で **[保存されたクエリ]** まで下にスクロールして、クエリを選択します。

   ![クエリを開く](media/select-activity-query.png)

Cloud App Security には**クエリ候補**の機能もあります。 クエリ候補によってアクティビティが絞り込まれ、推奨する調査対象が提示されます。 これらのクエリを編集して、カスタム クエリとして保存することができます。 オプションのクエリ候補には、以下のものがあります。

- 管理者のアクティビティ - すべてのアクティビティのうち、管理者が関与したアクティビティのみを表示します。

- ダウンロード アクティビティ - すべてのアクティビティのうち、ユーザー リストの .csv ファイルのダウンロード、共有コンテンツのダウンロード、フォルダーのダウンロードなど、ダウンロード アクティビティであったアクティビティのみを表示します。

- 失敗したログイン - すべてのアクティビティのうち、失敗したログオンと、SSO 経由の失敗したサインインのみを表示します。

- ファイルとフォルダーのアクティビティ - すべてのアクティビティのうち、ファイルとフォルダーが関係するアクティビティのみを表示します。 このフィルターには、フォルダーのアップロード、ダウンロード、フォルダーへのアクセス、ファイルの作成、削除、アップロード、ダウンロード、検疫、ファイルへのアクセス、コンテンツの転送が含まれます。

- 偽装アクティビティ - すべてのアクティビティのうち、偽装アクティビティのみを表示します。

- メールボックス アクティビティ - すべてのアクティビティのうち、アイテムの作成、メールボックスからのメッセージの消去、メッセージの更新、[メールボックス所有者として送信する] のアクセス許可を使用したメッセージの送信 (偽装) など、Microsoft Exchange Online のアクティビティのみを表示します。

- パスワードの変更とリセットの要求 - すべてのアクティビティのうち、パスワードのリセットを伴う、パスワードを変更する、また、次回サインイン時のパスワード変更をユーザーに強制するアクティビティのみを表示します。

- セキュリティ リスク - すべてのアクティビティのうち、DLP ポリシーに一致するアクティビティのみを表示します。

- 共有アクティビティ - すべてのアクティビティのうち、会社のリンクの作成、匿名リンクの作成、読み取り/書き込みアクセス許可の付与など、フォルダーとファイルの共有に関係するアクティビティのみを表示します。

- 成功したログイン - すべてのアクティビティのうち、偽装アクション、偽装ログオン、シングル サインオンによるログオン、新しいデバイスからのログオンなど、成功したログインに関係するアクティビティのみを表示します。

![アクティビティのクエリ](media/queries-activity.png)

さらに、クエリ候補を新しいクエリの土台として使用できます。 まず、クエリ候補の 1 つを選択します。 次に、必要に応じて変更を加え、最後に **[名前を付けて保存]** をクリックして、新しい**保存済みクエリ**を作成します。

## <a name="next-steps"></a>次のステップ

> [!div class="nextstepaction"]
> [クラウド環境を保護するための日常的な作業](daily-activities-to-protect-your-cloud-environment.md)
