---
title: Cloud App Security のアクティビティ フィルターとクエリを使用する
description: この記事では、Cloud App Security のアクティビティ フィルターとクエリの一覧を提示し、その使用方法について説明します。
keywords: ''
author: rkarlin
ms.author: rkarlin
manager: rkarlin
ms.date: 12/10/2018
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.assetid: 9ba5c7d3-c733-4048-9b99-bf41a0f46695
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: 4f25b48ece9782e75c20cfa8516183c953d05bb3
ms.sourcegitcommit: 917d8cf85ac0b58a3b1788067c2ff92101eb3ccf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/19/2019
ms.locfileid: "67237142"
---
# <a name="activity-filters-and-queries"></a>アクティビティ フィルターとクエリ

*適用対象:Microsoft Cloud App Security*

この記事では、Cloud App Security のアクティビティ フィルターとクエリについて説明し、手順を示します。

## <a name="activity-filters"></a>アクティビティ フィルター

以下に示すのは、適用できるアクティビティ フィルターの一覧です。 ポリシー作成時の強力なツールを提供するために、ほとんどのフィルターでは NOT をはじめとする複数値をサポートしています。  
  
- アクティビティ ID - ID を使用して特定のアクティビティのみを検索します。 このフィルターは、(SIEM エージェントを使用して) Microsoft Cloud App Security を SIEM に接続する場合や、Cloud App Security ポータル内でアラートをさらに詳細に調査する場合に便利です。  
  
- アクティビティ オブジェクト - アクティビティが行われたオブジェクトを検索します。 このフィルターは、ファイル、フォルダー、ユーザーまたはアプリのオブジェクトに適用されます。 
  - アクティビティのオブジェクト ID - オブジェクトの ID (ファイル、フォルダー、ユーザー、またはアプリの ID)。
  <!-- - File, folder or site URL - Enables you to select files, folders and URLs that start with a specific string.-->
  <!-- - Target object (file/folder) - Enables you to select a specific file or folder. -->
  - アイテム - アクティビティ オブジェクトの名前または ID で検索できます (例: ユーザー名、ファイル、パラメーター、サイト)。 **[アクティビティ オブジェクト項目]** フィルターでは、特定の項目について **[次の値を含む]** 、 **[等しい]** 、または **[次の値で始まる]** を選択して項目をフィルターできます。
    
- アクティビティの種類 - アプリ アクティビティを検索します。

- 管理アクティビティ - 管理アクティビティのみを検索します。  
  
- アラート ID: アラート ID で検索します。

- アプリ - 特定のアプリ内のアクティビティのみを検索します。  
  
- 適用されたアクション - 適用されているガバナンス アクションで検索します:[ブロック]、[プロキシのバイパス]、[暗号化解除されました]、[暗号化]、[暗号化できませんでした]、[アクションなし]。

- 日付 - アクティビティが発生した日付。 フィルターでは指定した日以前/以降、および日付の範囲を設定できます。  
  
<!--- Description – Specific keyword in the activity description, for example, all activities that include the string **user** in their description.  -->
  
- デバイス タグ - 準拠、管理、検証済みのどのデバイスであるかによって検索します。

- デバイスの種類 - 特定の種類のデバイスを使用して行われたアクティビティのみを検索します。 たとえば、モバイル デバイス、PC、またはタブレットからのすべてのアクティビティを検索します。  

- ファイルとフォルダー - アクティビティが実行されたファイルとフォルダーを検索します。
    - ファイル ID - アクティビティが実行されたファイル ID で検索を行うことができます。 
    - 名前 - ファイルまたはフォルダーの名前に対してフィルター処理を行います。 名前が検索値**で終わる**か、検索値**と等しい**か、または検索値**で始まる**かを選択できます。
    - 特定のファイルまたはフォルダー - 特定のファイルまたはフォルダーを含める、または除外することができます。 ファイルまたはフォルダーを選択するとき、**アプリ**、**所有者**、または部分的な**ファイル名**でリストをフィルター処理することができます。 
  
- IP アドレス - アクティビティの実行元の生 IP アドレス、カテゴリ、またはタグ。  
  - 生 IP アドレス - 生 IP アドレス上で、または生 IP アドレスによって実行されたアクティビティを検索することができます。 特定のシーケンスに等しい/等しくない生 IP アドレス、または特定のシーケンスで始まる/始まらない生 IP アドレスを指定できます。 
  - IP カテゴリ - アクティビティの実行元の IP アドレスのカテゴリ。管理者の IP アドレス範囲から実行されたすべてのアクティビティなどを指定できます。 カテゴリは、関連する IP アドレスを含むように構成する必要があります。ただし、構成済みで、匿名プロキシおよび Tor の 2 つの IP タグを含む "危険" カテゴリは除きます。 IP カテゴリの構成方法については、「[ニーズに応じたデータの管理](ip-tags.md)」を参照してください。  
  - IP タグ - 匿名のプロキシ IP アドレスから実行されたすべてのアクティビティなどの、アクティビティの実行元の IP アドレスのタグ。 Cloud App Security では、構成できない一連の組み込み IP タグが作成されます。 さらに、ご自分で独自の IP タグを構成することもできます。 独自の IP タグの構成の詳細については、「[ニーズに応じたデータの管理](ip-tags.md)」を参照してください。
  組み込み IP タグには次のようなものがあります。
    - Microsoft アプリ (このうち 14 個)
    - 匿名プロキシ
    - ボットネット (アクティビティがボットネットで実行された場合、リンクから特定のボットネットの詳細を確認できます)
    - IP をスキャンするダークネット
    - マルウェア C&C サーバー
    - リモート接続アナライザー
    - サテライト プロバイダー
    - スマート プロキシとアクセス プロキシ (意図的に除外)
    - Tor 出口ノード
    - Zscaler


- 偽装されたアクティビティ - 別のユーザーの名前で実行されたアクティビティのみを検索します。  

- インスタンス - アクティビティが実行された、または実行されなかったアプリのインスタンス。

- 場所 - アクティビティの実行元の国。  

- 一致したポリシー - ポータルで設定されている特定のポリシーに一致したアクティビティを検索します。  

- 登録された ISP - アクティビティの実行元の ISP。

- ソース - アクティビティが検出されたソースで検索します。 ソースは次のいずれかとなります。
  - アプリ コネクタ - アプリの API コネクタから直接届くログ。
  - アプリ コネクタ分析 - API コネクタによる情報スキャンに基づく Cloud App Security 拡張。
  

- ユーザー - アクティビティを実行したユーザー。ドメイン、グループ、名前、または組織でフィルターできます。 [が設定されていない] 演算子を使用すると、特定のユーザーが存在しないアクティビティをフィルタリングできます。  
  - ユーザー ドメイン - 特定のユーザー ドメインを検索します。
  - ユーザー組織 - EMEA マーケティング ユーザーが実行したすべてのアクティビティなどの、アクティビティを実行したユーザーの組織単位。  
  - ユーザー グループ - Office 365 管理者など、接続されているアプリからインポートできる特定のユーザー グループ。  
  - ユーザー名 - 特定のユーザー名を検索します。 特定のユーザー グループ内のユーザーの一覧を表示するには、 **[アクティビティ ドロアー]** で、ユーザー グループの名前をクリックします。 クリックすることで、グループ内のすべてのユーザーが一覧表示された [アカウント] ページに移動します。 そこから、グループ内の特定ユーザーのアカウントの詳細を調べていくことができます。
    -  **[ユーザー グループ]** と **[ユーザー名]** のフィルターは、 **[条件]** フィルターを使用し、次のいずれかのユーザーのロールを選択することで、さらにフィルターすることができます。
        - アクティビティ オブジェクトのみ - 対象のアクティビティを実行しておらず、アクティビティのオブジェクトである選択されたユーザーまたはユーザー グループ。
        - アクターのみ - アクティビティを実行したユーザーまたはユーザー グループ。
        - すべてのロール - アクティビティを実行した者として、またはアクティビティのオブジェクトとしてアクティビティに関係している、ユーザーまたはユーザー グループ。

- ユーザー エージェント - アクティビティの実行元のユーザー エージェント。  
  
- ユーザー エージェント タグ - 組み込みのユーザー エージェント タグ。古いブラウザーや古いオペレーティング システムから実行されたすべてのアクティビティなどを検索できます。  

<!--
>[!NOTE]
> If at any point you want to clear the filters, you can do so by clicking the clear filters icon ![clear filters icon](./media/clear-filters.png). -->


## <a name="activity-queries"></a>アクティビティのクエリ

調査をさらに簡単にするために、カスタム クエリを作成し、それを後で使用するために保存できるようになりました。 

1. **[アクティビティ ログ]** ページで、前述のフィルターを利用し、必要に応じてアプリにドリルダウンします。 

2. クエリのビルドが終了したら、フィルターの右上隅にある **[名前を付けて保存]** ボタンをクリックします。 

3. **[クエリの保存]** ポップアップでクエリに名前を付けます。

   ![新しいクエリ](./media/new-activity-query.png)

4. このクエリを今後もう一度使用するには、 **[クエリ]** の下で、下方向にスクロールして **[保存されたクエリ]** を表示し、クエリを選択します。 

   ![クエリを開く](./media/select-activity-query.png)


Cloud App Security によっても**クエリ候補**が提供されます。 クエリ候補によって、アクティビティをフィルター処理する調査方法が推奨されます。 これらのクエリを編集し、カスタム クエリとして保存することができます。 次に、省略可能なクエリの候補を示します。

 - 管理者アクティビティ - すべてのアクティビティにフィルター処理を適用し、管理者が関与したアクティビティのみを表示します。

 - ダウンロード アクティビティ - すべてのアクティビティにフィルター処理を適用し、.csv ファイルでのユーザー リストのダウンロード、共有コンテンツのダウンロード、フォルダーのダウンロードなど、ダウンロードが含まれるアクティビティであったもののみを表示します。

 - ログイン失敗 - すべてのアクティビティにフィルター処理を適用し、SSO 経由で失敗したログオンやサインインのみを表示します。 

 - ファイルとフォルダーのアクティビティ - すべてのアクティビティにフィルター処理を適用し、ファイルとフォルダーが関係するアクティビティのみを表示します。 フィルター処理には、フォルダーのアップロード、ダウンロード、フォルダーへのアクセスや、ファイルの作成、削除、アップロード、ダウンロード、検疫、ファイルへのアクセス、コンテンツの転送が含まれます。 

 - 権限借用アクティビティ - すべてのアクティビティにフィルター処理を適用し、権限借用アクティビティのみを表示します。

 - メールボックス アクティビティ - すべてのアクティビティにフィルター処理を適用し、アイテムを作成する、メールボックスからメッセージを削除する、メッセージを更新する、[差出人を指定して送信する] アクセス許可 (権限借用) でメッセージを送信するなど、Microsoft Exchange Online アクティビティのみを表示します。

 - パスワードの変更とリセットの要求 - すべてのアクティビティにフィルター処理を適用し、パスワードのリセット、パスワードの変更、次回のサインイン時のパスワード変更の強制に関連するアクティビティのみを表示します。

 - セキュリティ上の問題 - すべてのアクティビティにフィルター処理を適用し、DLP ポリシーに一致するアクティビティのみを表示します。

 - 共有アクティビティ - すべてのアクティビティにフィルター処理を適用し、会社リンクの作成、匿名リンクの作成、読み取り/書き込みアクセス許可の付与など、フォルダーやファイルの共有に関するアクティビティのみを表示します。

 - 成功したログイン - すべてのアクティビティにフィルター処理を適用し、権限借用アクション、権限借用ログオン、シングル サインオンによるログオン、新しいデバイスからのログオンなど、成功したログインに関係するアクティビティのみを表示します。

![クエリ アクティビティ](./media/queries-activity.png)
 
また、新しいクエリの開始点としてクエリ候補を利用できます。 まず、クエリ候補の 1 つを選択します。 次に必要に応じて変更を加え、最後に **[名前を付けて保存]** をクリックして新しい**保存クエリ**を作成します。


## <a name="next-steps"></a>次の手順 
[クラウド環境を保護するための日常的な作業](daily-activities-to-protect-your-cloud-environment.md)   

  
  
