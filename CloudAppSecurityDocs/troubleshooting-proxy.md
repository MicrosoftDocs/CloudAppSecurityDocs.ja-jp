---
title: アクセスおよびセッション制御のトラブルシューティング
description: この記事では、一般的なアクセスおよびセッション制御を調査して解決する方法に関するガイダンスを管理者に提供します。
ms.date: 07/15/2020
ms.topic: conceptual
ms.openlocfilehash: 3dc2826de9e46eae43d3d4a2200f0a56ae3ee9da
ms.sourcegitcommit: 2cb91556060d61fa378047aebf81b71dff5ff19d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2021
ms.locfileid: "99551725"
---
# <a name="troubleshooting-access-and-session-controls"></a>アクセスおよびセッション制御のトラブルシューティング

この記事では、[管理者](#issues-experienced-by-admins)と[エンド ユーザー](#issues-experienced-by-end-users)が経験する一般的なアクセスおよびセッション制御の問題を調査して解決する方法に関するガイダンスを管理者に提供します。

続行する前に、ご利用の環境が、アクセスおよびセッション制御の次の一般的な最小要件を満たしていることを確認してください。

- **ライセンス**: 有効な [ライセンス](https://aka.ms/mcaslicensing)があることを確認します。
- **シングル サインオン (SSO)** : アプリは、サポートされているいずれかの SSO ソリューションを使用して構成する必要があります。
  - SAML 2.0 または OpenID Connect 2.0 を使用する Azure Active Directory (Azure AD)
  - SAML 2.0 を使用するサードパーティの IdP
- **ブラウザー サポート**: セッション制御は、これらのサポートされているブラウザーでのブラウザーベースのセッションで利用できます: Microsoft Edge (最新版)、Google Chrome (最新版)、Mozilla Firefox (最新版)、または Apple Safari (最新版)
- **ダウンタイム**: Cloud App Security を使用すると、コンポーネントが正常に機能していないなど、サービスの中断が発生した場合に適用する既定の動作を定義できます。 通常のポリシー制御を適用できない場合に、ユーザーが機密性が高い可能性のあるコンテンツに対してアクションを実行できないようにする (ブロックする) か、バイパスする (許可する) かを選択できます。 システムのダウンタイム時のこの既定の動作は、次のように、Cloud App Security ポータルで構成できます: **[設定]**  >  **[アプリの条件付きアクセス制御]**  >  **[既定の動作]**  > アクセスを **許可** または **ブロック** する。

## <a name="issues-experienced-by-admins"></a>管理者が経験する問題

このセクションは、Cloud App Security でアクセスおよびセッション制御を構成する管理者を対象としており、次の領域で発生する可能性のある一般的な状況を特定するのに役立ちます。

|セクション|問題|
|---|---|
|[ネットワークの状態](#network-conditions)|- [ブラウザー ページに移動するときのネットワーク エラー](#network-errors-when-navigating-to-a-browser-page)<br />- [遅いログイン](#slow-login)<br />- [その他の考慮事項](#network-conditions-additional-considerations)|
|[デバイスの識別](#device-identification)|- [Intune に準拠している、または Hybrid Azure AD Join を使用したデバイスの誤った識別](#misidentified-intune-compliant-or-hybrid-azure-ad-joined-devices)<br />- [クライアント証明書が予期されるときに要求されない](#client-certificates-are-not-prompting-when-expected)<br />- [ログインのたびにクライアント証明書が要求される](#client-certificates-are-prompting-at-every-login)<br />- [その他の考慮事項](#device-identification-additional-considerations)|
|[アプリのオンボード](#onboarding-an-app)|- [アプリが **[アプリの条件付きアクセス制御アプリ]** ページに表示されない](#app-does-not-appear-on-the-conditional-access-app-control-apps-page)<br />- [アプリの状態: セットアップの続行](#app-status-continue-setup)<br />- [ネイティブ アプリの制御を構成できない](#cannot-configure-controls-for-native-apps)<br />- [ **[App is not recognized]\(アプリが認識されていません\)** ページが表示される](#something-went-wrong-page-appears)<br />- [ **[要求セッション制御]** オプションが表示される](#request-session-control-option-appears)<br />- [その他の考慮事項](#onboarding-apps-additional-considerations)|
|[アクセスおよびセッション ポリシーの作成](#creating-access-and-session-policies)|- [条件付きアクセス ポリシーで、 **[アプリの条件付きアクセス制御]** オプションを表示できない](#in-conditional-access-policies-you-cannot-see-the-conditional-access-app-control-option)<br />- [ポリシーを作成するときのエラー メッセージ: アプリがアプリの条件付きアクセス制御と共にデプロイされていません](#error-message-when-creating-a-policy-you-dont-have-any-apps-deployed-with-conditional-access-app-control)<br />- [アプリのセッション ポリシーを作成できない](#cannot-create-session-policies-for-an-app)<br />- [**検査方法** を選択できない: **データ分類サービス**](#cannot-choose-inspection-method-data-classification-service)<br />- [**アクション** を選択できない: **保護**](#cannot-choose-action-protect)<br />- [その他の考慮事項](#policies-additional-considerations)|

### <a name="network-conditions"></a>ネットワークの状態

発生する可能性がある一般的なネットワークの状態に関する問題は、次のとおりです。

- [ブラウザー ページに移動するときのネットワーク エラー](#network-errors-when-navigating-to-a-browser-page)
- [遅いログイン](#slow-login)
- [その他の考慮事項](#network-conditions-additional-considerations)

#### <a name="network-errors-when-navigating-to-a-browser-page"></a>ブラウザー ページに移動するときのネットワーク エラー

アプリの Cloud App Security のアクセスおよびセッション制御を初めて設定するときに、発生する可能性がある一般的なネットワーク エラーは次のとおりです: "このサイトはセキュリティで保護されていません" と "インターネットに接続していません"。 これらのメッセージは、一般的なネットワーク構成エラーを示している可能性があります。

**推奨される手順**

1. ご利用の環境に関連する Azure IP アドレスと DNS 名を使用して、Cloud App Security と連動するようにファイアウォールを構成します。
    1. [Cloud App Security データ センター](network-requirements.md#access-and-session-controls)の次の IP アドレスと DNS 名に対する **送信ポート 443** を追加します。
    1. デバイスを再起動し、ブラウザー セッションを再開します
    1. ログインが予期したとおりに動作することを確認します
1. ブラウザーのインターネット オプションで TLS 1.2 を有効にします。

    > [!NOTE]
    >
    > - Cloud App Security では、クラス最高レベルの暗号化を提供するために、トランスポート層セキュリティ (TLS) プロトコル 1.2 以降が使用されます。 セッション制御が構成されていると、TLS 1.2 以降をサポートしていないネイティブ クライアント アプリとブラウザーにアクセスできなくなります。 ただし、TLS 1.1 以下を使用している SaaS アプリは、Cloud App Security を使用して構成されている場合、TLS 1.2 以降を使用しているようにブラウザーに表示されます。
    > - セッション制御は、任意のオペレーティング システム上の任意の主要プラットフォーム上の任意のブラウザーで動作するように構築されていますが、サポートされているのは Microsoft Edge (最新版)、Google Chrome (最新版)、Mozilla Firefox (最新版)、または Apple Safari (最新版) です。 モバイル アプリとデスクトップ アプリへのアクセスをブロックまたは許可することもできます。

    | ブラウザー | 手順 |
    |---|---|
    | Microsoft Internet Explorer | 1.Internet Explorer を開きます<br />2. **[ツール]**  >  **[インターネット オプション]**  >  **[詳細]** タブの順に選択します<br />3. **[セキュリティ]** で、 **[TLS 1.2]** を選択します<br />4. **[適用]** 、 **[OK]** の順に選択します<br />5.ブラウザーを再起動し、アプリにアクセスできることを確認します |
    | Microsoft Edge / Edge Chromium | 1.タスク バーから [検索] を開き、"インターネット オプション" を検索します<br />2. **[インターネット オプション]** を選択します<br />3. **[セキュリティ]** で、 **[TLS 1.2]** を選択します<br />4. **[適用]** 、 **[OK]** の順に選択します<br />5.ブラウザーを再起動し、アプリにアクセスできることを確認します |
    | Google Chrome | 1.Google Chrome を開きます<br />2.右上にある **[詳細]** (3 つの垂直ドット) > **[設定]** の順にクリックします<br />3.下部にある **[詳細]** をクリックします<br />4. **[システム]** で、 **[プロキシ セットアップを開く]** をクリックします<br />5. **[詳細]** タブの **[セキュリティ]** で、 **[TLS 1.2]** を選択します<br />6. **[OK]** をクリックします。<br />7.ブラウザーを再起動し、アプリにアクセスできることを確認します |
    | Mozilla Firefox | 1.Mozilla Firefox を開きます<br />2.アドレス バーで、"about:config" を検索します<br />3.検索ボックスで、"TLS" を検索します<br />4.**security.tls.version.min** のエントリをダブルクリックします<br />5.整数値を 3 に設定し、必要な最小バージョンとして TLS 1.2 を適用します<br />6. **[保存]** (値ボックスの右側にあるチェック マーク) をクリックします<br />7.ブラウザーを再起動し、アプリにアクセスできることを確認します |
    | Safari | Safari バージョン 7 以降を使用している場合は、TLS 1.2 が自動的に有効になります |

#### <a name="slow-login"></a>遅いログイン

プロキシ チェーンと nonce 処理は、ログインのパフォーマンスの低下の原因となる可能性がある一般的な問題の一部です。

**推奨される手順**

1. ファイアウォールと転送プロキシ チェーンを削除し、目的のページに移動するために 2 つ以上のプロキシ サーバーを接続するように、また、ログイン プロセスでのパフォーマンスの低下の原因となる可能性があるその他の外部要因を除去するように環境を構成します。
    1. 環境内でプロキシ チェーンが発生しているかどうかを確認します
    1. 可能な場合は、追加の転送プロキシを削除します
1. nonce を使用しないアプリの nonce 処理をオフにします。

    > [!NOTE]
    > 一部のアプリでは、リプレイ攻撃を防ぐために、認証時に nonce ハッシュが使用されます。 Cloud App Security では、既定で、アプリによって nonce が使用されることが前提となります。 操作するアプリで nonce が使用されていない場合は、Cloud App Security でこのアプリの nonce 処理を無効にすることができます。

    1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[アプリの条件付きアクセス制御]** を選択します。
    1. アプリの一覧で、構成するアプリが表示されている行の末尾の 3 つのドットを選択し、 **[アプリの編集]** を選びます。
    1. **[nonce 処理]** をクリックしてセクションを展開してから、 **[nonce の処理を有効にする]** をオフにします。
    1. アプリからログアウトし、すべてのブラウザー セッションを終了します。
    1. ブラウザーを再起動して、アプリにログインし、ログインが予期したとおりに動作することを確認します。

<a name="network-conditions-additional-considerations"></a>

#### <a name="additional-considerations"></a>その他の考慮事項

ネットワークの状態のトラブルシューティングには、Cloud App Security プロキシに関するその他の考慮事項がいくつかあります。

- **セッションが別のデータ センターにルーティングされている**

    Cloud App Security では、世界中の Azure データ センターが活用され、位置情報によってパフォーマンスが最適化されます。 つまり、トラフィック パターンとその場所によっては、ユーザーのセッションがリージョンの外部でホストされる可能性があります。 ただし、お客様のプライバシーを保護するために、これらのデータ センターにセッション データが保存されることはありません。

- **プロキシのパフォーマンス**

    パフォーマンス ベースラインの派生は、次のような、Cloud App Security のプロキシの外部にある多くの要因に依存します。

    - このプロキシを使用するシリーズに存在する他のプロキシまたはゲートウェイ
    - ユーザーの位置
    - ターゲット リソースが存在する場所
    - ページ上の特定の要求

    一般に、すべてのプロキシで待機時間が増えます。 Cloud App Security プロキシの利点は次のとおりです。

    - Azure ドメイン コントローラーのグローバルな可用性を活用し、ユーザーを最も近いノードにジオロケートし、その往復距離を短縮します。これは、世界中の少数のサービスの規模で行われます。
    - Azure AD 条件付きアクセスとの統合を活用し、すべての状況におけるすべてのユーザーではなく、サービスにプロキシするセッションのみをルーティングします。

### <a name="device-identification"></a>デバイスの識別

Cloud App Security には、デバイスの管理状態を識別するための次のオプションが用意されています。

1. Microsoft Intune 準拠
1. Hybrid Azure AD ドメイン参加済み
1. クライアント証明書

デバイスの識別の詳細については、「[マネージド デバイスの識別](proxy-intro-aad.md#managed-device-identification)」を参照してください。

発生する可能性がある一般的なデバイスの識別に関する問題は、次のとおりです。

- [Intune に準拠している、または Hybrid Azure AD Join を使用したデバイスの誤った識別](#misidentified-intune-compliant-or-hybrid-azure-ad-joined-devices)
- [クライアント証明書が予期されるときに要求されない](#client-certificates-are-not-prompting-when-expected)
- [ログインのたびにクライアント証明書が要求される](#client-certificates-are-prompting-at-every-login)
- [その他の考慮事項](#device-identification-additional-considerations)

#### <a name="misidentified-intune-compliant-or-hybrid-azure-ad-joined-devices"></a>Intune に準拠している、または Hybrid Azure AD Join を使用したデバイスの誤った識別

Azure AD の条件付きアクセスでは、Intune に準拠している、および Hybrid Azure AD Join を使用したデバイスの情報を Cloud App Security に直接渡すことができます。この場合、デバイスの状態をアクセスまたはセッション ポリシーのフィルターとして使用できます。 詳細については、[Azure Active Directory のデバイス管理の概要](/azure/active-directory/devices/overview)に関するページを参照してください。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[設定]** を選択します。
1. **[アプリの条件付きアクセス制御]** で、 **[デバイスの識別]** を選択します。 このページには、Cloud App Security で使用できるデバイスの識別オプションが表示されます。
1. **[Intune に準拠しているデバイスの識別]** と **[Hybrid Azure AD Join を使用した識別]** についてはそれぞれ、 **[構成の表示]** をクリックして、サービスが設定されていることを確認します。

    > [!NOTE]
    > これらは、それぞれ Azure AD と Intune から自動的に同期されます。
1. **[Hybrid Azure AD Join を使用した]** または **[Intune に準拠している]** 、あるいはその両方に等しい **[デバイス タグ]** フィルターを使用して、アクセスまたはセッション ポリシーを作成します。
1. ブラウザーで、ポリシー フィルターに基づく Hybrid Azure AD Join を使用した、または Intune に準拠しているデバイスにログインします。
1. これらのデバイスからのアクティビティがログに設定されていることを確認します。 Cloud App Security の **[アクティビティ ログ]** ページで、ポリシー フィルターに基づく **[Hybrid Azure AD Join を使用した]** または **[Intune に準拠している]** 、あるいは両方に等しい **[デバイス タグ]** を [フィルター処理](activity-filters.md)します。
1. アクティビティが Cloud App Security アクティビティ ログに設定されていない場合は、Azure AD に移動して、次のようにします。
    1. **[監視]**  >  **[サインイン]** で、ログにサインイン アクティビティがあることを確認します。
    1. ログインしたデバイスの関連ログ エントリを選択します。
    1. **[詳細]** ウィンドウの **[デバイス情報]** タブで、デバイスが **マネージド** (Hybrid Azure AD Join を使用した) または **準拠** (Intune に準拠している) であることを確認します。 いずれの状態も確認できない場合は、別のログ エントリを試すか、確実にデバイス データが Azure AD に正しく構成されるようにします。
    1. 条件付きアクセスの場合、一部のブラウザーでは、拡張機能のインストールなどの追加の構成が必要になることがあります。 [条件付きアクセスでのブラウザーのサポート](/azure/active-directory/conditional-access/concept-conditional-access-conditions#supported-browsers)に関するガイドの情報を使用して、ブラウザーを構成してください。
    1. それでも **[サインイン]** ページにデバイス情報が表示されない場合は、Azure AD のサポート チケットを開いてください。

#### <a name="client-certificates-are-not-prompting-when-expected"></a>クライアント証明書が予期されるときに要求されない

デバイス識別メカニズムを使用すると、クライアント証明書を使用して関連するデバイスに認証を要求できます。 PEM 証明書形式で書式設定された X.509 ルート証明機関 (CA) または中間証明機関をアップロードできます。 これらの証明書には、CA の公開キーが含まれている必要があります。これは、セッション中に提示されたクライアント証明書の署名に使用されます。 クライアント証明書の詳細については、「[クライアント証明書で認証されたデバイス](proxy-intro-aad.md#client-certificate-authenticated-devices)」を参照してください。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[設定]** を選択します。
1. **[アプリの条件付きアクセス制御]** で、 **[デバイスの識別]** を選択します。 このページには、Cloud App Security で使用できるデバイスの識別オプションが表示されます。
1. X.509 ルートまたは中間 CA をアップロードしたことを確認します。 関連する証明機関に署名するために使用される CA をアップロードする必要があります。
1. **[有効なクライアント証明書]** に等しい **[デバイス タグ]** フィルターを使用して、アクセスまたはセッション ポリシーを作成します。
1. クライアント証明書が次のようになっていることを確認します。
    - PKCS #12 ファイル形式 (通常は .p12 または .pfx ファイル拡張子) を使用してデプロイされている
    - テストに使用しているデバイスの、デバイス ストアではなく、ユーザー ストアにインストールされている
1. ブラウザー セッションを再開します
1. 保護されたアプリにログインする場合
    - URL `<https://*.managed.access-control.cas.ms/aad_login>` にリダイレクトされることを確認します
    - iOS を使用している場合は、Safari ブラウザーを使用していることを確認します
    - Firefox を使用している場合は、Firefox の独自の証明書ストアに証明書を追加する必要もあります。 他のすべてのブラウザーでは、同じ既定の証明書ストアが使用されます。 [Firefox 証明書ストアに証明書を追加する方法](http://www.jscape.com/blog/firefox-client-certificate)を確認してください。
1. ブラウザーでクライアント証明書が要求されたことを確認します。
    - 表示されない場合は、別のブラウザーを試してみてください。 ほとんどの主要なブラウザーでは、クライアント証明書のチェックがサポートされています。 ただし、モバイル アプリとデスクトップ アプリでは、多くの場合、このチェックをサポートしていない可能性がある組み込みブラウザーが利用されているため、これらのアプリの認証に影響があります。
1. これらのデバイスからのアクティビティがログに設定されていることを確認します。 Cloud App Security の **[アクティビティ ログ]** ページで、 **[有効なクライアント証明書]** に等しい **[デバイス タグ]** を [フィルター処理](activity-filters.md)します。
1. それでもプロンプトが表示されない場合は、[サポート チケット](support-and-ts.md) を開き、次の情報を含めます。
    - 問題が発生したブラウザーまたはネイティブ アプリの詳細
    - オペレーティング システムのバージョン (例: iOS、Android、または Windows 10)
    - プロンプトが Edge Chromium で動作しているかどうかを示します

#### <a name="client-certificates-are-prompting-at-every-login"></a>ログインのたびにクライアント証明書が要求される

新しいタブを開いた後にクライアント証明書がポップアップ表示されている場合は、 **[インターネット オプション]** 内で設定が非表示になっていることが原因である可能性があります。

| ブラウザー | 手順 |
|---|---|
| Microsoft Internet Explorer | 1.Internet Explorer を開きます<br />2. **[ツール]**  >  **[インターネット オプション]**  >  **[詳細]** タブの順に選択します<br />3. **[セキュリティ]** で、 **[既存のクライアント証明書が 1 つしか存在しない場合の証明書の選択]** を選択します<br />4. **[適用]** 、 **[OK]** の順に選択します<br />5.ブラウザーを再起動し、追加のプロンプトなしでアプリにアクセスできることを確認します |
| Microsoft Edge / Edge Chromium | 1.タスク バーから [検索] を開き、"インターネット オプション" を検索します<br />2. **[インターネット オプション]** を選択します<br />3. **[セキュリティ]** を選択し、 **[ローカル イントラネット]** を選択してから、 **[レベルのカスタマイズ]** をクリックします<br />4. **[その他]**  >  **[既存のクライアント証明書が 1 つしか存在しない場合の証明書の選択]** で、 **[無効]** を選択します<br />5. **[OK]** をクリックして、[レベルのカスタマイズ] ダイアログ ボックスを閉じます<br />6. **[適用]** をクリックし、 **[OK]** を選択して、インターネット オプションを閉じます<br />7.ブラウザーを再起動し、追加のプロンプトなしでアプリにアクセスできることを確認します |

<a name="device-identification-additional-considerations"></a>

#### <a name="additional-considerations"></a>その他の考慮事項

デバイスの識別のトラブルシューティングには、いくつかの追加の考慮事項があります。

- **クライアント証明書の失効プロトコル**

    クライアント証明書の証明書の失効を求めることができます。 CA によって失効された証明書は信頼されなくなります。 このオプションを選択すると、すべての証明書が CRL プロトコルに合格することが求められます。 クライアント証明書に CRL エンドポイントが含まれていない場合は、マネージド デバイスから接続できなくなります。

### <a name="onboarding-an-app"></a>アプリのオンボード

アクセスおよびセッション制御のために、次の種類のアプリをオンボードできます。

- おすすめアプリ: **[セッション制御]** ラベルで示されているように、セッション制御をすぐに使用できるアプリ

- 任意の (カスタム) アプリ: 管理者は、カスタムの基幹業務 (LOB) またはオンプレミスのアプリをセッション制御にオンボードすることができます

![おすすめおよび任意の (カスタム) アプリを示すプロキシの一覧](media/troubleshooting-onboarding.png)

アプリをオンボードするときは、必ず、プロキシ デプロイ ガイドの各手順に従うことが重要です。

1. [セッション制御を使用するおすすめアプリをデプロイします](proxy-deployment-aad.md)
1. [セッション制御を使用する Azure AD アプリ プロキシを介してホストされるカスタムの LOB アプリ、おすすめ以外の SaaS アプリ、およびオンプレミスのアプリをデプロイします](proxy-deployment-any-app.md)

アプリのオンボード中に発生する可能性のある一般的なシナリオは、次のとおりです。

- [アプリが **[アプリの条件付きアクセス制御アプリ]** ページに表示されない](#app-does-not-appear-on-the-conditional-access-app-control-apps-page)
- [アプリの状態: セットアップの続行](#app-status-continue-setup)
- [ネイティブ アプリの制御を構成できない](#cannot-configure-controls-for-native-apps)
- [ **[App is not recognized]\(アプリは認識されていません\)** ページが表示される](#something-went-wrong-page-appears)
- [ **[要求セッション制御]** オプションが表示される](#request-session-control-option-appears)
- [その他の考慮事項](#onboarding-apps-additional-considerations)

#### <a name="app-does-not-appear-on-the-conditional-access-app-control-apps-page"></a>アプリが [アプリの条件付きアクセス制御アプリ] ページに表示されない

アプリを [アプリの条件付きアクセス制御] にオンボードする場合は、デプロイ ガイドの最後の手順として、エンド ユーザーがアプリに移動するようにします。 以下に一覧表示されている推奨事項は、ガイドに従った後にアプリが表示されない場合に行うことができる手順です。

**推奨される手順**

1. アプリが条件付きアクセス アプリの前提条件を満たしていることを確認します

| ID プロバイダー | 確認 |
|---|---|
| Azure AD | 1.Cloud App Security ライセンスに加え、Azure AD Premium P1 の有効なライセンスがあることを確認します<br />2.アプリで SAML 2.0 または OpenID Connect プロトコルが使用されていることを確認します<br />3.Azure AD でアプリの SSO が設定されていることを確認します |
| サードパーティ | 1.有効な Cloud App Security ライセンスがあることを確認します<br />2.重複するアプリを作成します<br />3.アプリで SAML プロトコルが使用されていることを確認します<br />4.アプリを完全にオンボードしており、アプリの状態が **[接続]** であることを確認します |

1. Azure AD ポリシーの **[セッション]** で、次のように、セッションが強制的に Cloud App Security にルーティングされる (これにより、 **[アプリの条件付きアクセス制御アプリ]** ページでアプリを表示できるようになります) ことを確認します。
    1. アプリの条件付きアクセス制御が選択されています
    1. 組み込みのポリシー ドロップダウンで、 **[監視のみ]** が選択されていることを確認します
1. 新しいシークレット モードを使用するか、もう一度サインインして、必ず、新しいブラウザー セッションでアプリに移動してください。

#### <a name="app-status-continue-setup"></a>アプリの状態: セットアップの続行

アプリの状態は、 **[セットアップの続行]** 、 **[接続]** 、 **[アクティビティがありません]** とは異なる場合があります。

サードパーティの ID プロバイダー (IdP) を介して接続されているアプリでは、セットアップが完了していない場合に、アプリにアクセスすると、状態が **[セットアップの続行]** となっているページが表示されます。 セットアップを完了するには、次の手順を使用します。

**推奨される手順**

1. **[セットアップの続行]** をクリックします。
1. [デプロイ ガイド](proxy-deployment-any-app.md#conf-app)に従い、すべての手順を完了していることを確認します。 特に次の点にご注意ください。
    1. 必ず、新しいカスタム SAML アプリを作成してください。 これは、ギャラリー アプリで使用できない可能性がある URL および SAML 属性を変更するために必要です。
    1. ID プロバイダーで同じ識別子 (エンティティ ID またはオーディエンスとも呼ばれる) の再利用が許可されていない場合、元のアプリの識別子を変更します。

#### <a name="cannot-configure-controls-for-native-apps"></a>ネイティブ アプリの制御を構成できない

ネイティブ アプリはヒューリスティックに検出でき、アクセス ポリシーを使用して監視またはブロックすることができます。 ネイティブ アプリの制御を構成するには、次の手順を使用します。

**推奨される手順**

1. アクセス ポリシーで、 **[クライアント アプリ]** フィルターを追加し、 **[モバイルとデスクトップ]** に等しくなるように設定します。
1. [アクション] で、 **[ブロック]** を選択します。
1. 必要に応じて、ユーザーがファイルをダウンロードできないときに表示されるブロック メッセージをカスタマイズします。たとえば、"このアプリにアクセスするには Web ブラウザーを使用する必要があります" などとします。
1. 制御が予期したとおりに動作していることをテストして確認します。

#### <a name="app-is-not-recognized-page-appears"></a>[App is not recognized]\(アプリは認識されていません\) ページが表示される

Cloud App Security では、クラウド アプリ カタログ ( **[検出]**  ->  **[クラウド アプリ カタログ]** ) を介して 16,000 個を超えるアプリを認識できます。 16,000 個のアプリのいずれでもない、Azure AD SSO を使用して構成されたカスタム アプリを使用している場合は、 **[App is not recognized]\(アプリは認識されていません\)** ページが表示されます。 この問題を解決するには、アプリの条件付きアクセス制御でアプリを構成する必要があります。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[アプリの条件付きアクセス制御]** を選択します。
1. バナーで、 **[View new apps]\(新しいアプリの表示\)** をクリックします。
1. 新しいアプリの一覧で、オンボードするアプリを見つけ、 **[+]** 記号をクリックしてから、 **[追加]** をクリックします。
    1. アプリを **カスタム** と **標準** アプリのどちらにするかを選択します。
    1. ウィザードを進み、構成しているアプリに対して指定された **ユーザー定義ドメイン** が正しいことを確認します。
1. **[アプリの条件付きアクセス制御アプリ]** ページにアプリが表示されることを確認します。

#### <a name="request-session-control-option-appears"></a>[要求セッション制御] オプションが表示される

アプリを追加した後、 **[要求セッション制御]** オプションが表示される場合があります。 これは、おすすめアプリにすぐに使えるセッション制御がある場合にのみ発生します。 その他のアプリについては、セルフオンボード プロセスを実行する必要があります。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックし、 **[設定]** を選択します。
1. **[アプリの条件付きアクセス制御]** の下で、 **[アプリのオンボードとメンテナンス]** を選択します。
1. アプリをオンボードするユーザーのユーザー プリンシパル名または電子メールを入力し、 **[保存]** をクリックします。
1. 展開するアプリにアクセスします。 表示されるページは、アプリが認識されているかどうかによって異なります。 以下のいずれかを実行します。

    | アプリ状況 | [説明] | 手順 |
    | --- | --- | --- |
    | 認識されていない | アプリが認識されていない画面が表示され、アプリを構成するように求められます。 | 1.[アプリをアプリの条件付きアクセス制御に追加します](proxy-deployment-any-app.md#add-app)。<br /> 2.[アプリのドメインを追加](proxy-deployment-any-app.md#add-domains)し、アプリに戻ってページを更新します。<br /> 3.[アプリの証明書をインストールします](proxy-deployment-any-app.md#install-certs)。 |
    | 認識されている | オンボード ページが表示され、アプリの構成プロセスを続行するように求められます。 | - [アプリの証明書をインストールします](proxy-deployment-any-app.md#install-certs)。 <br /><br /> **注:** アプリが正常に機能するために必要なすべてのドメインを使用してアプリが構成されていることを確認します。 追加のドメインを構成するには、[アプリのドメインの追加](proxy-deployment-any-app.md#add-domains)に進んでから、アプリのページに戻ります。 |

<a name="onboarding-apps-additional-considerations"></a>

#### <a name="additional-considerations"></a>その他の考慮事項

アプリのオンボードのトラブルシューティングには、いくつかの追加の考慮事項があります。

- **[アプリの条件付きアクセス制御] のアプリが Azure AD アプリと一致しない**

    Azure AD と Cloud App Security のアプリ名は、製品でのアプリの識別方法によって異なる場合があります。 Cloud App Security では、アプリのドメインを使用してアプリが識別され、それらが[クラウド アプリ カタログ](risk-score.md#the-cloud-app-catalog) (16,000 個を超えるアプリがある) に追加されます。 各アプリ内では、ドメインのサブセットを表示したり、そのサブネットに追加したりすることができます。 これに対し、Azure AD では、サービス プリンシパルを使用してアプリが識別されます。 詳細については、[Azure AD のアプリおよびサービス プリンシパル オブジェクト](/azure/active-directory/develop/app-objects-and-service-principals)に関するページを参照してください。

    実際には、Azure AD で **SharePoint Online** を選択することは、Cloud App Security で Word Online や Teams などのアプリを選択するのと同じことを意味します。これは、アプリで `sharepoint.com` ドメインが使用されるためです。

### <a name="creating-access-and-session-policies"></a>アクセスおよびセッション ポリシーの作成

Cloud App Security では、次の構成可能なポリシーが提供されます。

1. [アクセス ポリシー](access-policy-aad.md): ブラウザー、モバイル、またはデスクトップ アプリへのアクセスを監視またはブロックするためのものです
1. [セッション ポリシー](session-policy-aad.md)。 ブラウザーでデータの侵入および流出シナリオを防ぐために、特定のアクションを監視、ブロック、および実行するためのものです

これらのポリシーを Cloud App Security で使用するには、まず、次のように、セッション制御を拡張するように、Azure AD 条件付きアクセスでポリシーを構成する必要があります。Azure AD ポリシーの **[アクセス制御]** で、 **[セッション]** をクリックし、 **[アプリの条件付きアクセス制御を使う]** を選択して、組み込みポリシー ( **[監視のみ]** または **[ダウンロードを禁止する]** ) または **[カスタム ポリシーを使用する]** を選び、Cloud App Security に高度なポリシーを設定します。その後、 **[選択]** をクリックします。

これらのポリシーを構成するときに発生する可能性がある一般的なシナリオは、次のとおりです。

- [条件付きアクセス ポリシーで、 **[アプリの条件付きアクセス制御]** オプションを表示できない](#in-conditional-access-policies-you-cannot-see-the-conditional-access-app-control-option)
- [ポリシーを作成するときのエラー メッセージ: アプリがアプリの条件付きアクセス制御と共にデプロイされていません](#error-message-when-creating-a-policy-you-dont-have-any-apps-deployed-with-conditional-access-app-control)
- [アプリのセッション ポリシーを作成できない](#cannot-create-session-policies-for-an-app)
- [**検査方法** を選択できない: **データ分類サービス**](#cannot-choose-inspection-method-data-classification-service)
- [**アクション** を選択できない: **保護**](#cannot-choose-action-protect)
- [その他の考慮事項](#policies-additional-considerations)

#### <a name="in-conditional-access-policies-you-cannot-see-the-conditional-access-app-control-option"></a>条件付きアクセス ポリシーで、[アプリの条件付きアクセス制御] オプションを表示できない

セッションを Cloud App Security にルーティングするには、[アプリの条件付きアクセス制御] セッション制御を含めるように、Azure AD 条件付きアクセス ポリシーを構成する必要があります。

**推奨される手順**

- 条件付きアクセス ポリシーに **[アプリの条件付きアクセス制御]** オプションが表示されない場合は、有効な Cloud App Security ライセンスだけでなく、Azure AD Premium P1 の有効なライセンスがあることを確認してください。

#### <a name="error-message-when-creating-a-policy-you-dont-have-any-apps-deployed-with-conditional-access-app-control"></a>ポリシーを作成するときのエラー メッセージ: アプリがアプリの条件付きアクセス制御と共にデプロイされていません

アクセスまたはセッション ポリシーを作成するときに、次のエラー メッセージが表示される場合があります: "アプリがアプリの条件付きアクセス制御と共にデプロイされていません"。 このエラーは、アプリがデプロイされていないことを示します。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[アプリの条件付きアクセス制御]** を選択します。
1. **[No apps connected]\(アプリが接続されていません\)** というメッセージが表示された場合は、次のガイドを使用してアプリをデプロイします。

    - [セッション制御が有効になっているおすすめアプリをデプロイします](proxy-deployment-aad.md)
    - セッション制御を使用する Azure Active Directory (Azure AD) アプリケーション プロキシを介してホストされる[カスタムの基幹業務アプリ、おすすめ以外の SaaS アプリ、およびオンプレミスのアプリをデプロイします](proxy-deployment-any-app.md)
1. アプリのデプロイ中に問題が発生した場合は、「[アプリのオンボード](#onboarding-an-app)」を参照してください。

#### <a name="cannot-create-session-policies-for-an-app"></a>アプリのセッション ポリシーを作成できない

カスタム アプリを追加した後、 **[アプリの条件付きアクセス制御アプリ]** ページで、次のオプションが表示される場合があります: **要求セッション制御**。

> [!NOTE]
> [おすすめアプリ](proxy-intro-aad.md#session-controls)には、すぐに使えるセッション制御があります。 その他のすべてのアプリでは、セルフオンボード プロセスを実行する必要があります。

**推奨される手順**

1. 次のセルフオンボード ガイドを使用して、任意のアプリをセッション制御にデプロイします: セッション制御を使用する Azure Active Directory (Azure AD) アプリケーション プロキシを介してホストされる[カスタムの基幹業務アプリ、おすすめ以外の SaaS アプリ、およびオンプレミスのアプリをデプロイします](proxy-deployment-any-app.md)。
1. セッション ポリシーを作成し、 **[アプリ]** フィルターを選択して、アプリがドロップダウン リストに一覧表示されるようになったことを確認します。

#### <a name="cannot-choose-inspection-method-data-classification-service"></a>**検査方法** を選択できない: **データ分類サービス**

セッション ポリシーでは、 **[ファイル ダウンロードの制御 (検査を含む)]** というセッション制御の種類を使用する場合、**データ分類サービス** 検査方法を使用してファイルをリアル タイムでスキャンし、構成した任意の条件に一致する機密コンテンツを検出できます。 **データ分類サービス** 検査方法を使用できない場合は、次の手順を使用して問題を調査します。

**推奨される手順**

1. **[セッション制御の種類]** が **[ファイル ダウンロードの制御 (検査を含む)]** に設定されていることを確認します。

    > [!NOTE]
    > **データ分類サービス** 検査方法は、 **[ファイル ダウンロードの制御 (検査を含む)]** オプションでのみ使用できます。

1. お客様の [リージョン](dcs-inspection.md)で **データ分類サービス** 機能が使用可能かどうかを判断します。
    1. この機能がお客様のリージョンで使用できない場合は、**組み込みの DLP** 検査方法を使用します。
    1. この機能がお客様のリージョンで使用できても、**データ分類サービス** 検査方法を表示できない場合は、[サポート チケット](support-and-ts.md)を開きます。

#### <a name="cannot-choose-action-protect"></a>アクションを選択できない: 保護

セッション ポリシーでは、 **[ファイル ダウンロードの制御 (検査を含む)]** というセッション制御の種類を使用する場合、**監視** および **ブロック** アクションに加え、**保護** アクションを指定することができます。 このアクションでは、条件またはコンテンツの検査、あるいはその両方に基づいて、ファイルへのアクセス許可を暗号化または適用するオプションを使用して、ファイルのダウンロードを許可することができます。 **保護** アクションが使用できない場合は、次の手順を使用して問題を調査します。

**推奨される手順**

1. **保護** アクションが使用できないか、灰色表示になっている場合は、Azure Information Protection (AIP) Premium P1 ライセンスがあることを確認します。 詳しくは、「[Azure Information Protection の統合](azip-integration.md)」をご覧ください。
1. **保護** アクションが使用可能でも、適切なラベルが表示されない場合。
    1. Cloud App Security で、メニュー バーの設定歯車をクリックし、 **[Azure Information Protection]** を選択して、AIP 統合が有効になっていることを確認します。
    1. Office ラベルの場合は、AIP ポータルで、 **[統合ラベル付け]** が選択されていることを確認します。

<a name="policies-additional-considerations"></a>

#### <a name="additional-considerations"></a>その他の考慮事項

アプリのオンボードのトラブルシューティングには、いくつかの追加の考慮事項があります。

- **Azure AD 条件付きアクセス ポリシー設定の違いを理解する: [監視のみ]、[ダウンロードをブロックする]、および [カスタムポリシーを使用する]**

    Azure AD 条件付きアクセス ポリシーでは、次の組み込みの Cloud App Security 制御を構成できます: **[監視のみ]** および **[ダウンロードをブロックする]** 。 これにより、Azure AD で構成されたクラウド アプリと状態に対して Cloud App Security プロキシ機能が適用され、強制されます。 より複雑なポリシーの場合は、 **[カスタム ポリシーを使用する]** を選択します。これにより、Cloud App Security でアクセスおよびセッション ポリシーを構成できます。

- **アクセス ポリシーの [モバイルとデスクトップ] クライアント アプリのフィルター オプションを理解する**

    Cloud App Security アクセス ポリシーでは、 **[クライアント アプリ]** フィルターが **[モバイルとデスクトップ]** に明示的に設定されていない限り、結果のアクセス ポリシーはブラウザー セッションにのみ適用されます。 このようになる理由は、誤ってユーザー セッションがプロキシされないようにするためです。これは、このフィルターを使用したときの副産物である可能性があります。

## <a name="issues-experienced-by-end-users"></a>エンド ユーザーが経験する問題

このセクションは、Cloud App Security によって保護されたアプリを使用するエンド ユーザーを対象としており、次の領域で発生する可能性がある一般的な状況を特定するのに役立ちます。

- [[ユーザーの監視] ページが表示されない](#user-monitoring-page-is-not-appearing)
- [サードパーティ ID プロバイダーからアプリにアクセスできない](#not-able-to-access-app-from-a-third-party-identity-provider)
- [ **[問題が発生しました]** ページが表示される](#something-went-wrong-page-appears)
- [クリップボードのアクションやファイル制御がブロックされていない](#clipboard-actions-or-file-controls-are-not-being-blocked)
- [ダウンロードが保護されていない](#downloads-are-not-being-protected)
- [サフィックスが付いたアプリの特定の URL への移動と汎用ページへのランディング](#navigating-to-a-particular-url-of-a-suffixed-app-and-landing-on-a-generic-page)
- [その他の考慮事項](#app-additional-considerations)

### <a name="user-monitoring-page-is-not-appearing"></a>[ユーザーの監視] ページが表示されない

Cloud App Security を介してユーザーをルーティングする場合は、セッションが監視されることをユーザーに通知できます。 既定では、[ユーザーの監視] ページが有効になります。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[設定]** を選択します。
1. **[アプリの条件付きアクセス制御]** で、 **[ユーザーの監視]** を選択します。 このページには、Cloud App Security で使用できるユーザーの監視オプションが表示されます。

    ![ユーザーの監視オプションを示すスクリーンショット](media/proxy-user-monitoring.png)

1. **[ユーザーのアクティビティが監視されていることをユーザーに通知します]** オプションが選択されていることを確認します。
1. 既定のメッセージを使用するか、カスタム メッセージを指定するかを選択します。

    | メッセージの種類 | 詳細 |
    | --- | --- |
    | Default | **ヘッダー**:<br />[ここにはアプリ名が示されます] へのアクセスが監視されます<br />**本文**:<br />セキュリティを強化するために、組織では [ここにはアプリ名が示されます] へのアクセスをモニター モードで許可します。 アクセスを利用できるのは Web ブラウザーからのみとなります。 |
    | カスタム | **ヘッダー**:<br />このボックスを使用して、ユーザーが監視されていることをユーザーに通知するカスタムの見出しを指定します。<br />**本文**:<br />このボックスを使用して、質問の問い合わせ先など、ユーザーに対するカスタム情報をさらに追加します。サポートされる入力は、プレーン テキスト、リッチ テキスト、ハイパーリンクです。 |
1. アプリにアクセスする前に表示されるユーザーの監視ページを確認するには、 **[プレビュー]** をクリックします。
1. **[Save]** (保存) をクリックします。

### <a name="not-able-to-access-app-from-a-third-party-identity-provider"></a>サードパーティ ID プロバイダーからアプリにアクセスできない

エンド ユーザーがサードパーティ ID プロバイダーからアプリにログインした後に、一般的なエラーが発生している場合は、サードパーティの IdP 構成を確認します。

**推奨される手順**

1. Cloud App Security で、メニュー バーの設定歯車をクリックしてから、 **[アプリの条件付きアクセス制御]** を選択します。
1. アプリの一覧で、アクセスできないアプリが表示されている行の末尾の 3 つのドットを選択し、 **[アプリの編集]** を選択します。
    1. アップロードされた SAML 証明書が正しいことを確認します
    1. 有効な SSO URL がアプリ構成に指定されていることを確認します
    1. カスタム アプリの属性と値が ID プロバイダーの設定に反映されていることを確認します  ![ID プロバイダーの SAML 情報を収集するページを示すスクリーンショット](media/proxy-deploy-add-idp-ext-conf.png)
1. それでもアプリにアクセスできない場合は、[サポート チケット](support-and-ts.md)を開いてください。

### <a name="something-went-wrong-page-appears"></a>[問題が発生しました] ページが表示される

プロキシ化されたセッション中に、 **[問題が発生しました]** ページが表示されることがあります。 これは、次の場合に発生することがあります。

1. しばらくアイドル状態になった後に、ユーザーがログインした
1. ブラウザーとページの読み込みの更新に予想よりも時間がかかった
1. サードパーティの IdP アプリが正しく構成されていない

**推奨される手順**

1. エンド ユーザーが、サードパーティの IdP を使用して構成されているアプリにアクセスしようとしている場合は、「[サードパーティの IdP からアプリにアクセスできない](#not-able-to-access-app-from-a-third-party-identity-provider)」と「[アプリの状態: セットアップの続行](#app-status-continue-setup)」を参照してください。
1. エンド ユーザーが予期せずこのページに到達した場合は、次のようにします。
    1. ブラウザー セッションを再開します
    1. ブラウザーから履歴、Cookie、キャッシュをクリアします

### <a name="clipboard-actions-or-file-controls-are-not-being-blocked"></a>クリップボードのアクションやファイル制御がブロックされていない

切り取り、コピー、貼り付けなどのクリップボードのアクション、およびダウンロード、アップロード、印刷などのファイル制御をブロックする機能は、データの流出および侵入シナリオを防ぐために必要です。 この機能により、企業ではエンド ユーザーのセキュリティと生産性のバランスを取ることができます。 これらの機能で問題が発生している場合は、次の手順を使用して問題を調査します。

**推奨される手順**

セッションがプロキシ化されている場合は、次の手順を使用してポリシーを確認します。

1. Cloud App Security の **[調査]** で、 **[アクティビティ ログ]** を選択します。
1. 高度なフィルターを使用して、 **[適用されたアクション]** を選択し、 **[ブロック]** に等しい値を設定します。
1. ブロックされたファイル アクティビティがあることを確認します。
    1. アクティビティがある場合は、アクティビティをクリックしてアクティビティ ドロワーを展開します。
    1. アクティビティ ドロワーの **[全般]** タブで、一致するポリシー リンクをクリックして、適用したポリシーが存在することを確認します。
    1. ポリシーが表示されない場合は、「[アクセスおよびセッション ポリシーの作成](#creating-access-and-session-policies)」を参照してください。
    1. **[[既定の動作] のためアクセスがブロックされました] または [[既定の動作] のためアクセスが許可されました]** と表示された場合、システムが停止し、既定の動作が適用されたことを示します。
        1. 既定の動作を変更するには、Cloud App Security で、メニュー バーの設定歯車をクリックし、 **[設定]** を選択します。 その後、 **[アプリの条件付きアクセス制御]** で、 **[既定の動作]** を選択し、アクセスを **許可** または **ブロック** するように既定の動作を設定します。
        1. `https://status.cloudappsecurity.com/` に移動して、システムのダウンタイムに関する通知を監視します。
1. それでもブロックされたアクティビティを表示できない場合は、[サポート チケット](support-and-ts.md)を開きます。

### <a name="downloads-are-not-being-protected"></a>ダウンロードが保護されていない

エンド ユーザーとして、アンマネージド デバイスで機密データをダウンロードする必要がある場合があります。 これらのシナリオでは、Azure Information Protection でドキュメントを保護できます。 エンド ユーザーがドキュメントを正常に暗号化できなかった場合は、次の手順を使用して問題を調査します。

**推奨される手順**

1. Cloud App Security の **[調査]** で、 **[アクティビティ ログ]** を選択します。
1. 高度なフィルターを使用して、 **[適用されたアクション]** を選択し、 **[保護]** に等しい値を設定します。
1. ブロックされたファイル アクティビティがあることを確認します。
    1. アクティビティがある場合は、アクティビティをクリックしてアクティビティ ドロワーを展開します。
    1. アクティビティ ドロワーの **[全般]** タブで、一致するポリシー リンクをクリックして、適用したポリシーが存在することを確認します。
    1. ポリシーが表示されない場合は、「[アクセスおよびセッション ポリシーの作成](#creating-access-and-session-policies)」を参照してください。
    1. **[[既定の動作] のためアクセスがブロックされました] または [[既定の動作] のためアクセスが許可されました]** と表示された場合、システムが停止し、既定の動作が適用されたことを示します。
        1. 既定の動作を変更するには、Cloud App Security のメニュー バーで設定歯車をクリックしてから、 **[設定]** を選択します。 その後、 **[アプリの条件付きアクセス制御]** で、 **[既定の動作]** を選択し、アクセスを **許可** または **ブロック** するように既定の動作を設定します。
        1. `https://status.cloudappsecurity.com/` に移動して、システムのダウンタイムに関する通知を監視します。
    1. AIP ラベルまたはカスタム アクセス許可でファイルを保護する場合は、 **[活動の説明]** で、ファイル拡張子が次のサポートされているファイルの種類のいずれかであることを確認してください。
        - Word: docm、docx、dotm、dotx
        - Excel: xlam、xlsm、xlsx、xltx
        - PowerPoint: potm、potx、ppsx、ppsm、pptm、pptx
        - PDF* 統合ラベル付けが有効になっている場合
    - ファイルの種類がサポートされていない場合は、セッション ポリシーで、 **[ネイティブ保護でサポートされていないファイルや、ネイティブの保護が失敗しているファイルのダウンロードをブロックします]** を選択できます。
1. それでもブロックされたアクティビティを表示できない場合は、[サポート チケット](support-and-ts.md)を開きます。

### <a name="navigating-to-a-particular-url-of-a-suffixed-app-and-landing-on-a-generic-page"></a>サフィックスが付いたアプリの特定の URL への移動と汎用ページへのランディング

URL にサフィックスを付けるすべてのプロキシは、コンテキストの損失、つまり、リンクに移動するとリンクの完全なパスが失われて通常はアプリのホーム ページにランディングする、という問題の影響を受けやすくなります。 Cloud App Security は、Microsoft および Microsoft 以外のベンダーと提携してこの制限に対処しコンテキストの損失を解決するという、独自の役割を負っています。

おすすめアプリ ページ上で **(プレビュー)** としてマークされているアプリは、コンテキストの損失による影響を受ける可能性があります。 同様に、サードパーティの Cookie やクロスサイト トラッキングをブロックするグローバル ポリシーによってコンテキストが失われる可能性があります。 この問題を解決するには、これらのオプションを無効にします。 おすすめアプリ以外でコンテキストの損失が発生している場合は、サポート チケットを送信してください。 これらの主要な問題を修正するために、各アプリ プロバイダーと個別に協力して作業しています。

一時的な軽減策として、次の方法でコンテキスト損失の問題を回避することができます。

1. コンテキストの損失が発生した URL に移動します。
1. Cloud App Security によって追加されたサフィックスを含む、サフィックスが付いた URL ドメインをメモしておきます (例: `https://www.yammer.com.mcas.ms`)。
1. 元の URL からパスをコピーします。たとえば、元の特定の URL が `https://www.yammer.com/organization/threads/threadnumber` の場合、`/organization/threads/threadnumber` をコピーします。
1. コピーしたパスをサフィックスの付いたドメインに追加します (例: `https://www.yammer.com.mcas.ms/organization/threads/threadnumber`)。
1. サフィックスが付いた新しい URL に移動します。

<a name="app-additional-considerations"></a>

### <a name="additional-considerations"></a>その他の考慮事項

アプリのトラブルシューティングには、いくつかの追加の考慮事項があります。

- **最新のブラウザーでのセッション制御のサポート**

    Cloud App Security セッション制御に、Chromium に基づく新しい Microsoft Edge ブラウザーのサポートが追加されました。 最新バージョンの Internet Explorer と以前のバージョンの Microsoft Edge は引き続きサポートされますが、サポートは制限されるため、新しい Microsoft Edge ブラウザーを使用することをお勧めします。

- **ダブル ログイン**

    ダブル ログインは、nonce の使用が想定されているために発生します。これは、リプレイ攻撃を防ぐためにアプリによって使用される暗号化トークンです。 Cloud App Security では、既定で、アプリによって nonce が使用されることが前提となります。 アプリによって nonce が使用されないことを確信できる場合は、Cloud App Security でアプリを編集することでこれを無効にすることができ、問題は解決されます。 nonce を無効にする手順については、「[遅いログイン](#slow-login)」を参照してください。

    アプリによって nonce が使用され、この機能を無効にできない場合は、2 回目のログインがユーザーに対して透過的である可能性があるか、もう一度ログインするように求められることがあります。

- **PDF ファイルのプレビューまたは印刷がブロックされることがある**

    これは、ダウンロードをブロックするようにポリシーが構成されている場合の通常の動作です。 PDF ファイルをプレビューまたは印刷するときに、アプリによってファイルのダウンロードが開始されることがあります。これにより、Cloud App Security では、確実にダウンロードがブロックされ、データがご利用の環境から漏えいしないように対処します。

    PDF ファイルのダウンロードを許可する場合は、関連するセッション ポリシーで PDF ファイルをそのファイル拡張子に基づいて除外できます。
