---
title: すべてのアプリに Cloud App Security アプリの条件付きアクセス制御をデプロイする
description: この記事では、すべてのアプリのリバースプロキシ機能アプリの条件付きアクセス制御 Microsoft Cloud App Security を展開する方法について説明します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 9/23/2019
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.suite: ems
ms.openlocfilehash: 25bbe485406d0c5df0bb9f60b479e4e159d095ff
ms.sourcegitcommit: 3f6ef6b97a0953470135d115323a00cf11441ab7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/08/2020
ms.locfileid: "78927732"
---
# <a name="onboard-and-deploy-conditional-access-app-control-for-any-app"></a>アプリのアプリの条件付きアクセス制御をオンボードしてデプロイする

*適用対象: Microsoft Cloud App Security*

Microsoft Cloud App Security のセッション制御は、任意の web アプリで動作するように構成できます。 この記事では、カスタムの基幹業務アプリ、非機能の SaaS アプリ、および Azure Active Directory (Azure AD) アプリケーションプロキシを使用してホストされているオンプレミスのアプリをセッションコントロールでオンボードする方法について説明します。

Cloud App Security で利用できるアプリの一覧については、「 [Microsoft Cloud App Security アプリの条件付きアクセス制御を使用](proxy-intro-aad.md#featured-apps)したアプリの保護」を参照してください。

## <a name="prerequisites"></a>前提条件

- アプリの条件付きアクセス制御を使用するには、組織が次のライセンスを持っている必要があります。

  - Azure Active Directory Premium P1 以降
  - Microsoft Cloud App Security

- アプリは、でシングルサインオンを使用して構成する必要があり Azure AD
- アプリは SAML または Open ID Connect 2.0 プロトコルを使用する必要があります

## <a name="to-deploy-any-app"></a>アプリを展開するには

次の手順に従って、Cloud App Security アプリの条件付きアクセス制御によって制御されるようにアプリを構成します。

**手順 1: [Azure AD 条件付きアクセスポリシーを構成して、関連するアプリを Cloud App Security にルーティングする](#conf-azure-ad)**

**手順 2:[アプリを展開するユーザーを構成する](#conf-users)**

**手順 3:[展開するアプリを構成](#conf-app)する**

**手順 4:[アプリが正常に動作していることを確認する](#verify-app)**

**手順 5:[組織で使用するアプリを有効にする](#enable-app)**

**手順 6: [Azure AD ポリシーを更新する](#update-azure-ad)**

> [!NOTE]
> Azure AD アプリのアプリの条件付きアクセス制御をデプロイするには、 [Azure Active Directory Premium P1 以上の](https://docs.microsoft.com/azure/active-directory/license-users-groups)有効なライセンスと Cloud App Security ライセンスが必要です。

## 手順 1: Azure AD 条件付きアクセスポリシーを構成して、関連するアプリを Cloud App Security にルーティングする<a name="conf-azure-ad"></a>  

1. Azure AD では、ブラウザーから**セキュリティ** > **条件付きアクセス**を使用します。

1. **[条件付きアクセス]** ブレードの上部にあるツールバーで、 **[新しいポリシー]** をクリックします。

1. **[新規]** ブレードの **[名前]** ボックスに、ポリシー名を入力します。

1. **[割り当て]** で **[ユーザーとグループ]** をクリックし、アプリのオンボード (初期サインオンと検証) するユーザーを割り当てて、 **[完了]** をクリックします。

1. **[割り当て]** で **[クラウドアプリ]** をクリックし、アプリの条件付きアクセス制御によって制御するアプリを割り当てて、 **[完了]** をクリックします。

1. **[アクセス制御]** の **[セッション]** をクリックし、 **[アプリの条件付きアクセス制御の使用]** を選択して組み込みのポリシーを選択します (**モニターのみ**または**ダウンロードをブロック**します)。または、**カスタムポリシーを使用**して Cloud App Security で詳細ポリシーを設定し、 **[選択]** をクリックします。

    ![Azure AD 条件付きアクセス](media/azure-ad-caac-policy.png)

1. 省略可能: 条件を追加し、必要に応じてコントロールを許可します。

1. **[ポリシーを有効]** にする を **[オン**] に設定し、 **[作成]** をクリックします。

## 手順 2: アプリを展開するユーザーを構成する<a name="conf-users"></a>

1. Cloud App Security のメニューバーで、[設定] 歯車![設定アイコン](media/settings-icon.png "設定アイコン")をクリックし、 **[設定]** を選択します。

1. **アプリの条件付きアクセス制御**で、**アプリのオンボード/メンテナンス** を選択します。

1. アプリをオンボードするユーザーのユーザープリンシパル名または電子メールアドレスを入力し、 **[保存]** をクリックします。

    ![アプリのオンボードとメンテナンスの設定のスクリーンショット。](media/app-onboarding-settings.png)

## 手順 3: 展開するアプリを構成する<a name="conf-app"></a>

デプロイするアプリにアクセスします。 表示されるページは、アプリが認識されているかどうかによって異なります。 以下のいずれかを実行します。

| アプリの状態 | 説明 | 手順 |
| --- | --- | --- |
| 認識できません | アプリを構成するよう求める画面が表示されません。 | 1.[アプリの条件付きアクセス制御にアプリを追加](#add-app)します。<br /> 2.[アプリのドメインを追加](#add-domains)し、アプリに戻り、ページを最新の状態に更新します。<br /> 3.[アプリの証明書をインストール](#install-certs)します。 |
| ら | アプリの構成プロセスを続行するように求めるオンボードページが表示されます。 | [アプリの証明書](#install-certs)を - インストールします。 <br /><br /> **注:** アプリが正常に機能するために必要なすべてのドメインを使用してアプリが構成されていることを確認します。 追加のドメインを構成するには、「[アプリのドメインを追加](#add-domains)する」に進み、アプリのページに戻ります。 |

### 新しいアプリを追加するには<a name="add-app"></a>

1. メニューバーで、[設定] 歯車![設定アイコン](media/settings-icon.png "設定アイコン")をクリックし、 **[アプリの条件付きアクセス制御]** を選択します。

1. **[新しいアプリの表示]** をクリックします。

    ![条件付きアクセスアプリコントロールの新しいアプリの表示](media/caac-view-apps.png)

1. 開いた画面に、新しいアプリの一覧が表示されます。 オンボードするアプリごとに、 **+** 記号をクリックし、 **[追加]** をクリックします。

    > [!NOTE]
    > アプリが Cloud App Security アプリカタログに表示されない場合、アプリは [不明なアプリ] の下のログイン URL と共にダイアログに表示されます。 これらのアプリの + 記号をクリックすると、カスタムアプリとしてアプリケーションをオンボードできます。

    ![アプリの条件付きアクセスコントロールが Azure AD 検出されました](media/caac-discovered-aad-apps.png)

### アプリのドメインを追加するには<a name="add-domains"></a>

適切なドメインをアプリに関連付けることにより、Cloud App Security はポリシーと監査アクティビティを適用できます。

たとえば、関連付けられているドメインのファイルのダウンロードをブロックするポリシーを構成した場合、そのドメインからのアプリによるファイルのダウンロードはブロックされます。 ただし、アプリに関連付けられていないドメインからのファイルのダウンロードはブロックされず、操作はアクティビティログで監査されません。
> [!NOTE]
> Cloud App Security は、シームレスなユーザーエクスペリエンスを確保するために、アプリに関連付けられていないドメインにサフィックスを追加します。

1. アプリ内の Cloud App Security 管理ツールバーで、[検出された**ドメイン**] をクリックします。
    > [!NOTE]
    > 管理ツールバーは、アプリをオンボードまたはメンテナンスするアクセス許可を持つユーザーにのみ表示されます。
1. [検出されたドメイン] パネルで、ドメイン名を書き留めます。または、一覧を .csv ファイルとしてエクスポートします。
    > [!NOTE]
    > パネルには、アプリに関連付けられていない、検出されたドメインの一覧が表示されます。 ドメイン名は完全修飾されています。
1. Cloud App Security にアクセスし、メニューバーの [設定] 歯車![設定アイコン](media/settings-icon.png "設定アイコン")をクリックして、 **[アプリの条件付きアクセス制御]** を選択します。
1. アプリの一覧で、デプロイするアプリが表示されている行に、行の末尾にある3つの点を選択し、 **[アプリの詳細]** で **[編集]** を選択します。
    > [!TIP]
    > アプリで構成されているドメインの一覧を表示するには、 **[アプリドメインの表示]** をクリックします。
1. **[ユーザー定義ドメイン]** で、このアプリに関連付けるすべてのドメインを入力し、 **[保存]** をクリックします。
    > [!NOTE]
    > \* ワイルドカード文字は、任意の文字のプレースホルダーとして使用できます。 ドメインを追加するときに、特定のドメイン (`sub1.contoso.com`、`sub2.contoso.com`) または複数のドメイン (`*.contoso.com`) を追加するかどうかを決定します。

### ルート証明書をインストールするには<a name="install-certs"></a>

1. 次の手順を繰り返して、**現在の ca**と**次の ca**の自己署名ルート証明書をインストールします。
    1. 証明書を選択します。
    1. **[開く]** をクリックし、メッセージが表示されたらもう一度 **[開く]** をクリックします。
    1. **[証明書のインストール]** をクリックします。
    1. **[現在のユーザー]** または **[ローカルコンピューター]** を選択します。
    1. **[証明書をすべて次のストアに配置する]** を選択し、 **[参照]** をクリックします。
    1. **[信頼されたルート証明機関]** を選択し、 **[OK]** をクリックします。
    1. **[完了]** をクリックします。

    > [!NOTE]
    > 証明書が認識されるようにするには、証明書をインストールしたら、ブラウザーを再起動して同じページにアクセスする必要があります。<!-- You'll see a check-mark by the certificates links confirmation they are installed.-->

1. **[続行]** をクリックします。

## 手順 4: アプリが正常に動作していることを確認する<a name="verify-app"></a>

1. サインインフローが正しく機能することを確認します。
    <!--
    > [!NOTE]
    > Some apps issue a nonce hash during authentication that may break the sign-in process. If this happens, see the Troubleshooting Guide to resolve the issue.-->
1. アプリを作成したら、次のチェックを実行します。
    1. ユーザーの作業プロセスの一部であるアプリ内のすべてのページにアクセスし、ページが正しく表示されることを確認します。
    1. ファイルのダウンロードやアップロードなどの一般的な操作を実行することで、アプリの動作と機能が悪影響を受けないことを確認します。
    1. アプリに関連付けられているドメインの一覧を確認します。 詳細については、「[アプリのドメインを追加](#add-domains)する」を参照してください。

## 手順 5: 組織で使用するアプリを有効にする<a name="enable-app"></a>

組織の運用環境でアプリを使用できるようにする準備ができたら、次の手順を実行します。

1. Cloud App Security で、[設定] 歯車![設定アイコン](media/settings-icon.png "設定アイコン")をクリックし、 **[アプリの条件付きアクセス制御]** を選択します。
1. アプリの一覧で、展開するアプリが表示されている行で、行の末尾にある3つの点を選択し、 **[アプリの編集]** を選択します。
1. **[アプリの条件付きアクセス制御で使用する]** を選択し、 **[保存]** をクリックします。

## 手順 6: Azure AD ポリシーを更新する<a name="update-azure-ad"></a>

1. Azure AD の **[セキュリティ]** で、 **[条件付きアクセス]** をクリックします。
1. 前の手順で作成したポリシーを更新して、必要なユーザー、グループ、およびコントロールを追加します。
1. [**セッション** > **使用アプリの条件付きアクセス制御**] で、[**カスタムポリシーを使用**する] を選択した場合は Cloud App Security にアクセスし、対応するセッションポリシーを作成します。 詳しくは、「[セッション ポリシー](session-policy-aad.md)」をご覧ください。

## <a name="next-steps"></a>次のステップ:

> [!div class="nextstepaction"]
> [« PREVIOUS: おすすめアプリ用にアプリの条件付きアクセス制御をデプロイする](proxy-deployment-aad.md)

> [!div class="nextstepaction"]
> [次の手順: セッションポリシーを作成する方法»](session-policy-aad.md)

## <a name="see-also"></a>参照

> [!div class="nextstepaction"]
> [アプリの条件付きアクセス制御の概要](proxy-intro-aad.md)

[!INCLUDE [Open support ticket](includes/support.md)]
