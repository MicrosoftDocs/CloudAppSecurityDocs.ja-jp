---
title: SIEM 統合のトラブルシューティング - Cloud App Security
description: この記事では、SIEM を Cloud App Security に接続した場合に発生する可能性のある問題のリストと、それぞれに対する解決策を提供します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 06/29/2020
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: c7d2a5357273bcefd74db69208b874b21e8169a0
ms.sourcegitcommit: e711727f2f00ee3b54e08337a5040449e352ca46
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2020
ms.locfileid: "93186191"
---
# <a name="troubleshooting-the-siem-agent"></a>SIEM エージェントのトラブルシューティング

[!INCLUDE [Banner for top of topics](includes/banner.md)]

この記事では、SIEM を Cloud App Security に接続した場合に発生する可能性のある問題のリストと、考えられる解決策を提供します。

## <a name="recover-missing-activity-events-in-cloud-app-security-siem-agent"></a>Cloud App Security SIEM エージェントで不足しているアクティビティ イベントを回復する

続行する前に、構成しようとしている SIEM 統合が [Cloud App Security ライセンス](https://aka.ms/mcaslicensing)でサポートされていることを確認してください。

SIEM エージェントによるアクティビティ配信の問題に関するシステム アラートを受け取った場合は、次の手順に従って、問題が発生した時間枠内でアクティビティ イベントを回復します。 次の手順では、並列で実行される新しい Recovery SIEM エージェントを設定し、SIEM にアクティビティ イベントを再送信する方法を説明します。

> [!NOTE]
> 回復プロセスでは、システム アラートに記載されている時間枠内にすべてのアクティビティ イベントが再送信されます。 SIEM にこの時間枠のアクティビティ イベントが既に含まれている場合は、この回復後にイベントの重複が発生します。

### <a name="step-1--configure-a-new-siem-agent-in-parallel-to-your-existing-agent"></a>ステップ 1 - 既存のエージェントと並行して新しい SIEM エージェントを構成する

1. Cloud App Security ポータルで、[セキュリティ拡張機能] ページにアクセスします。
1. [SIEM エージェント] タブで、[[新しい SIEM エージェントの追加]](siem.md) をクリックし、ウィザードを使用して、SIEM への接続の詳細を構成します。 たとえば、次の構成で新しい SIEM エージェントを作成できます。
    - **Protocol** :TCP
    - **[リモート ホスト]** : ポートをリッスンできる任意のデバイス。 たとえば、シンプルなソリューションでは、エージェントと同じデバイスを使用し、リモート ホストの IP アドレスを 127.0.0.1 に設定します
    - **[ポート]** :リモート ホスト デバイスでリッスンできる任意のポート

    > [!NOTE]
    > このエージェントは、既存のエージェントと並行して実行する必要があるため、ネットワーク構成が同じではない可能性があります。

1. ウィザードで、 **アクティビティのみ** が含まれるようにデータ型を構成し、元の SIEM エージェント (存在する場合) で使用されていたのと同じアクティビティ フィルターを適用します。
1. 設定を保存します。
1. 生成されたトークンを使用して、新しいエージェントを実行します。

### <a name="step-2--validate-the-successful-data-delivery-to-your-siem"></a>ステップ 2 – SIEM へのデータ配信が成功したことを検証する

構成を検証するには、次の手順を使用します。

1. SIEM に接続し、構成した新しい SIEM エージェントから新しいデータを受信したことを確認します。

> [!NOTE]
> エージェントによって、アラートを受け取った問題の時間枠のアクティビティのみが送信されます。

1. SIEM がデータを受信しない場合は、新しい SIEM エージェント デバイスで、アクティビティを転送するように構成したポートをリッスンして、データがエージェントから SIEM に送信されているかどうかを確認します。 たとえば、`netcat -l <port>` を実行します。ここで `<port>` は以前に構成したポート番号です。

> [!NOTE]
> `ncat` を使用する場合は、必ず ipv4 フラグ `-4` を指定してください。

1. エージェントによってデータが送信されているが、SIEM によって受信されていない場合は、SIEM エージェント ログを確認します。 "接続が拒否されました" というメッセージを確認できる場合は、SIEM エージェントが TLS 1.2 以降を使用するように構成されていることを確認します。

### <a name="step-3--remove-the-recovery-siem-agent"></a>ステップ 3 – Recovery SIEM エージェントを削除する

1. Recovery SIEM エージェントは、終了日に達すると、データの送信を自動的に停止し、無効になります。
1. SIEM で、Recovery SIEM エージェントによって新しいデータが送信されていないことを確認します。
1. お使いのデバイスでエージェントの実行を停止します。
1. ポータルで、SIEM エージェントのページに移動し、Recovery SIEM エージェントを削除します。
1. 元の SIEM エージェントが正常に実行されていることを確認します。

## <a name="general-troubleshooting"></a>一般的なトラブルシューティング

Microsoft Cloud App Security ポータルで SIEM エージェントの状態が **[接続エラー]** または **[切断]** ではないこと、およびエージェント通知がないことを確認します。 接続が 2 時間以上ダウンしている場合は、状態が **[接続エラー]** と表示されます。 接続が 12 時間以上ダウンしている場合は、状態が **[切断]** に変わります。

エージェントの実行中に、コマンド プロンプトで次のいずれかのエラーが表示された場合は、次の手順を使用して問題を修復します。

|エラー|説明|解決策|
|----|----|----|
|ブートストラップ中の一般エラー|エージェントのブートストラップ中に予期しないエラーが発生しました。|サポートにお問い合わせください。|
|重大なエラーが多すぎる|コンソールへの接続中に発生した重大なエラーが多すぎます。 シャットダウンしています。|サポートにお問い合わせください。|
|トークンが無効|指定されたトークンは無効です。|正しいトークンをコピーしたことを確認してください。 上記のプロセスを使用して、トークンを再生成することができます。|
|無効なプロキシ アドレス|指定されたプロキシ アドレスは無効です。|正しいプロキシとポートが入力されていることを確認してください。|

エージェントを作成したら、Cloud App Security ポータルの SIEM エージェント ページを確認します。 次の **エージェント通知** のいずれかが表示された場合は、次の手順を使用して問題を修復します。

|エラー|説明|解決策|
|----|----|----|
|**内部エラー**|SIEM エージェントで不明な問題が発生しました。|サポートにお問い合わせください。|
|**データ サーバー送信エラー**|このエラーは、TCP 経由で Syslog サーバーを使用している場合に発生する場合があります。 SIEM エージェントが Syslog サーバーに接続できません。  このエラーが発生した場合、修正されるまでエージェントによって新しいアクティビティのプルが停止されます。 エラーが表示されなくなるまで、修復手順に従ってください。|1.Syslog サーバーが正しく定義されていることを確認する: Cloud App Security UI で、前述のように SIEM エージェントを編集します。 サーバーの名前が正しく記述されていることを確認し、適切なポートを設定します。 </br>2.Syslog サーバーへの接続を確認する: ファイアウォールによって通信がブロックされていないことを確認します。|
|**データ サーバー接続エラー**| このエラーは、TCP 経由で Syslog サーバーを使用している場合に発生する場合があります。 SIEM エージェントが Syslog サーバーに接続できません。  このエラーが発生した場合、修正されるまでエージェントによって新しいアクティビティのプルが停止されます。 エラーが表示されなくなるまで、修復手順に従ってください。|1.Syslog サーバーが正しく定義されていることを確認する: Cloud App Security UI で、前述のように SIEM エージェントを編集します。 サーバーの名前が正しく記述されていることを確認し、適切なポートを設定します。 </br>2.Syslog サーバーへの接続を確認する: ファイアウォールによって通信がブロックされていないことを確認します。|
|**SIEM エージェントのエラー**|SIEM エージェントが X 時間以上切断されています|Cloud App Security ポータルで SIEM 構成が変更されていないことを確認してください。 それ以外の場合、このエラーは、Cloud App Security と SIEM エージェントを実行しているコンピューター間の接続の問題を示している可能性があります。|
|**SIEM エージェントの通知エラー**|SIEM エージェントの通知転送エラーを SIEM エージェントから受信しました。|このエラーは、SIEM エージェントと SIEM サーバー間の接続に関するエラーを受け取ったことを示します。 ファイアウォールによって SIEM サーバーまたは SIEM エージェントを実行しているコンピューターがブロックされていないことを確認します。 また、SIEM サーバーの IP アドレスが変更されていないことを確認します。|

## <a name="next-steps"></a>次のステップ

> [!div class="nextstepaction"]
> [クラウド環境を保護するための日常的な作業](daily-activities-to-protect-your-cloud-environment.md)

[!INCLUDE [Open support ticket](includes/support.md)]
