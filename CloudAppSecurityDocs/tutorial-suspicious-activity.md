---
title: 行動分析 (UEBA) を使用して疑わしいユーザー アクティビティを検出する
description: このチュートリアルでは、Microsoft Cloud App Security でユーザー アクティビティの検出をチューニングするプロセスについて説明します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 05/10/2020
ms.topic: tutorial
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: galz
ms.suite: ems
ms.openlocfilehash: 00646b44cb9c2095e3beaaa98f3528c6eb7b31db
ms.sourcegitcommit: cc283f0ecf8124953f1f71181655603de6846d8c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/28/2020
ms.locfileid: "87254824"
---
# <a name="tutorial-detect-suspicious-user-activity-with-ueba"></a>チュートリアル:UEBA を使用して疑わしいユーザー アクティビティを検出する

*適用対象:Microsoft Cloud App Security*

Microsoft Cloud App Security は、侵害されたユーザー、内部の脅威、流出、ランサムウェアなどに対する攻撃キル チェーン全体にクラス最高の検出を提供します。 この包括的なソリューションは、ユーザーが環境内でどのようにアプリを使用しているかについて幅広い視野を提供するため、異常検出、行動分析 (UEBA)、ルールベースのアクティビティ検出などの複数の検出方法を組み合わせることで実現されています。

では、疑わしい動作を検出することが重要なのはなぜでしょう。 ユーザーがクラウド環境を変更できることは、重大な影響を及ぼし、事業の運営能力に直接影響を及ぼす可能性があります。 たとえば、自社のパブリック Web サイトや顧客に提供しているサービスを実行しているサーバーなどの主要な企業リソースが侵害される可能性があります。

Cloud App Security では、複数のソースからキャプチャされたデータを使用して、データを分析し、セキュリティ アナリストがクラウドの使用状況を把握できるように組織内のアプリとユーザー アクティビティを抽出します。 収集されたデータは、疑わしいアクティビティの正確で一貫性のあるビューを提供するため、脅威インテリジェンス、場所、およびその他の詳細情報に関連付けられ、標準化され、強化されます。

そのため、これらの検出の利点を完全に理解するには、まず次のソースを構成する必要があります。

* **[アクティビティ ログ](activity-filters.md)**  
[API に接続されているアプリ](enable-instant-visibility-protection-and-governance-actions-for-your-apps.md)のアクティビティ。
* **[検出ログ](tutorial-shadow-it.md)**  
ファイアウォールから抽出されたアクティビティと Cloud App Security に転送されるプロキシのトラフィック ログ。 ログは、[クラウド アプリ カタログ](risk-score.md)に従って分析され、順位付けされ、80 のリスク要因に基づいてスコア付けされます。
* **[プロキシ ログ](proxy-intro-aad.md)**  
[アプリの条件付きアクセス制御アプリ](tutorial-proxy.md#phase-1-monitor-user-activities-for-anomalies)からのアクティビティ。

次に、ポリシーを調整します。 次のポリシーは、フィルター、動的しきい値 (UEBA) を設定することによって微調整でき、検出モデルのトレーニングや一般的な誤検知の検出を減らすための抑制に役立てることができます。

* 異常検出
* Cloud Discovery 異常検出
* ルールベースのアクティビティ検出

このチュートリアルでは、ユーザー アクティビティ検出を調整して真の侵害を特定し、大量の誤検知を処理することによるアラート疲れを減らす方法について説明します。

> [!div class="checklist"]
>
> * IP アドレス範囲を構成する
> * 異常検出ポリシーを調整する
> * Cloud Discovery 異常検出ポリシーを調整する
> * ルールベースの検出ポリシーを調整する
> * アラートを構成する
> * 調査して修正する

## <a name="phase-1-configure-ip-address-ranges"></a>フェーズ 1:IP アドレス範囲を構成する

個々のポリシーを構成する前に、任意の種類の疑わしいユーザー アクティビティ検出ポリシーの微調整に使用できるように、IP 範囲を構成することをお勧めします。

IP アドレス情報はほぼすべての調査に不可欠であるため、[既知の IP アドレスを構成する](ip-tags.md)ことで、Microsoft の機械学習アルゴリズムが既知の場所を特定し、それらを機械学習モデルの一部として見なすのに役立ちます。 たとえば、ご使用の VPN の IP アドレス範囲を追加すると、モデルがこの IP 範囲を正しく分類し、VPN の場所がそのユーザーの本当の場所を表していないという理由で、それをあり得ない移動検出から自動的に除外することができます。

注:構成された IP 範囲は検出に限定されず、アクティビティ ログのアクティビティ、条件付きアクセスなどの領域で Cloud App Security 全体で使用されます。範囲を構成するときは、この点に注意してください。 たとえば、物理的なオフィスの IP アドレスを特定することで、ログとアラートの表示と調査の方法をカスタマイズできます。

### <a name="review-out-of-the-box-anomaly-detection-alerts"></a>すぐに使える異常検出のアラートを確認する

Cloud App Security には、さまざまなセキュリティ シナリオを識別するための異常検出アラートのセットが含まれています。 これらの検出は自動的に有効になり、関連する[アプリ コネクタ](enable-instant-visibility-protection-and-governance-actions-for-your-apps.md)が接続されるとすぐに、ユーザー アクティビティのプロファイルとアラートの生成が開始されます。

まず、[さまざまな検出ポリシー](control-cloud-apps-with-policies.md)について理解し、ご自分の組織に最も関連性が高いと思われるシナリオに優先順位を付け、それに応じてポリシーを調整します。

## <a name="phase-2-tune-anomaly-detection-policies"></a>フェーズ 2:異常検出ポリシーを調整する

Cloud App Security では、一般的なセキュリティのユース ケース向けに事前に構成された、組み込みの異常検出ポリシーがいくつか用意されています。 いくらか時間をかけて、次のような一般的な検出について理解してください。

* **あり得ない移動**  
2 つの場所間の予想される移動時間より短い時間内に、異なる場所での同じユーザーからのアクティビティ。
* **頻度の低い国からのアクティビティ**  
そのユーザーまたは組織内のどのユーザーも最近または一度もアクセスしていない場所からのアクティビティ。
* **マルウェアの検出**  
クラウド アプリ内のファイルをスキャンして、Microsoft の脅威インテリジェンス エンジンを使用して不審なファイルを実行して、それらが既知のマルウェアに関連付けられているかどうかを判断します。
* **ランサムウェアのアクティビティ**  
ランサムウェアに感染している可能性があるクラウドへのファイルのアップロード。
* **不審な IP アドレスからのアクティビティ**  
Microsoft 脅威インテリジェンスによってリスクとして識別されている IP アドレスからのアクティビティ。
* **受信トレイからの疑わしい転送**  
ユーザーの受信トレイに設定されている疑わしい受信トレイの転送ルールを検出します。
* **通常とは異なる複数ファイルのダウンロード アクティビティ**  
学習済みベースラインに関して、1 回のセッションでの複数のファイル ダウンロード アクティビティを検出します。これは、侵害未遂を示している可能性があります。
* **通常とは異なる管理アクティビティ**  
学習済みベースラインに関して、1 回のセッションでの複数の管理アクティビティを検出します。これは、侵害未遂を示している可能性があります。

検出とその実行内容の完全な一覧については、「[異常検出ポリシー](anomaly-detection-policy.md#anomaly-detection-policies)」を参照してください。

ポリシーについて理解したら、さらに調査する必要があるアクティビティをより絞り込むために、組織固有の要件に合わせてポリシーを微調整する方法を検討する必要があります。

1. **特定のユーザーまたはグループに対してポリシーのスコープを設定する**

    特定のユーザーに対してポリシーのスコープを設定することで、自分の組織に関係ないアラートからのノイズを減らすことができます。 各ポリシーは、次の例のように、[特定のユーザーとグループを含めるか除外するように構成する](anomaly-detection-policy.md#scope-anomaly-detection-policies)ことができます。

    * **攻撃のシミュレーション**  
    多くの組織では、ユーザーまたはグループを使用して、常に攻撃をシミュレートしています。 当然ながら、これらのユーザーのアクティビティから継続的にアラートを受け取ることは意味がありません。 そのため、これらのユーザーまたはグループを除外するようにポリシーを構成することができます。 これは、機械学習モデルがこれらのユーザーを識別し、それに応じて動的しきい値を微調整するのにも役立ちます。
    * **的を絞った検出**  
    組織によっては、管理者グループや CXO グループのメンバーなど、特定の VIP ユーザーのグループを調査することに関心を持っている場合があります。 このシナリオでは、検出したいアクティビティに対してポリシーを作成し、関心があるユーザーまたはグループのセットだけを含めるように選択できます。

2. **異常なサインイン検出の調整**

    [失敗したサインイン アクティビティ](anomaly-detection-policy.md#multiple-failed-login-attempts)の結果としてアラートを確認したい組織もあります。これらのアラートは、何者かが 1 つ以上のユーザー アカウントをターゲットにしようとしていることを示している可能性があるからです。 一方、ユーザー アカウントに対するブルート フォース攻撃は、クラウド内では常に発生し、組織にはそれを防ぐ方法がありません。 そのため、大規模な組織では、通常、成功したサインイン アクティビティにつながる疑わしいサインイン アクティビティのアラートのみを受け取ることにしています。これは、真の侵害を表す可能性があるためです。

    ID の盗難は、侵害の重要な源となり、組織にとって重大な脅威ベクトルとなります。 [あり得ない移動](anomaly-detection-policy.md#impossible-travel)、[匿名 IP アドレス](anomaly-detection-policy.md#activity-from-anonymous-ip-addresses)、[頻度の低い国](anomaly-detection-policy.md#activity-from-infrequent-country)の検出アラートは、アカウントが侵害されている可能性を示唆するアクティビティを発見するのに役立ちます。 これらのポリシーをカスタマイズして、対応可能な差し迫った脅威を示す成功したサインインだけに焦点を当てて、すばやく対処することができます。 たとえば、頻度の低い国ポリシーをカスタマイズして、組織内のどのユーザーも最近アクセスしていない場所からサインインが成功した場合にのみアラートを通知することができます。 これを実現するには、[ポリシーを編集](anomaly-detection-policy.md#tune-anomaly-detection-policies)し、[詳細構成] で [サインイン アクティビティを分析する] を、成功したサインイン オプションのいずれかに設定します。

3. **[ありえない移動](anomaly-detection-policy.md#impossible-travel)の感度の調整** ありえない移動のアラートをトリガーする前に、異常な動作に適用される抑制のレベルを決定する[感度スライダーを構成](anomaly-detection-policy.md#tune-anomaly-detection-policies)します。 たとえば、高忠実度に関心がある組織では、感度レベルを上げることを検討する必要があります。 一方、移動するユーザーを多く抱えている組織では、以前の活動から学習したユーザーの一般的な場所からのアクティビティを抑制するために、感度レベルを下げることを検討してください。 次の感度レベルから選択できます。

    * **低**:システム、テナント、およびユーザーの抑制
    * **中**: システムとユーザーの抑制
    * **高**: システム抑制のみ

    この場合、

    | 抑制の種類 | [説明] |
    | --- | --- |
    | **システム** | 常に抑制される組み込みの検出。 |
    | **テナント** | テナント内の以前のアクティビティに基づく一般的なアクティビティ。 たとえば、組織内で以前にアラートが通知された ISP からのアクティビティを抑制します。 |
    | **ユーザー** | 特定のユーザーの以前のアクティビティに基づく一般的なアクティビティ。 たとえば、ユーザーがよく使用する場所からのアクティビティを抑制します。 |

## <a name="phase-3-tune-cloud-discovery-anomaly-detection-policies"></a>フェーズ 3:Cloud Discovery 異常検出ポリシーを調整する

異常検出ポリシーと同様に、微調整が可能な組み込みの [Cloud Discovery 異常検出ポリシー](cloud-discovery-anomaly-detection-policy.md)がいくつかあります。 たとえば、承認されていないアプリへのデータ抜き取りポリシーは、承認されていないアプリにデータが抜き取られているときにアラートを通知します。このポリシーは、セキュリティ分野での Microsoft の経験に基づく設定で事前に構成されています。

ただし、組み込みのポリシーを微調整したり、独自のポリシーを作成して、調査に関心を持つ可能性がある他のシナリオを特定するのに役立てることができます。 これらのポリシーは Cloud Discovery ログに基づいているため、異常なアプリの動作とデータの流出により重点を置いた、さまざまな[チューニング機能](cloud-discovery-anomaly-detection-policy.md#cloud-discovery-anomaly-detection-policy-reference)があります。

1. **使用状況の監視の調整**  
使用状況フィルターを設定して、異常な動作を検出するためのベースライン、スコープ、およびアクティビティ期間を制御します。 たとえば、役員レベルの従業員に関連する異常なアクティビティのアラートを受信することができます。

2. **アラートの感度の調整**  
アラート疲れを防止するには、アラートの感度を構成します。 感度スライダーを使用して、1 週間あたり 1,000 ユーザーごとに送信される高リスクのアラートの数を制御できます。 感度が高いほど、異常と見なされるのに必要な差異が小さくなり、より多くのアラートが生成されます。 一般に、機密データへのアクセス権を持たないユーザーには、感度を低く設定します。

## <a name="phase-4-tune-rule-based-detection-activity-policies"></a>フェーズ 4:ルールベースの検出 (アクティビティ) ポリシーを調整する

[ルールベースの検出ポリシー](user-activity-policies.md)を使用すると、組織固有の要件で異常検出ポリシーを補完することができます。 アクティビティ ポリシー テンプレートの 1 つを使用して ( **[コントロール]**  >  **[テンプレート]** の順に移動し、 **[種類]** フィルターを **[アクティビティ ポリシー]** に設定します) ルールベースのポリシーを作成してから、ご使用の環境では通常ではない動作を検出するように[それらを構成します](activity-filters-queries.md)。 たとえば、特定の国や地域にまったく存在していない一部の組織では、その国からの異常なアクティビティを検出してそれらに対するアラートを生成するポリシーを作成することが理にかなっている場合があります。 その国に大規模な支店があるその他の組織では、その国からのアクティビティは正常であるため、そのようなアクティビティを検出することは意味がありません。

1. **アクティビティの量の調整**  
検出によってアラートが生成される前に、必要なアクティビティの量を選択します。 この国の例を使用すると、ある国や地域に存在しない場合は 1 つのアクティビティでも重要であり、アラートが正当化されます。 ただし、1 回のサインインの失敗は人為的なミスの可能性があり、短期間に多くの失敗がある場合にのみ関心を向けます。
2. **[アクティビティ フィルター](activity-filters-queries.md)の調整**  
アラートを通知するアクティビティの種類を検出するために必要なフィルターを設定します。 たとえば、ある国からのアクティビティを検出するには、**Location** パラメーターを使用します。
3. **アラートの調整**  
アラート疲れを防ぐには、**1 日あたりのアラート制限**を設定します。

## <a name="phase-5-configure-alerts"></a>フェーズ 5:アラートを構成する

ご自分のニーズに最も適した形式とメディアでアラートを受け取ることを選択できます。 いつでもすぐにアラートを受け取るには、メールまたはテキスト メッセージを使用して受信することをお勧めします。

また、組織内の他の製品によってトリガーされた他のアラートのコンテキストでアラートを分析して、潜在的な脅威の全体像を把握できるようにすることもできます。 たとえば、クラウドベースのイベントとオンプレミスのイベントを相互に関連付けて、攻撃を確認できる他の軽減証拠があるかどうかを確認することができます。

また、[Microsoft Power Automate](flow-integration.md) との統合を使用して、カスタム アラートの自動化をトリガーすることもできます。 たとえば、プレイブックを設定して [ServiceNow](/connectors/service-now/) で問題を自動的に作成したり、アラートがトリガーされたときに承認メールを送信してカスタム ガバナンス アクションを実行したりできます。

次のガイドラインを使用して、アラートを構成します。

1. **電子メールまたは SMS**  
アラートを受信するための配信設定を選択します。 アラートは、電子メール、テキスト メッセージ、またはその両方で受信できます。
2. **SIEM**  
[Azure Sentinel](siem-sentinel.md)、[Microsoft Graph Security API](/graph/security-integration#list-of-connectors-from-microsoft)、その他の[汎用 SIEM](siem.md) など、複数の SIEM 統合オプションがあります。 ご自分の要件に最も適した統合を選択します。
3. **Power Automate による自動化**  
必要な自動プレイブックを作成し、それをポリシーのアラートとして Power Automate に設定します。

## <a name="phase-6-investigate-and-remediate"></a>フェーズ 6:調査して修正する

ポリシーを設定し、疑わしいアクティビティのアラートの受信を開始しました。 これらについて何をすればよいでしょう。 まず、アクティビティを調査するための方策を講じる必要があります。 たとえば、[ユーザーが侵害されている](tutorial-ueba.md#identify)ことを示すアクティビティを調べることができます。

保護を最適化するには、自動修正アクションを設定して組織へのリスクを最小限に抑えることを検討する必要があります。 Microsoft のポリシーを使用すると、調査を開始する前であっても、組織へのリスクが軽減されるように、[ガバナンス アクション](control.md)を併用してアラートに適用することができます。 使用可能なアクションは、ポリシーの種類によって決まります。これには、ユーザーの中断や、要求されたリソースへのアクセスのブロックなどのアクションが含まれます。

[!INCLUDE [Open support ticket](includes/support.md)]
