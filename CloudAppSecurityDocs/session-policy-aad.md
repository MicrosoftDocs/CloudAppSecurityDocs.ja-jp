---
title: Cloud App Security でセッションポリシーを作成する
description: この記事では、ユーザーセッションアクティビティを詳細に可視化し、リバースプロキシ機能を使用してダウンロードをブロックする Cloud App Security アプリの条件付きアクセス制御セッションポリシーを設定する手順について説明します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 11/14/2019
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: ca5fdade4d00e93d8adf6a79f3534be9e6ac7481
ms.sourcegitcommit: 35749af5294c45a3d5ba8667f7a764fe4719575d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/24/2020
ms.locfileid: "77567159"
---
# <a name="session-policies"></a>セッション ポリシー

*適用対象: Microsoft Cloud App Security*

Microsoft Cloud App Security セッションポリシーを使用すると、セッションレベルのリアルタイム監視が可能になり、クラウドアプリの詳細な可視性を使う、ユーザーセッションに設定したポリシーに応じて異なるアクションを実行できるようになります。 セッション制御で[は、アクセスを完全に許可またはブロック](access-policy-aad.md)するのではなく、アプリの条件付きアクセス制御のリバースプロキシ機能を使用して、セッションを監視しながらアクセスを許可したり、特定のセッションアクティビティを制限したりすることができます。

たとえば、管理されていないデバイス、または特定の場所からのセッションについては、ユーザーがアプリにアクセスできるようにしながら、機密ファイルのダウンロードを制限したり、ダウンロード時に特定のドキュメントを保護することを要求したりすることができます。 セッションポリシーを使用すると、これらのユーザーセッションコントロールを設定し、アクセスを許可し、次のことができるようになります。

* [すべてのアクティビティを監視する](#monitor-session)
* [すべてのダウンロードをブロックする](#block-download)
* [特定のアクティビティをブロックする](#block-activities)
* [ダウンロード時にファイルを保護する](#protect-download)
* [機密ファイルのアップロードを保護する](#protect-upload)
* [機密ファイルを保護するようにユーザーを教育する](#educate-protect)

## <a name="prerequisites-to-using-session-policies"></a>セッションポリシーを使用するための前提条件

* Azure AD Premium P1 ライセンス
* 関連するアプリは、[アプリの条件付きアクセス制御で展開](proxy-deployment-aad.md)する必要があります。
* 次に説明するように、 [Azure AD 条件付きアクセスポリシー](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal)を使用して、ユーザーを Microsoft Cloud App Security にリダイレクトする必要があります。

> [!NOTE]
> セッションポリシーでは、Azure AD 以外の id プロバイダーで構成されたアプリもサポートされます。 このシナリオの詳細については、mcaspreview@microsoft.comに電子メールを送信してください。

## <a name="create-an-azure-ad-conditional-access-policy"></a>Azure AD 条件付きアクセスポリシーを作成する

条件付きアクセスポリシーと Cloud App Security セッションポリシーを連携させる Azure Active Directory、各ユーザーセッションを確認し、各アプリのポリシーの決定を行います。 Azure AD で条件付きアクセスポリシーを設定するには、次の手順に従います。

1. ユーザーまたはユーザーグループの割り当てと、アプリの条件付きアクセス制御で制御するアプリに対して、 [Azure AD 条件付きアクセスポリシー](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal)を構成します。

    > [!NOTE]
    > このポリシーの影響を受けるのは、[アプリの条件付きアクセス制御で展開](proxy-deployment-aad.md)されたアプリのみです。

2. **[セッション]** ページで **[アプリの条件付きアクセス制御適用]** された制限を使用する を選択して、ユーザーを Microsoft Cloud App Security にルーティングします。

## <a name="create-a-cloud-app-security-session-policy"></a>Cloud App Security セッションポリシーを作成する

新しいセッションポリシーを作成するには、次の手順を実行します。

1. ポータルで、 **[制御]** 、 **[ポリシー]** の順に選択します。
1. **[ポリシー]** ページで、 **[ポリシーの作成]** をクリックし、 **[セッションポリシー]** を選択します。
1. **[セッションポリシー]** ウィンドウで、ポリシーの名前を割り当てます。たとえば、*マーケティングユーザーの Box での機密ドキュメントのダウンロードをブロック*します。
1. **[セッション制御の種類]** フィールドで、次の操作を行います。

    1. ユーザーのみがアクティビティを監視する場合は、 **[監視のみ]** を選択します。 このオプションを選択すると、選択したアプリに対してのみ、すべてのサインイン、ヒューリスティックダウンロード、およびアクティビティの種類がダウンロードされます。

    1. ユーザーアクティビティを監視する場合は、 **[ファイルのダウンロードを制御する (DLP 付き)]** を選択します。 ユーザーのダウンロードのブロックや保護などの追加アクションを実行できます。
    1. アクティビティの **[ブロック]** を選択して特定のアクティビティをブロックします。これは、 **[アクティビティの種類]** フィルターを使用して選択できます。 選択したアプリのすべてのアクティビティが監視され、アクティビティログに報告されます。 **[ブロック]** アクションを選択すると、選択した特定のアクティビティがブロックされます。 選択した特定のアクティビティによって、**テスト**アクションを選択し、アラートを有効にした場合にアラートが生成されます。
1. **[次のすべてに一致]** するアクティビティ セクションの **[アクティビティソース]** で、ポリシーに適用する追加のアクティビティフィルターを選択します。 これらのフィルターには、次のオプションを含めることができます。

    * **デバイスタグ**: 管理されていないデバイスを識別するには、このフィルターを使用します。

    * **[場所]** : このフィルターを使用して、不明な (またはリスクのある) 場所を特定します。

    * **Ip アドレス**: ip アドレスごとにフィルター処理する場合、または以前に割り当てた ip アドレスタグを使用する場合は、このフィルターを使用します。

    * **ユーザーエージェントタグ**: このフィルターを使用して、モバイルアプリとデスクトップアプリを特定するヒューリスティックを有効にします。 このフィルターは、に等しいか、または**Native client**と等しくないように設定できます。 このフィルターは、各クラウドアプリのモバイルアプリとデスクトップアプリに対してテストする必要があります。

    >[!NOTE]
    >セッションポリシーは、モバイルアプリとデスクトップアプリをサポートしていません。 モバイルアプリとデスクトップアプリは、アクセスポリシーを作成することによってブロックまたは許可することもできます。

1. ファイルのダウンロードを制御するオプションを選択した場合 **(DLP を使用)** :

    1. 次のすべてに **[一致するファイル]** セクションの **[アクティビティソース]** で、ポリシーに適用する追加のファイルフィルターを選択します。 これらのフィルターには、次のオプションを含めることができます。

        * **分類ラベル**-組織で Azure Information Protection を使用し、データが分類ラベルによって保護されている場合は、このフィルターを使用します。 適用した分類ラベルに基づいてファイルをフィルター処理できます。 Azure Information Protection との統合の詳細については、「 [Azure Information Protection 統合](azip-integration.md)」を参照してください。

        * **ファイル名**-このフィルターを使用して、ポリシーを特定のファイルに適用します。
        * **ファイルの種類**-このフィルターを使用して、すべての .xls ファイルのダウンロードをブロックするなど、特定のファイルの種類にポリシーを適用します。
    2. **[コンテンツ検査]** セクションで、DLP エンジンでドキュメントとファイルの内容をスキャンできるようにするかどうかを設定します。

    3. **[アクション]** で、次のいずれかの項目を選択します。

        * **テスト (すべてのアクティビティを監視)** : 設定したポリシーフィルターに従ってダウンロードを明示的に許可するには、このアクションを設定します。

        * **ブロック (ファイルをすべてダウンロードして監視するすべてのアクティビティをブロック)** : 設定したポリシーフィルターに従ってダウンロードを明示的にブロックするには、このアクションを設定します。 詳細については、「[ダウンロードのブロックのしくみ](#block-download)」を参照してください。

        * **保護 (すべてのアクティビティをダウンロードおよび監視するための分類ラベルの適用)** : このオプションは、 **[セッションポリシー]** で **[ファイルのダウンロードを制御する (DLP 付き)]** を選択した場合にのみ使用できます。 組織で Azure Information Protection を使用している場合は、Azure Information Protection で設定された分類ラベルをファイルに適用する**アクション**を設定できます。 詳細については、「[ダウンロードの保護のしくみ](#protect-download)」を参照してください。

1. 一致する**イベントごとに、ポリシーの重要度でアラートを作成**し、アラートの上限を設定することができます。 アラートを電子メール、テキストメッセージ、またはその両方として使用するかどうかを選択します。

## <a name="monitor-session"></a>すべてのアクティビティを監視する

セッションポリシーを作成すると、ポリシーに一致する各ユーザーセッションは、直接アプリではなくセッション制御にリダイレクトされます。 ユーザーには、セッションが監視されていることを知らせるための監視通知が表示されます。

監視されていることをユーザーに通知しない場合は、通知メッセージを無効にすることができます。

1. 設定の歯車で、 **[全般設定]** を選択します。

2. 次に、**アプリの条件付きアクセス制御** **ユーザーの監視** を選択し、ユーザーへの**通知** チェックボックスをオフにします。

セッション内でユーザーを保持するために、アプリの条件付きアクセス制御は、アプリセッション内の関連するすべての Url、Java スクリプト、および cookie を Microsoft Cloud App Security Url に置き換えます。 たとえば、myapp.com で終わるドメインのリンクを含むページがアプリから返された場合、はアプリの条件付きアクセス制御、末尾が myapp.com.us.cas.ms のドメインにリンクを置きます。 この方法では、セッション全体が Microsoft Cloud App Security によって監視されます。

アプリの条件付きアクセス制御は、ルーティングされているすべてのユーザーセッションのトラフィックログを記録します。 トラフィックログには、時間、IP、ユーザーエージェント、アクセスした Url、アップロードおよびダウンロードされたバイト数が含まれます。 これらのログが分析され、継続的なレポート**Cloud App Security アプリの条件付きアクセス制御**が Cloud Discovery ダッシュボードの Cloud Discovery レポートの一覧に追加されます。

これらのログをエクスポートするには:

1. 設定歯車にアクセスし、 **[アプリの条件付きアクセス制御]** をクリックします。
2. テーブルの右側にある [エクスポート] ボタンをクリックします。

    ![[エクスポート] ボタン](./media/export-button.png)
3. レポートの範囲を選択し、 **[エクスポート]** をクリックします。 この処理には時間がかかることがあります。

エクスポートされたログをダウンロードするには:

1. レポートの準備ができたら、 **[設定]** 、エクスポートされた **[レポート]** の順に選択します。
2. テーブルで、**アプリの条件付きアクセス制御のトラフィックログ**の一覧から関連するレポートを選択し、[ダウンロード] をクリックします。

    ![[ダウンロード] ボタン](./media/download-button.png)

## <a name="block-download"></a>すべてのダウンロードをブロックする

Cloud App Security セッションポリシーで実行する**アクション**として**ブロック**が設定されている場合、アプリの条件付きアクセス制御は、ポリシーのファイルフィルターに従ってユーザーがファイルをダウンロードできないようにします。 ダウンロードイベントは、ユーザーがダウンロードを開始したときに、アプリごとに Microsoft Cloud App Security によって認識されます。 リアルタイムでが介在をアプリの条件付きアクセス制御て、実行されないようにします。 ユーザーがダウンロードを開始したことを示すシグナルを受信すると、アプリの条件付きアクセス制御は**ダウンロード制限付き**のメッセージをユーザーに返し、ダウンロードしたファイルをテキストファイルに置き換えます。 ユーザーへのテキストファイルのメッセージは、セッションポリシーから構成およびカスタマイズできます。

## <a name="block-activities"></a>特定のアクティビティをブロックする

**アクティビティの種類**として **[ブロックアクティビティ]** が設定されている場合、特定のアプリでブロックする特定のアクティビティを選択できます。 選択したアプリのすべてのアクティビティが監視され、アクティビティログに報告されます。 **[ブロック]** アクションを選択すると、選択した特定のアクティビティがブロックされます。 選択した特定のアクティビティによって、**テスト**アクションを選択し、アラートを有効にした場合にアラートが生成されます。

**特定のアクティビティをブロック**し、特定のグループに適用して、組織の包括的な読み取り専用モードを作成します。

## <a name="protect-download"></a>ダウンロード時にファイルを保護する

アクティビティの **[ブロック]** を選択して特定のアクティビティをブロックします。これは、 **[アクティビティの種類]** フィルターを使用して見つけることができます。 選択したアプリのすべてのアクティビティが監視され、アクティビティログに報告されます。 **[ブロック]** アクションを選択すると、選択した特定のアクティビティがブロックされます。 選択した特定のアクティビティによって、**テスト**アクションを選択し、アラートを有効にした場合にアラートが生成されます。

Cloud App Security セッションポリシーで実行する**アクション**として **[保護]** が設定されている場合、アプリの条件付きアクセス制御によって、ポリシーのファイルフィルターごとにファイルのラベル付けとその後の保護が適用されます。 ラベルは Azure Information Protection コンソールで構成され、Cloud App Security ポリシーでオプションとして表示されるようにするには、ラベル内で **[保護]** を選択する必要があります。 ラベルが選択されていて、Cloud App Security ポリシーの条件を満たすファイルがダウンロードされると、ラベルとそれに対応する保護 (アクセス許可を持つ) がダウンロード時にファイルに適用されます。 ダウンロードしたファイルが保護されている間、元のファイルはクラウドアプリにそのまま残ります。 ファイルにアクセスしようとするユーザーは、適用される保護によって決定されたアクセス許可要件を満たしている必要があります。

Cloud App Security は、次のファイルの種類の[Azure Information Protection 分類ラベル](azip-integration.md)の適用を現在サポートしています。

* Word: .docm、.docx、normal.dotm、.dotx
* Excel: xlam、.xlsm、.xlsx、xlam
* PowerPoint: potm、potx、ppsx、ppsm、ppsm、.pptx
* PDF
  > [!NOTE]
  > PDF の場合は、統合ラベルを使用する必要があります。

## <a name="protect-upload"></a>機密ファイルのアップロードを保護する

Cloud App Security セッションポリシーで **[コントロールファイルのアップロード (DLP あり)]** が**セッション制御の種類**として設定されている場合、アプリの条件付きアクセス制御は、ポリシーのファイルフィルターに従ってユーザーがファイルをアップロードできないようにします。 アップロードイベントが認識されたら、リアルタイムでが介在をアプリの条件付きアクセス制御て、ファイルが機密情報であり、保護が必要であるかどうかを判断します。 ファイルに機密データが含まれており、適切なラベルがない場合は、ファイルのアップロードがブロックされます。

たとえば、ファイルのコンテンツをスキャンして、社会保障番号などの機密性の高いコンテンツが含まれているかどうかを確認するポリシーを作成できます。 機密情報が含まれていて、Azure Information Protection の社外秘ラベルが付いていない場合は、ファイルのアップロードがブロックされます。 ファイルがブロックされている場合は、ファイルをアップロードするためにラベルを付ける方法を指示する[カスタムメッセージをユーザーに表示](#educate-protect)できます。 これにより、クラウドアプリに格納されているファイルがポリシーに準拠していることを確認します。

## <a name="educate-protect"></a>機密ファイルを保護するようにユーザーを教育する

ユーザーがポリシーに違反している場合は、組織のポリシーに準拠する方法を学習することが重要です。 すべての企業には独自のニーズとポリシーがあるため、Cloud App Security では、ポリシーのフィルターと、違反が検出されたときにユーザーに表示されるメッセージをカスタマイズできます。 ファイルに適切にラベルを付ける方法や、管理されていないデバイスを登録する方法など、ユーザーに特定のガイダンスを提供して、ファイルが正常にアップロードされるようにすることができます。

たとえば、ユーザーが Azure Information Protection ラベルなしでファイルをアップロードした場合、適切なラベルを必要とする機密コンテンツがファイルに含まれていることを示すメッセージが表示されることがあります。 同様に、ユーザーが管理されていないデバイスからドキュメントをアップロードしようとした場合、そのデバイスを登録する方法についての指示が記載されたメッセージ、またはデバイスを登録する必要がある理由についての詳細情報を示すメッセージが表示されます。

>[!div class="step-by-step"]
> [« PREVIOUS: 任意のアプリに対するオンボードとデプロイアプリの条件付きアクセス制御»](proxy-deployment-any-app.md)
> [次: アクセスポリシーを作成する方法»](access-policy-aad.md)

## <a name="next-steps"></a>次のステップ:

> [!div class="nextstepaction"]
> [Azure AD アプリの条件付きアクセス制御を使用して、管理されていないデバイスでのダウンロードをブロックする](use-case-proxy-block-session-aad.md)

[!INCLUDE [Open support ticket](includes/support.md)]  
