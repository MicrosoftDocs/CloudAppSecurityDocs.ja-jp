---
title: Cloud App Security でセッション ポリシーを作成する
description: この記事では、ユーザー セッションのアクティビティの詳細を可視化し、リバース プロキシ機能を使用するダウンロードをブロックする、Cloud App Security のアプリの条件付きアクセス制御アクセス ポリシーを設定する手順について説明します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 03/31/2020
ms.topic: how-to
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: 3fc036277fac599f3075cd3c9cf765a0623e79a9
ms.sourcegitcommit: 870ca47381a36b4bc04e1ccb9b2a522944431fed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2020
ms.locfileid: "88963932"
---
# <a name="session-policies"></a>セッション ポリシー

*適用対象:Microsoft Cloud App Security*

Microsoft Cloud App Security のセッション ポリシーを使用すると、セッション レベルのリアルタイム監視が可能になり、クラウド アプリの詳細な可視性が提供され、ユーザー セッションに対して設定したポリシーに応じて異なるアクションを実行できるようになります。 セッション制御では、[アクセスを完全に許可またはブロックする](access-policy-aad.md)のではなく、アプリの条件付きアクセス制御のリバース プロキシ機能を使用して、セッションを監視しながらアクセスを許可したり、特定のセッション アクティビティを制限したりできます。

たとえば、アンマネージド デバイスからの場合や、特定の場所からのセッションに対しては、ユーザーにアプリへのアクセスを許可しながら、機密性の高いファイルのダウンロードを制限したり、ダウンロード時に特定のドキュメントの保護を要求したりすることができます。 セッション ポリシーを使用すると、これらのユーザー セッション制御を設定してアクセスを許可することができ、次のことが可能になります。

* [すべてのアクティビティを監視する](#monitor-session)
* [すべてのダウンロードをブロックする](#block-download)
* [特定のアクティビティをブロックする](#block-activities)
* [ダウンロード時にファイルを保護する](#protect-download)
* [機密ファイルのアップロードを保護する](#protect-upload)
* [アップロード時にマルウェアをブロックする](#block-malware-on-upload)
* [機密ファイルを保護するようにユーザーを教育する](#educate-protect)

## <a name="prerequisites-to-using-session-policies"></a>セッション ポリシーを使用するための前提条件

* Azure AD Premium P1 ライセンス、または ID プロバイダー (IdP) ソリューションに必要なライセンス
* 関連するアプリを、[アプリの条件付きアクセス制御と共にデプロイする](proxy-deployment-aad.md)必要があります
* 次のように、Cloud App Security と連動するように IdP ソリューションを構成します。
  * [Azure AD 条件付きアクセス](/azure/active-directory/active-directory-conditional-access-azure-portal)については、[Azure AD との統合を構成する](proxy-deployment-aad.md#configure-integration-with-azure-ad)方法に関するページを参照してください
  * その他の IdP ソリューションについては、[その他の IdP ソリューションとの統合を構成する](proxy-deployment-aad.md#configure-integration-with-other-idp-solutions)方法に関するページを参照してください。

## <a name="create-a-cloud-app-security-session-policy"></a>Cloud App Security のセッション ポリシーを作成する

新しいセッション ポリシーを作成するには、次の手順のようにします。

1. ポータルで、 **[Control]\(制御\)** に続けて **[ポリシー]** を選択します。
1. **[ポリシー]** ページで、 **[ポリシーの作成]** をクリックして、 **[セッション ポリシー]** を選択します。
1. **[セッション ポリシー]** ウィンドウで、ポリシーの名前を割り当てます (例: "*マーケティング ユーザー向け Box 内の機密ドキュメントのダウンロードをブロックする*")。
1. **[セッション制御の種類]** フィールドで、次のようにします。

    1. ユーザーによるアクティビティの監視のみを行う場合は、 **[監視のみ]** を選択します。 これを選択すると、選択したアプリに対する "監視のみ" ポリシーが作成され、すべてのサインイン、ヒューリスティック ダウンロード、およびアクティビティの種類がダウンロードされます。

    1. ユーザー アクティビティを監視する場合は、 **[ファイル ダウンロードの制御 (検査を含む)]** を選択します。 ユーザーのダウンロードのブロックや保護などの追加アクションを実行できます。
    1. 特定のアクティビティをブロックするには **[アクティビティのブロック]** を選択します。 **[アクティビティの種類]** フィルターを使用して選択できます。 選択したアプリからのすべてのアクティビティが監視されます (アクティビティ ログで報告されます)。 **[ブロックする]** アクションを選択すると、選択した特定のアクティビティがブロックされます。 **[テスト]** アクションを選択してアラートを有効にすると、選択した特定のアクティビティに対してアラートが生成されます。
1. **[次のすべてに一致するアクティビティ]** セクションの **[アクティビティ ソース]** で、ポリシーに適用する追加のアクティビティ フィルターを選択します。 これらのフィルターには次のオプションを含めることができます。

    * **[デバイス タグ]** : アンマネージド デバイスを識別するには、このフィルターを使用します。

    * **場所**: 不明な (したがって危険な) 場所を識別するには、このフィルターを使用します。

    * **[IP アドレス]** :IP アドレスでフィルター処理するか、以前に割り当てた IP アドレス タグを使うには、このフィルターを使用します。

    * **[ユーザー エージェント タグ]** : モバイル アプリまたはデスクトップ アプリを識別するためにヒューリスティックを有効にするには、このフィルターを使用します。 このフィルターは、 **[ネイティブ クライアント]** と等しい、または等しくないように設定できます。 このフィルターは、各クラウド アプリのモバイル アプリとデスクトップ アプリに対してテストする必要があります。

    >[!NOTE]
    >セッション ポリシーでは、モバイル アプリとデスクトップ アプリはサポートされていません。 モバイル アプリとデスクトップ アプリは、アクセス ポリシーを作成することによってブロックまたは許可することもできます。

1. **[ファイル ダウンロードの制御 (検査を含む)]** オプションを選択した場合:

    1. **[次のすべてに一致するファイル]** セクションの **[アクティビティ ソース]** で、ポリシーに適用する追加のファイル フィルターを選択します。 これらのフィルターには次のオプションを含めることができます。

        * **[分類ラベル]** - 組織で Azure Information Protection が使用されていて、データが分類ラベルによって保護されている場合は、このフィルターを使用します。 適用した分類ラベルに基づいてファイルをフィルター処理できます。 Azure Information Protection との統合の詳細については、「[Azure Information Protection の統合](azip-integration.md)」を参照してください。

        * **[ファイル名]** - 特定のファイルにポリシーを適用するには、このフィルターを使用します。
        * **[ファイルの種類]** - 特定のファイルの種類にポリシーを適用するには (すべての .xls ファイルのダウンロードをブロックする場合など)、このフィルターを使用します。
    2. **[コンテンツ検査]** セクションで、DLP エンジンによるドキュメントとファイルの内容のスキャンを有効にするかどうかを設定します。

    3. **[Actions]\(アクション\)** で、次の項目のいずれかを選択します。

        * **[テスト (すべてのアクティビティを監視する)]** : 設定したポリシー フィルターに従って明示的にダウンロードを許可するには、このアクションを設定します。

        * **[ブロック (ファイルのダウンロードをブロックし、すべてのアクティビティを監視します)]** : 設定したポリシー フィルターに従って明示的にダウンロードをブロックするには、このアクションを設定します。 詳細については、[ダウンロードのブロックの動作](#block-download)に関するセクションを参照してください。

        * **[保護 (ダウンロードしたファイルに分類ラベルを適用し、すべてのアクティビティを監視します)]** : このオプションは、 **[セッション ポリシー]** で **[ファイル ダウンロードの制御 (検査を含む)]** 選択した場合にのみ使用できます。 Azure Information Protection を使用している組織では、 **[Action]\(アクション\)** を設定して、Azure Information Protection で設定されている分類ラベルをファイルに適用できます。 詳細については、[ダウンロードの保護の動作](#protect-download)に関するセクションを参照してください。

1. **[一致するイベントごとにポリシー重要度に応じたアラートを作成する]** を有効にして、アラート制限を設定できます。 アラートをメール、テキスト メッセージ、またはその両方のどれにするかを選択します。

## <a name="monitor-all-activities"></a><a name="monitor-session"></a>すべてのアクティビティを監視する

セッション ポリシーを作成すると、ポリシーに一致する各ユーザー セッションは、直接アプリにではなく、セッション制御にリダイレクトされます。 ユーザーには、セッションが監視されていることを知らせる監視通知が表示されます。

監視されていることをユーザーに通知したくない場合は、通知メッセージを無効にすることができます。

1. 設定の歯車アイコンで、 **[全般設定]** を選択します。

2. 次に、 **[アプリの条件付きアクセス制御]** で、 **[ユーザーの監視]** をオンにし、 **[ユーザーへの通知]** チェック ボックスをオフにします。

ユーザーをセッション内に留めておくため、アプリの条件付きアクセス制御によって、アプリ セッション内のすべての関連 URL、Java スクリプト、Cookie が、Microsoft Cloud App Security の URL に置き換えられます。 たとえば、ドメインが myapp.com で終わるリンクが含まれるページがアプリから返された場合、アプリの条件付きアクセス制御により、リンクは `myapp.com.mcas.ms` のようなもので終わるドメインに置き換えられます。 このようにして、セッション全体が Microsoft Cloud App Security によって監視されます。

アプリの条件付きアクセス制御では、それを通してルーティングされるすべてのユーザー セッションのトラフィック ログが記録されます。 トラフィック ログには、日時、IP アドレス、ユーザー エージェント、アクセスされた URL、アップロードおよびダウンロードされたバイト数が含まれます。 これらのログが分析され、継続的なレポート (**Cloud App Security のアプリの条件付きアクセス制御**) が、Cloud Discovery ダッシュボードの Cloud Discovery レポートの一覧に追加されます。

これらのログをエクスポートするには:

1. 設定の歯車で **[アプリの条件付きアクセス制御]** をクリックします。
2. テーブルの右側にあるエクスポート ボタンをクリックします。

    ![エクスポート ボタン](media/export-button.png)
3. レポートの範囲を選択し、 **[エクスポート]** をクリックします。 このプロセスには、時間がかかることがあります。

エクスポートされたログをダウンロードするには:

1. レポートの準備ができたら、 **[設定]** 、次に **[エクスポートされたレポート]** に移動します。
2. テーブルで**アプリの条件付きアクセス制御トラフィック ログ**の一覧から関連するレポートを選択し、ダウンロードをクリックします。

    ![ダウンロード ボタン](media/download-button.png)

## <a name="block-all-downloads"></a><a name="block-download"></a>すべてのダウンロードをブロックする

Cloud App Security セッション ポリシーで実行する **[Action]\(アクション\)** として **[ブロック]** が設定されている場合、アプリの条件付きアクセス制御では、ポリシーのファイル フィルターに従ってユーザーによるファイルのダウンロードが禁止されます。 ユーザーがダウンロードを開始すると、Microsoft Cloud App Security により、アプリごとにダウンロード イベントが認識されます。 アプリの条件付きアクセス制御のリアルタイムの介入によって、実行は阻止されます。 ユーザーがダウンロードを開始したことを示す信号を受信したアプリの条件付きアクセス制御によって、**ダウンロードは制限されている**というメッセージがユーザーに返され、ダウンロード対象のファイルはテキスト ファイルに置き換えられます。 ユーザーに対するテキスト ファイルのメッセージは、セッション ポリシーから構成およびカスタマイズできます。

## <a name="block-specific-activities"></a><a name="block-activities"></a>特定のアクティビティをブロックする

**[アクティビティの種類]** として **[アクティビティのブロック]** が設定されていると、特定のアプリでブロックする特定のアクティビティを選択できます。 選択したアプリからのすべてのアクティビティが監視され、アクティビティ ログで報告されます。 **[ブロックする]** アクションを選択すると、選択した特定のアクティビティがブロックされます。 **[テスト]** アクションを選択してアラートを有効にすると、選択した特定のアクティビティに対してアラートが生成されます。

組織に対する包括的な読み取り専用モードを作成するには、**特定のアクティビティをブロック**し、それを特定のグループに適用します。

## <a name="protect-files-on-download"></a><a name="protect-download"></a>ダウンロード時にファイルを保護する

特定のアクティビティをブロックするには **[アクティビティのブロック]** を選択します。 **[アクティビティの種類]** フィルターを使用して検索できます。 選択したアプリからのすべてのアクティビティが監視されます (アクティビティ ログで報告されます)。 **[ブロックする]** アクションを選択すると、選択した特定のアクティビティがブロックされます。 **[テスト]** アクションを選択してアラートを有効にすると、選択した特定のアクティビティに対してアラートが生成されます。

Cloud App Security セッション ポリシーで実行する **[Action]\(アクション\)** として **[保護]** が設定されている場合、アプリの条件付きアクセス制御により、ポリシーのファイル フィルターに従って、ファイルのラベル付けとその後の保護が適用されます。 ラベルは Azure Information Protection コンソールで構成し、Cloud App Security ポリシーでオプションとして表示されるようにするには、ラベル内で **[保護]** を選択する必要があります。 ラベルが選択されていて、Cloud App Security ポリシーの条件を満たすファイルがダウンロードされると、ラベルとそれに対応する (アクセス許可による) 保護が、ダウンロード時にファイルに適用されます。 ダウンロード対象のファイルが保護されている間、元のファイルはクラウド アプリにそのまま残ります。 ファイルにアクセスしようとするユーザーは、適用される保護によって決定されるアクセス許可要件を満たしている必要があります。

現在、Cloud App Security では、次のファイルの種類に対する [Azure Information Protection 分類ラベル](azip-integration.md)の適用がサポートされています。

* Word: docm、docx、dotm、dotx
* Excel: xlam、xlsm、xlsx、xltx
* PowerPoint: potm、potx、ppsx、ppsm、pptm、pptx
* PDF
  > [!NOTE]
  > PDF の場合は、統合ラベルを使用する必要があります。

## <a name="protect-uploads-of-sensitive-files"></a><a name="protect-upload"></a>機密ファイルのアップロードを保護する

Cloud App Security セッション ポリシーで **[セッション制御の種類]** として **[ファイル アップロードの制御 (検査を含む)]** が設定されている場合、アプリの条件付きアクセス制御では、ポリシーのファイル フィルターに従ってユーザーによるファイルのアップロードが禁止されます。 アプリの条件付きアクセス制御によってアップロード イベントが認識されると、リアルタイムで介入が行われ、ファイルが機密情報であり、保護が必要かどうかが判断されます。 ファイルに機密データが含まれていて、適切なラベルが付いていない場合、ファイルのアップロードはブロックされます。

たとえば、ファイルの内容をスキャンし、社会保障番号などと一致する機密性の高い内容が含まれているかどうかを確認するポリシーを作成できます。 機密性の内容が含まれていて、Azure Information Protection の社外秘ラベルが付いていない場合、ファイルのアップロードはブロックされます。 ファイルがブロックされたら、ファイルをアップロードするためにラベルを付ける方法を指示する[カスタム メッセージをユーザーに表示する](#educate-protect)ことができます。 これにより、クラウド アプリに格納されているファイルをポリシーに準拠させることができます。

## <a name="block-malware-on-upload"></a>アップロード時にマルウェアをブロックする

Cloud App Security セッション ポリシーで  **[セッション制御の種類]** として  **[ファイル アップロードの制御 (検査を含む)]**  が設定され、 **[検査方法]** として **[マルウェアの検出]** が設定されている場合、アプリの条件付きアクセス制御では、マルウェアが検出された場合、ユーザーによるファイルのアップロードがリアルタイムで禁止されます。 ファイルは、Microsoft 脅威インテリジェンス エンジンを使用してスキャンされます。

アクティビティ ログで **[検出されたマルウェアの可能性]** フィルターを使用することにより、マルウェアの可能性ありとしてフラグが設定されたファイルを表示できます。

また、ダウンロード時にマルウェアをブロックするようにセッション ポリシーを構成することもできます。

## <a name="educate-users-to-protect-sensitive-files"></a><a name="educate-protect"></a>機密ファイルを保護するようにユーザーを教育する

ユーザーがポリシーに違反したら教育を行って、組織のポリシーに準拠する方法を学ばせることが重要です。 すべての企業には独自のニーズとポリシーがあるため、Cloud App Security では、ポリシーのフィルターと、違反が検出されたときにユーザーに表示されるメッセージをカスタマイズできます。 ファイルが正常にアップロードされるように、ファイルに適切にラベルを付ける方法や、アンマネージド デバイスを登録する方法など、ユーザーに具体的なガイダンスを提供することができます。

たとえば、ユーザーが Azure Information Protection ラベルなしでファイルをアップロードした場合、内容が機密性のファイルには適切なラベルを付ける必要があることを説明するメッセージを表示できます。 同様に、ユーザーがアンマネージド デバイスからドキュメントをアップロードしようとした場合、そのデバイスを登録する方法の指示が記載されたメッセージ、またはデバイスを登録する必要がある理由についての詳細情報を示すメッセージを、表示することができます。

## <a name="next-steps"></a>次のステップ

>[!div class="nextstepaction"]
> [« 前へ: 任意のアプリに対するアプリの条件付きアクセス制御のオンボードとデプロイ »](proxy-deployment-any-app.md)

>[!div class="nextstepaction"]
> [次へ:アクセス ポリシーを作成する方法 »](access-policy-aad.md)

> [!div class="nextstepaction"]
> [アクセスおよびセッション制御のトラブルシューティング](troubleshooting-proxy.md)

## <a name="see-also"></a>関連項目

> [!div class="nextstepaction"]
> [Azure AD のアプリの条件付きアクセス制御を使用して、アンマネージド デバイスでのダウンロードをブロックする](use-case-proxy-block-session-aad.md)

[!INCLUDE [Open support ticket](includes/support.md)]