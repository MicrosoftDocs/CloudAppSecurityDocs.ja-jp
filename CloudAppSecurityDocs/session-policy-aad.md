---
title: Cloud App Security でセッション ポリシーを作成する
description: この記事では、リバース プロキシ機能を使用して、ユーザー セッション アクティビティを詳細に可視化し、ダウンロードをブロックするように Cloud App Security のアプリの条件付きアクセス制御セッション ポリシーを設定する手順について説明します。
keywords: ''
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 12/10/2018
ms.topic: conceptual
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.assetid: 745df28a-654c-4abf-9c90-203841169f90
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: 50230751efbc9dfcbd203d130c6e1d3e7489eb03
ms.sourcegitcommit: b86c3afd1093fbc825fec5ba4103e3a95f65758e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/10/2018
ms.locfileid: "53176996"
---
# <a name="session-policies"></a>セッション ポリシー 

*適用対象:Microsoft Cloud App Security*

>[!div class="step-by-step"]
[« 戻る: アプリの条件付きアクセス制御の展開](proxy-deployment-aad.md)<br>
[次へ: アクセス ポリシーを作成する方法 »](access-policy-aad.md)


Microsoft Cloud App Security のセッション ポリシーを使うと、セッション レベルでのリアルタイム監視が可能になり、クラウド アプリの詳細な情報を把握し、ユーザー セッションに設定したポリシーに応じて異なるアクションを実行できます。 セッション制御では、[アクセスを完全に許可またはブロックする](access-policy-aad.md)のではなく、Conditional Access App Control のリバース プロキシ機能を使用して、セッションを監視しながらアクセスを許可したり、特定のセッション アクティビティを制限したりできます。 

たとえば、デバイスが管理されていない場合やセッションが特定の場所から行われている場合に、アプリにアクセスすることをユーザーに許可しながら、機密ファイルのダウンロードを制限したり、特定のドキュメントがダウンロード時に保護されることを要求したりすることができます。 セッション ポリシーを使用すると、このようなユーザー セッション制御を設定し、アクセスを許可することができます。これにより、ユーザーは次の操作を行うことができます。

- [すべてのアクティビティを監視する](#monitor-session)
- [すべてのダウンロードをスキャンする](#block-download)
- [特定のアクティビティをブロックする](#block-activities)
- [ダウンロード時にファイルを保護する](#protect-download)
 
## <a name="prerequisites-to-using-session-policies"></a>セッション ポリシーを使うための前提条件

- Azure AD Premium P1 のライセンス
- 関連するアプリを [Conditional Access App Control と共にデプロイ](proxy-deployment-aad.md)する必要があります。
- 以下の説明のとおり、Microsoft Cloud App Security にユーザーをリダイレクトする [Azure AD 条件付きアクセス ポリシー](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal)を設定する必要があります。

> [!NOTE]
> セッション ポリシーは、Azure AD 以外の ID プロバイダーで構成されたアプリにも対応しています。 このシナリオの詳細については、mcaspreview@microsoft.com に電子メールをお送りください。

## <a name="create-an-azure-ad-conditional-access-policy"></a>Azure AD 条件付きアクセス ポリシーを作成する

Azure Active Directory の条件付きアクセス ポリシーと Cloud App Security のセッション ポリシーは連携して動作し、各ユーザー セッションを調べて、各アプリに関するポリシーの決定を行います。 Azure AD で条件付きアクセス ポリシーを設定するには、次の手順のようにします。

1. ユーザーまたはユーザー グループに対する割り当てと、条件付きアクセス ポリシーで制御するアプリを指定して、[Azure AD 条件付きアクセス ポリシー](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal)を構成します。 

   > [!NOTE]
   > このポリシーが適用されるのは、[Conditional Access App Control と共にデプロイ](proxy-deployment-aad.md)されたアプリだけです。

2. **[セッション]** ページで **[Use Conditional Access App Control enforced restrictions]\(アプリの条件付きアクセス制御によって適用される制限を使用する\)** を選んで、Microsoft Cloud App Security にユーザーをルーティングします。

## <a name="create-a-cloud-app-security-session-policy"></a>Cloud App Security セッション ポリシーを作成する 

新しいセッション ポリシーを作成するには、以下の手順を実行します。

1. ポータルで、**[制御]**、**[ポリシー]** の順に選びます。
2. **[ポリシー]** ページで、**[ポリシーの作成]** をクリックし、**[セッション ポリシー]** を選びます。  

3. **[セッション ポリシー]** ウィンドウで、ポリシーの名前を割り当てます (例: "*マーケティング ユーザー用 Box の機密ドキュメントのダウンロードをブロックする*")。

4. **[セッション制御の種類]** フィールドで次のようにします。 

   1. ユーザーによるアクティビティを監視するだけの場合は、**[監視のみ]** を選びます。 このセクションでは、すべてのサインイン、発見的ダウンロード、アクティビティの種類がダウンロードされる、選択したアプリに対する監視のみのポリシーが作成されます。

   2. ユーザー アクティビティを監視する場合は、**[ファイル ダウンロードの制御 (DLP 使用)]** を選択します。 ユーザーのダウンロードのブロックや保護などの追加アクションを実行することができます。
   
   3. **[アクティビティのブロック]** を選択して、**[アクティビティの種類]** フィルターを使用して選択する特定のアクティビティをブロックします。 選択したアプリのすべてのアクティビティが監視されます (さらにアクティビティ ログで報告されます)。 **[ブロック]** アクションを選択した場合は、選択した特定のアクティビティがブロックされます。 **[テスト]** アクションを選択してアラートをオンにした場合は、選択した特定のアクティビティからアラートが生成されます。

5. **[次のすべてに一致するアクティビティ]** セクションの **[アクティビティ ソース]** で、ポリシーに適用する追加のアクティビティ フィルターを選びます。 これらのフィルターには次のオプションを含めることができます。 

   - **[デバイス タグ]**: 管理されていないデバイスを識別するには、このフィルターを使います。

   - **[場所]**: 不明な (したがって危険な) 場所を識別するには、このフィルターを使います。 

   - **[IP アドレス]**: IP アドレスでフィルター処理するか、前に割り当てた IP アドレス タグを使うには、このフィルターを使います。 

   - **[ユーザー エージェント タグ]**: モバイル アプリまたはデスクトップ アプリを識別するためにヒューリスティックを有効にするには、このフィルターを使います。 このフィルターは、**ネイティブ クライアント**と等しくなるように、または等しくならないように設定できます。 このフィルターは、各クラウド アプリのモバイル アプリとデスクトップ アプリに対してテストする必要があります。
       
 
     >[!NOTE]
     >セッション ポリシーは、モバイル アプリとデスクトップ アプリをサポートしていません。 モバイル アプリとデスクトップ アプリは、アクセス ポリシーの作成によって許可またはブロックすることもできます。

6. **[ファイル ダウンロードの制御 (DLP 使用)]** オプションを選んだ場合:

   1. **[次のすべてに一致するファイル]** セクションの **[アクティビティ ソース]** で、ポリシーに適用する追加のファイル フィルターを選びます。 これらのフィルターには次のオプションを含めることができます。

      - **[分類ラベル]**: 組織が Azure Information Protection を使っていて、データがその分類ラベルで保護されている場合は、このフィルターを使います。 適用した分類ラベルに基づいてファイルをフィルター処理できます。 Azure Information Protection との統合について詳しくは、「[Azure Information Protection の統合](azip-integration.md)」をご覧ください。

      - **[ファイル名]**: 特定のファイルにポリシーを適用するには、このフィルターを使います。

      - **[ファイルの種類]**: 特定のファイルの種類にポリシーを適用するには、このフィルターを使います (すべての .xls ファイルのダウンロードをブロックする場合など)。
       
   2. **[コンテンツ検査]** セクションで、DLP エンジンによるドキュメントとファイルのコンテンツのスキャンを有効にするかどうかを設定します。
 
   3. **[アクション]** で、次のいずれかの項目を選びます。 

      - **[テスト]**(すべてのアクティビティを監視する): 設定したポリシー フィルターに従ってダウンロードを明示的に許可するには、このアクションを設定します。

      - **[ブロック (ファイルのダウンロードをブロックし、すべてのアクティビティを監視します)]**: 設定したポリシー フィルターに従ってダウンロードを明示的にブロックするには、このアクションを設定します。 詳しくは、「[ダウンロードのブロックのしくみ](#block-download)」をご覧ください。

      - **[保護]**(ダウンロードしたファイルに分類ラベルを適用し、すべてのアクティビティを監視します): このオプションを選択できるのは、**[セッション ポリシー]** の下で **[ファイル ダウンロードの制御 (DLP 使用)]** を選択した場合のみです。 組織が Azure Information Protection を使っている場合は、Azure Information Protection で設定されている分類ラベルをファイルに適用するように **[アクション]** を設定できます。 詳しくは、「[ダウンロードの保護のしくみ](#protect-download)」をご覧ください。

7. **一致するイベントごとにポリシー重要度に応じたアラートを作成**し、アラート制限を設定します。 アラートを電子メール、テキスト メッセージ、またはその両方で送信するかどうかを選択します。


## すべてのアクティビティを監視する <a name="monitor-session"></a>

セッション ポリシーを作成すると、ポリシーに一致する各ユーザー セッションは、直接アプリにではなく、セッション制御にリダイレクトされます。 ユーザーには、セッションが監視されていることを知らせる監視通知が表示されます。

監視されていることをユーザーに通知したくない場合は、通知メッセージを無効にすることができます。

1. 設定の歯車アイコンで、**[全般設定]** を選びます。 

2. 次に、**[アプリの条件付きアクセス制御]** の下で、**[ユーザーの監視]** チェック ボックスをオンにし、**[ユーザーへの通知]** チェック ボックスをオフにします。

セッション内でユーザーを保持するために、Conditional Access App Control は、アプリ セッション内の関連するすべての URL、Java スクリプト、Cookie を、Microsoft Cloud App Security の URL に置き換えます。 たとえば、ドメインが myapp.com で終わるリンクを含むページをアプリが返した場合、アプリの条件付きアクセス制御はそのリンクを、myapp.com.us.cas.ms などで終わるドメインに置き換えます。 これにより、セッション全体が Microsoft Cloud App Security によって監視されます。

Conditional Access App Control は、ルーティングされてきたすべてのユーザー セッションのトラフィック ログを記録します。 トラフィック ログには、時刻、IP、ユーザー エージェント、アクセスした URL、アップロードおよびダウンロードされたバイト数が含まれます。 これらのログが分析されて、**Cloud App Security のアプリの条件付きアクセス制御**という継続的なレポートが、Cloud Discovery ダッシュボードの Cloud Discovery レポート一覧に追加されます。

ログをエクスポートするには:

1. 設定の歯車アイコンに移動し、**[Conditional Access App Control]** をクリックします。
2. テーブルの右側にあるエクスポート ボタンをクリックします。

   ![エクスポート ボタン](./media/export-button.png)
3. レポートの範囲を選び、**[エクスポート]** をクリックします。 この処理には時間がかかる場合があります。

エクスポートされたログをダウンロードするには:

1. レポートの準備ができたら、**[設定]**、**[エクスポートされたレポート]** の順に移動します。
2. テーブルで、**アプリの条件付きアクセス制御トラフィック ログ**の一覧から関連するレポートを選び、ダウンロードをクリックします。

     ![[ダウンロード] ボタン](./media/download-button.png)


## すべてのダウンロードをブロックする <a name="block-download"></a>

Cloud App Security セッション ポリシーで実行する **[アクション]** として **[ブロック]** が設定されていると、アプリの条件付きアクセス制御はポリシーのファイル フィルターによってユーザーがファイルをダウンロードできないようにします。 ユーザーがこのイベントを開始すると、ダウンロード イベントは各アプリの Microsoft Cloud App Security によって認識されます。 アプリの条件付きアクセス制御はリアルタイムで介入して実行を防ぎます。 ユーザーがダウンロードを開始したことを示す信号を受け取ったアプリの条件付きアクセス制御は、**ダウンロードが制限されている**というメッセージをユーザーに返し、ダウンロードされるファイルを、テキスト ファイルに置き換えます。 このユーザーに対するテキスト ファイルのメッセージは、セッション ポリシーから構成およびカスタマイズすることができます。  

## 特定のアクティビティをブロックする <a name="block-activities"></a>

**[アクティビティの種類]** として **[アクティビティのブロック]** が設定されているとき、特定のアプリ内でブロックする特定のアクティビティを選択できます。 選択したアプリのすべてのアクティビティが監視され、アクティビティ ログで報告されます。 **[ブロック]** アクションを選択した場合は、選択した特定のアクティビティがブロックされます。 **[テスト]** アクションを選択してアラートをオンにした場合は、選択した特定のアクティビティからアラートが生成されます。

**特定のアクティビティをブロック**して、それを特定のグループに適用し、組織用の包括的な読み取り専用モードを作成します。 

## ダウンロード時にファイルを保護する <a name="protect-download"></a>

**[アクティビティのブロック]** を選択して、**[アクティビティの種類]** フィルターを使用して見つけることができる特定のアクティビティをブロックします。 選択したアプリのすべてのアクティビティが監視されます (さらにアクティビティ ログで報告されます)。 **[ブロック]** アクションを選択した場合は、選択した特定のアクティビティがブロックされます。 **[テスト]** アクションを選択してアラートをオンにした場合は、選択した特定のアクティビティからアラートが生成されます。

Cloud App Security のセッション ポリシーで実行する **[アクション]** として **[保護]** が設定されていると、アプリの条件付きアクセス制御はポリシーのファイル フィルターによって、ファイルのラベル付けとその後の保護を適用します。 ラベルは Azure Information Protection コンソールで構成され、Cloud App Security ポリシーのオプションとしてそのラベルが表示されるためには、ラベル内で **[保護]** が選ばれている必要があります。 ラベルが選ばれていて、Cloud App Security ポリシーの条件 (ラベル) に一致するファイルがダウンロードされると、アクセス許可がある対応する保護が、ダウンロード時にファイルに適用されます。 元のファイルはクラウド アプリ内にそのまま残っていますが、ダウンロードされるファイルは保護されています。 ファイルにアクセスしようとするユーザーは、適用された保護によって決定されるアクセス許可要件を満たす必要があります。  
 
>[!div class="step-by-step"]
[« 戻る: アプリの条件付きアクセス制御の展開](proxy-deployment-aad.md)<br>
[次へ: アクセス ポリシーを作成する方法 »](access-policy-aad.md)

## <a name="next-steps"></a>次の手順
 
[Azure AD の Conditional Access App Control 機能を使って管理されていないデバイスでのダウンロードをブロックする](use-case-proxy-block-session-aad.md)   

[Premier サポートをご利用のお客様は、Premier ポータルから直接新しいサポート要求を作成することもできます。](https://premier.microsoft.com/)  
  
  