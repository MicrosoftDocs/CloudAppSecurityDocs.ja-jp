---
title: Cloud App Security での異常検出ポリシーの作成
description: この記事では異常検出ポリシーについて説明し、異常検出ポリシーの構成要素に関する参照情報を提供します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 03/24/2020
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: 5b4691cdc29199d65b6ac0a2884b8b5a82263c5e
ms.sourcegitcommit: 33e4b39d56256e54bc6e74ca45a03055484916d9
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84566983"
---
# <a name="get-instantaneous-behavioral-analytics-and-anomaly-detection"></a>行動分析と異常検出を瞬時に取得する

*適用対象:Microsoft Cloud App Security*

Microsoft Cloud App Security の異常検出ポリシーでは、すぐに使えるユーザーおよびエンティティ行動分析 (UEBA) と機械学習 (ML) が提供されるため、クラウド環境全体で高度な脅威検出をすばやく実行できます。 異常検出ポリシーは自動的に有効になるため、新しい異常検出ポリシーでは、即時検出を行い、ユーザー全体、またネットワークに接続されたマシンやデバイス全体の数多くの異常な動作を対象とすることにより、即時結果が提示されます。  さらに、新しいポリシーでは、Cloud App Security 検出エンジンからより多くのデータが公開され、調査プロセスの高速化と、進行中の脅威の阻止に役立ちます。

異常検出ポリシーは自動的に有効になりますが、Cloud App Security には 7 日間の初期学習期間があり、この期間中はすべての異常検出アラートが発生するとは限りません。 その後、各セッションは、過去 1 か月間に検出されたアクティビティ、ユーザーがアクティブだったとき、IP アドレス、デバイスなどに加え、これらのアクティビティのリスク スコアと比較されます。  これらの検出は、環境のプロファイルを作成し、組織のアクティビティで学習したベースラインに対してアラートをトリガーするヒューリスティック異常検出エンジンの一部です。 また、これらの検出では、ユーザーとサインイン パターンをプロファイルすることで誤検出を減らすように設計された機械学習アルゴリズムが使用されています。

異常はユーザーのアクティビティをスキャンして検出します。 リスクは、次のような複数のリスク要因に分類された 30 種類を超えるさまざまなリスク インジケーターを調べることにより評価されます。

* 危険な IP アドレス
* ログイン エラー
* 管理者のアクティビティ
* 非アクティブなアカウント
* 場所
* あり得ない移動
* デバイスとユーザー エージェント
* アクティビティ率

ポリシーの結果に基づいて、セキュリティ アラートがトリガーされます。 Cloud App Security によってクラウド上のすべてのユーザー セッションが監視され、組織のベースラインやユーザーの通常アクティビティとは異なる状況が発生した場合にアラート通知されます。

ネイティブ Cloud App Security アラートに加えて、Azure Active Directory (AD) Identity Protection から受信した情報に基づいて、次の検出アラートも取得します。

* 漏洩した資格情報: ユーザーの有効な資格情報が漏洩したときにトリガーされます。 詳細については、「 [Azure AD の漏洩した資格情報の検出](/azure/active-directory/identity-protection/concept-identity-protection-risks#user-risk)」を参照してください。
* リスクの高いサインイン: 複数の Azure AD Identity Protection サインイン検出を1つの検出に結合します。 詳細については、「 [Azure AD のサインインリスクの検出](/azure/active-directory/identity-protection/concept-identity-protection-risks#sign-in-risk)」を参照してください。

これらのポリシーは [Cloud App Security ポリシー] ページに表示され、有効または無効にすることができますが、編集することはできません。

## <a name="anomaly-detection-policies"></a>異常検出ポリシー

**[制御]**、**[ポリシー]** の順にクリックすると、ポータルで異常検出ポリシーを確認できます。 ポリシーの種類については **[異常検出ポリシー]** を選択します。

 ![新しい異常検出ポリシー](media/new-anomaly-detection-policies.png)

次の異常検出ポリシーを使用できます。

### <a name="impossible-travel"></a>あり得ない移動

* この検出は、(1 つまたは複数のセッションにおける) 2 つのユーザー アクティビティが地理的に離れている場所で、最初の場所から 2 回目の場所にユーザーが移動するのに要する時間より短い時間内に発生したことを示します。これは、別のユーザーが同じ資格情報を使用していることを示唆します。 この検出では、あり得ない移動で使用される、組織内の他のユーザーが普通に使用している VPN や場所などの明らかな "誤検知" を無視する機械学習アルゴリズムが使用されています。 検出には、7日間の初期学習期間があり、その間に新しいユーザーのアクティビティパターンが学習されます。 あり得ない移動の検出では、2 つの場所の間での異常なあり得ないユーザー アクティビティが識別されます。 アクティビティには、侵害のインジケーターでありアラートの価値があるとみなすのに十分な異常性がある必要があります。 このため、VPN アクティビティなど誤検出の原因となるシナリオに対応できるよう、検出ロジックにはさまざまな抑制レベルが含まれています。 機密度スライダーを使用すると、アルゴリズムを制御し、検出ロジックの厳密度を定義することができます。 機密度のレベルが高いほど、検出ロジックの一部として適用される抑制レベルが低下します。 このように、防御のニーズと SNR ターゲットに応じて検出を制御することができます。

    > [!NOTE]
    > 旅行の両側の IP アドレスが安全であると見なされると、移動は信頼され、不可能な移動検出のトリガーから除外されます。 たとえば、[企業としてタグ付け](ip-tags.md)されている場合、両側は安全と見なされます。 ただし、旅行の1つの側の IP アドレスのみが安全と見なされる場合、検出は通常どおりにトリガーされます。

### <a name="activity-from-infrequent-country"></a>頻度の低い国からのアクティビティ

* この検出では、新しい場所や頻度の低い場所を判断する際に、過去にアクティビティが発生した場所が考慮されます。 異常検出エンジンにより、組織内のユーザーが以前に使用したことのある場所に関する情報が格納されます。 組織内の任意のユーザーによって最近使用されていない場所や使用されたことがない場所からアクティビティが発生すると、アラートがトリガーされます。

### <a name="malware-detection"></a>[マルウェア検出]

* この検出では、Microsoft アプリのものであるか、サード パーティ製アプリのものであるかに関係なく、クラウド ストレージの悪意のあるファイルを識別します。 Microsoft Cloud App Security では Microsoft の脅威インテリジェンスを使用して、特定のファイルが既知のマルウェア攻撃に関連付けられており、悪意のある可能性があるかどうかを認識します。 この組み込みポリシーは既定では無効になっています。 すべてのファイルがスキャンされるわけではありませんが、ヒューリスティックを使用して、潜在的に危険なファイルが検索されます。 ファイルが検出されたら、**[感染したファイル]** のリストを表示することができます。 ファイル ドロワーのマルウェア ファイルの名前をクリックして、マルウェア レポートを開きます。このレポートには、ファイルが感染しているそのマルウェアの種類に関する情報が示されます。

    > [!NOTE]
    > * Office 365 のマルウェア検出の場合は、Office 365 Advanced Threat Protection P1 の有効なライセンスが必要です。
    > * Cloud App Security は、次のアプリのマルウェア検出をサポートしています。
    >   * ボックス
    >   * Dropbox
    >   * G Suite
    >   * Office 365

### <a name="activity-from-anonymous-ip-addresses"></a>匿名の IP アドレスからのアクティビティ

* この検出は、匿名プロキシ IP アドレスとして識別されている IP アドレスからユーザーがアクティブだったことを示します。 これらのプロキシは、デバイスの IP アドレスを非表示にするユーザーによって使用され、悪意のある目的で使用される場合があります。 この検出には、組織内のユーザーに広く使用されている誤ってタグ付けされた IP アドレスなどの "誤検知" を減らす機械学習アルゴリズムが使用されています。

### <a name="ransomware-activity"></a>ランサムウェアのアクティビティ

* Cloud App Security のランサムウェア検出機能が異常検出によって強化され、高度なランサムウェア攻撃に対していっそう包括的なカバレッジが保証されるようになりました。 セキュリティ研究の専門知識を活用して、ランサムウェアのアクティビティを反映する行動パターンを識別することにより、Cloud App Security では包括的で堅牢な保護が実現されます。 たとえば、Cloud App Security によってファイル アップロードまたはファイル削除のアクティビティが高い確率で識別される場合、それは暗号化プロセスを表している可能性があります。 このデータは、接続された API から受け取ってログに収集され、その後、学習した行動パターンおよび脅威インテリジェンス (既知のランサムウェアの拡張子など) と組み合わされます。 Cloud App Security がランサムウェアを検出する方法について詳しくは、「[ランサムウェアから組織を保護する](use-case-ransomware.md)」をご覧ください。

### <a name="activity-performed-by-terminated-user"></a>終了させられたユーザーによって実行されたアクティビティ

* この検出では、解雇された従業員が SaaS アプリ上でアクションを実行し続けるときに識別できます。 内部からの脅威で最大のリスクは円満退職しなかった従業員から生じることがデータから明らかであるため、解雇された従業員のアカウントでのアクティビティに注目することが重要です。 従業員が会社を辞めるとき、そのアカウントが企業アプリからプロビジョニング解除されることもありますが、多くのケースでは、特定の企業リソースへのアクセスを維持しています。 特権アカウントを考慮するとき重要性がさらに増します。かつての管理者が引き起こす可能性がある潜在的な損害はその性質上大きくなるためです。
この検出は、複数のアプリに対するユーザーの行動を監視する Cloud App Security の機能を利用しています。この機能によって、ユーザーの通常のアクティビティ、アカウントが終了させられているという事実、および他のアプリ上での実際のアクティビティを識別できます。 たとえば、Azure AD アカウントを退職した従業員は、依然として企業の AWS インフラストラクチャにアクセスできますが、大規模な損害をもたらす可能性があります。

検出では、Azure AD 内ではアカウントを終了させられているが、AWS や Salesforce などの他のプラットフォーム内では引き続きアクティビティを実行しているユーザーを検索します。 これには、もう 1 つのアカウント (ユーザーの主要なシングル サインオン アカウントではない) を使用してリソースを管理しているユーザーが、特に該当します。これらのアカウントは多くの場合、ユーザーが会社を辞したときに終了されないためです。

### <a name="activity-from-suspicious-ip-addresses"></a>不審な IP アドレスからのアクティビティ

* この検出では、Microsoft 脅威インテリジェンスによってリスクがあると判断された IP アドレスからユーザーがアクティブであったことが識別されます。 これらの IP アドレスは、ボットネット C & C などの悪意のあるアクティビティに関係しており、危険な状態のアカウントである可能性があります。 この検出には、組織内のユーザーに広く使用されている誤ってタグ付けされた IP アドレスなどの "誤検知" を減らす機械学習アルゴリズムが使用されています。

### <a name="suspicious-inbox-forwarding"></a>受信トレイからの疑わしい転送

* この検出では疑わしい電子メール転送ルールが検索されます。たとえば、すべての電子メールのコピーを外部アドレスに転送する受信トレイのルールをユーザーが作成した場合などです。

> [!NOTE]
> Cloud App Security では、ユーザーの一般的な動作に基づき、疑わしいものとして識別される各転送ルールについてのみアラートが表示されます。

### <a name="suspicious-inbox-manipulation-rules"></a>受信トレイに対する疑わしい操作ルール

* ユーザーの受信トレイでメッセージまたはフォルダーを削除または移動する疑わしいルールが設定されている場合、この検出によって環境がプロファイルされ、アラートがトリガーされます。 これは、ユーザーのアカウントが侵害されていること、メッセージが意図的に隠ぺいされていること、および組織内でスパムやマルウェアを配信するためにメールボックスが使用されていることを示している可能性があります。

### <a name="suspicious-email-deletion-activity-preview"></a>疑わしいメール削除アクティビティ (プレビュー)

* このポリシーは、ユーザーが1つのセッションで疑わしい電子メール削除アクティビティを実行したときに、環境をプロファイルし、アラートをトリガーします。 このポリシーは、ユーザーのメールボックスが、電子メールでのコマンドと制御通信 (C&C/C2) などの潜在的な攻撃ベクトルによって侵害される可能性があることを示している可能性があります。

### <a name="unusual-activities-by-user"></a>異常なアクティビティ (ユーザーによる)

これらの検出では、以下を行うユーザーを識別します。

* 複数回にわたる異常なファイル ダウンロード アクティビティ
* 異常なファイル共有アクティビティ
* 異常なファイル削除アクティビティ
* 異常な偽装されたアクティビティ
* 異常な管理アクティビティ
* 通常とは異なる Power BI レポート共有アクティビティ (プレビュー)
* 通常とは異なる複数の VM 作成アクティビティ (プレビュー)
* 通常とは異なる複数のストレージ削除アクティビティ (プレビュー)
* クラウドリソースの通常とは異なるリージョン (プレビュー)

これらのポリシーでは、学習したベースラインを基に 1 セッション内の複数のアクティビティを探します。このようなアクティビティは侵害行為が行われたことを示している可能性があります。 これらの検出では、ユーザーのログオン パターンをプロファイルして誤検出を減らす機械学習アルゴリズムが使用されています。 これらの検出は、環境のプロファイルを作成し、組織のアクティビティで学習したベースラインに対してアラートをトリガーするヒューリスティック異常検出エンジンの一部です。

### <a name="multiple-failed-login-attempts"></a>複数回失敗したログイン試行

* この検出は、1 つのセッションで複数回ログインを試行して失敗した、学習したベースラインからセキュリティ違反を試みている可能性のあるユーザーを識別します。

### <a name="data-exfiltration-to-unsanctioned-apps"></a>承認されていないアプリへのデータ抜き取り

* ユーザーまたは IP アドレスによって、組織からの情報流出の試みの可能性があるアクティビティを実行することを承認されていないアプリが使用されると、このポリシーが自動的に有効になり、アラートが表示されます。

### <a name="multiple-delete-vm-activities"></a>複数の VM 削除アクティビティ

* このポリシーでは使用環境をプロファイルし、ユーザーが単一セッションで複数の VM を削除したときに、組織のベースラインを基にアラートをトリガーします。 これは、侵害の試行を示している可能性があります。

## <a name="enable-automated-governance"></a>自動ガバナンスを有効にする<a name="adp-automated-gov"></a>

異常検出ポリシーによって生成されるアラートに対する自動修復アクションを有効にすることができます。

1. **[ポリシー]** ページで検出ポリシーの名前をクリックします。
1. **[異常検出ポリシーの編集]** ウィンドウが開いたら、**[ガバナンス]** で接続されている各アプリまたはすべてのアプリの修復アクションを設定します。
1. **[更新]** をクリックします。

## <a name="tune-anomaly-detection-policies"></a>異常検出ポリシーを調整する

異常検出エンジンを調整するには、次の方法でユーザー設定に応じてアラートを抑制または表示します。

* あり得ない移動ポリシーでは、感度スライダーを設定して、アラートがトリガーされるために必要な異常な動作のレベルを決定できます。 たとえば、[低] に設定すると、ユーザーの一般的な場所からの不可能な移動アラートが抑制されます。 [高] に設定すると、このようなアラートが表示されます。 次の感度レベルから選択できます。

  * **低**: システム、テナント、およびユーザーの抑制
  * **中**: システムとユーザーの抑制
  * **高**: システム抑制のみ

    この場合、

    | 抑制の種類 | [説明] |
    | --- | --- |
    | **システム** | 常に抑制される組み込みの検出。 |
    | **テナント** | テナント内の以前のアクティビティに基づく一般的なアクティビティ。 たとえば、組織内で以前にアラートが通知された ISP からのアクティビティを抑制します。 |
    | **ユーザー** | 特定のユーザーの以前のアクティビティに基づく一般的なアクティビティ。 たとえば、ユーザーがよく使用する場所からのアクティビティを抑制します。 |

* また、頻度の低い国、匿名 IP アドレス、疑わしい IP アドレス、およびあり得ない移動からのアクティビティに対するアラートで、失敗と成功両方のログインを分析するか、成功したログインだけを分析するかを、構成することもできます。

> [!NOTE]
> 既定では、多要素認証 (WS-TRUST など) を使用しない従来のサインインプロトコルは、不可能な移動ポリシーでは監視されません。 組織でレガシプロトコルを使用していて、関連するアクティビティが見つからないようにするには、ポリシーを編集し、[**詳細構成**] で [**サインインアクティビティ**を**すべてのサインイン**に分析する] を設定します。

## <a name="scope-anomaly-detection-policies"></a>異常検出ポリシーのスコープ指定

ポリシーに含めたり除外したりするユーザーおよびグループのみに適用するように、各異常検出ポリシーには独立してスコープを指定できます。
たとえば、頻度の低い地域の検出から、頻繁に移動する特定のユーザーを無視するように、アクティビティを設定できます。

異常検出ポリシーのスコープを指定するには、次の手順に従います。

1. [**制御**  >  **ポリシー**] をクリックし、**種類**フィルターを**異常検出ポリシー**に設定します。
1. スコープを指定するポリシーをクリックします。
1. **[スコープ]** で、既定の設定である **[All users and groups]\(すべてのユーザーとグループ)** から **[Specific users and groups]\(特定のユーザーとグループ)** にドロップダウンを変更します。
1. **[含める]** を選択して、このポリシーを適用するユーザーおよびグループを指定します。 ここで選択されなかったユーザーまたはグループはすべて、脅威とは見なされず、アラートは生成されません。
1. **[含まない]** を選択して、このポリシーを適用しないユーザーを指定します。 ここで選択されたユーザーはすべて、**[含める]** で選択したグループのメンバーであっても、脅威とは見なされず、アラートは生成されません。

    ![異常検出のスコープ指定](media/anomaly-detection-scoping.png)

## <a name="triage-anomaly-detection-alerts"></a>異常検出アラートのトリアージ

新しい異常検出ポリシーによってトリガーされたさまざまなアラートを即座にトリアージし、最初に処理すべきアラートはどれかを決定できます。 これを行うにはアラートのコンテキストが必要になるため、ユーザーは全体像を確認し、実際に悪意のある操作が行われているかどうかを把握できます。

1. **[アクティビティ ログ]** で、アクティビティ ドロワーを表示するアクティビティを開くことができます。 [**ユーザー** ] をクリックして、[ユーザーの洞察] タブを表示します。このタブには、アラートの数、アクティビティ、接続した場所などの情報が表示されます。これは調査において重要です。

    ![異常検出アラート 1 ](media/anomaly-alert-user1.png) ![ 異常検出アラート1](media/anomaly-alert-user2.png)

1. これにより、ユーザーが実行した不審なアクティビティはどれかを把握し、アカウントが侵害されたかどうかについて確信を深めることができます。 たとえば、複数回失敗したログインに関するアラートは疑わしいもので、ブルート フォース攻撃の可能性を示すこともありますが、アプリケーションの不適切な構成を示すこともあり、この場合アラートは正しい反応の真陽性となります。 ただし、さらに不審なアクティビティを伴う複数回失敗したログイン アラートがある場合には、アカウントが侵害されている確率は高くなります。 次の例では、**[複数回失敗したログイン試行]** アラートの後、**[TOR の IP アドレスからのアクティビティ]** と **[あり得ない移動アクティビティ]** (どちらもそれ自体が大きな侵害の痕跡 (IOC)) が続いています。 そうでない場合は、同じユーザーが**大量ダウンロードアクティビティ**を実行したことがわかります。これは、多くの場合、攻撃者がデータの使用を実行したことを示しています。

    ![異常検出アラート 1](media/anomaly-alert-user3.png)

1. マルウェアに感染したファイルの場合、ファイルの検出後に、**[感染したファイル]** のリストを表示することができます。 ファイル ドロワーのマルウェア ファイルの名前をクリックして、マルウェア レポートを開きます。このレポートには、ファイルが感染しているそのマルウェアの種類に関する情報が示されます。

## <a name="next-steps"></a>次の手順

> [!div class="nextstepaction"]
> [クラウド環境を保護するための日常的な作業](daily-activities-to-protect-your-cloud-environment.md)

[!INCLUDE [Open support ticket](includes/support.md)]
