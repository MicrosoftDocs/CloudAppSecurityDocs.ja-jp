---
title: Cloud App Security での異常検出ポリシーの作成
description: この記事では、異常検出ポリシーについて説明し、異常検出ポリシーの構成要素に関するリファレンス情報を提供します。
keywords: ''
author: shsagir
ms.author: shsagir
manager: shsagir
ms.date: 02/04/2020
ms.topic: conceptual
ms.collection: M365-security-compliance
ms.prod: ''
ms.service: cloud-app-security
ms.technology: ''
ms.reviewer: reutam
ms.suite: ems
ms.custom: seodec18
ms.openlocfilehash: d2dce554b959c14ba32c92f27579d5525069b1f3
ms.sourcegitcommit: 9fe879ce7f07933866191724de5f108f43e3f923
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/24/2020
ms.locfileid: "77566856"
---
# <a name="get-instantaneous-behavioral-analytics-and-anomaly-detection"></a>瞬間的な行動分析と異常検出を取得する

*適用対象: Microsoft Cloud App Security*

Microsoft Cloud App Security の異常検出ポリシーでは、すぐに使用できるユーザーおよびエンティティ行動分析 (UEBA) と機械学習 (ML) が提供されるため、クラウド環境全体で高度な脅威検出をすぐに実行できます。 新しい異常検出ポリシーは自動的に有効になるため、新しい異常検出ポリシーは即座に検出を行い、ユーザー全体、およびネットワークに接続されているコンピューターとデバイスのさまざまな動作の異常を対象とします。  さらに、この新しいポリシーでは、調査プロセスを高速化し、進行中の脅威を含むことができるように、Cloud App Security 検出エンジンからより多くのデータを公開します。

異常検出ポリシーは自動的に有効になりますが、Cloud App Security には7日間の初期学習期間があり、これはすべての異常検出アラートが発生するわけではありません。 その後、各セッションは、ユーザーがアクティブだったとき、IP アドレス、デバイスなど、過去1か月間に検出されたアクティビティ、およびこれらのアクティビティのリスクスコアと比較されます。  これらの検出は、環境のプロファイルを作成し、組織のアクティビティで学習したベースラインに対してアラートをトリガーするヒューリスティック異常検出エンジンの一部です。 また、これらの検出では、ユーザーをプロファイルし、偽陽性を減らすためにサインインパターンを使用するように設計された機械学習アルゴリズムも使用します。

異常は、ユーザーアクティビティをスキャンすることによって検出されます。 リスクを評価するには、次のように、リスク要因にグループ化された30種類のリスクインジケーターを検討します。

* 危険な IP アドレス
* ログインエラー
* 管理者アクティビティ
* 非アクティブなアカウント
* 場所
* 不可能な移動
* デバイスとユーザーエージェント
* 活動率

ポリシーの結果に基づいて、セキュリティアラートがトリガーされます。 Cloud App Security は、クラウド上のすべてのユーザーセッションを確認し、組織のベースラインまたはユーザーの通常のアクティビティとは異なる状況が発生したときに警告を出します。

ネイティブ Cloud App Security アラートに加えて、Azure Active Directory (AD) Identity Protection から受信した情報に基づいて、次の検出アラートも取得します。

* 漏洩した資格情報: ユーザーの有効な資格情報が漏洩したときにトリガーされます。 詳細については、「 [Azure AD の漏洩した資格情報の検出](/azure/active-directory/identity-protection/concept-identity-protection-risks#user-risk)」を参照してください。
* リスクの高いサインイン: 複数の Azure AD Identity Protection サインイン検出を1つの検出に結合します (既定では無効)。 詳細については、「 [Azure AD のサインインリスクの検出](/azure/active-directory/identity-protection/concept-identity-protection-risks#sign-in-risk)」を参照してください。

これらのポリシーは [Cloud App Security ポリシー] ページに表示され、有効または無効にすることができますが、編集することはできません。

## <a name="anomaly-detection-policies"></a>異常検出ポリシー

**[制御]** 、 **[ポリシー]** の順にクリックすると、異常検出ポリシーがポータルで表示されます。 ポリシーの種類の**異常検出ポリシー**を選択します。

 ![新しい異常検出ポリシー](media/new-anomaly-detection-policies.png)

次の異常検出ポリシーを使用できます。

### <a name="impossible-travel"></a>不可能な移動

* この検出は、ユーザーが最初の場所から2番目の場所に移動するまでにかかる時間よりも短い期間内に地理的に離れた場所から送信された2つのユーザーアクティビティ (1 つまたは複数のセッション) を識別します。別のユーザーが同じ資格情報を使用している。 この検出では、組織内の他のユーザーが定期的に使用している Vpn や場所など、不可能な移動状態に寄与する明らかな "誤検知" を無視する機械学習アルゴリズムを使用します。 検出には、7日間の初期学習期間があり、その間に新しいユーザーのアクティビティパターンが学習されます。 不可能な移動検出では、2つの場所の間で通常とは異なるユーザーアクティビティが識別されます。 このアクティビティは、脅威が侵害されたことを示す指標として扱われるように、異常な状態である必要があります。 この機能を実現するために、検出ロジックには、VPN アクティビティなどの偽陽性をトリガーするシナリオに対処するためのさまざまなレベルの抑制が含まれています。 [感度] スライダーを使用すると、アルゴリズムに影響を与え、検出ロジックがどれだけ厳密になるかを定義できます。 感度レベルが高いほど、検出ロジックの一部として適用される抑制が低くなります。 このようにして、カバレッジニーズと SNR ターゲットに応じて検出を調整できます。

    > [!NOTE]
    > 旅行の両方の側の IP アドレスが[企業としてタグ付け](ip-tags.md)されている場合、出張は信頼されていると見なされ、不可能な移動検出のトリガーから除外されます。 ただし、旅行の1つの側の IP アドレスだけが企業としてタグ付けされている場合は、検出が通常どおりにトリガーされます。

### <a name="activity-from-infrequent-country"></a>頻度の低い国からのアクティビティ

* この検出では、過去のアクティビティの場所を考慮して、新しい場所と頻度の低い場所を特定します。 異常検出エンジンは、組織内のユーザーによって使用されていた以前の場所に関する情報を格納します。 組織内のユーザーが最近アクセスしたことがない場所からアクティビティが発生した場合に、アラートがトリガーされます。

### <a name="malware-detection"></a>[マルウェア検出]

* この検出では、クラウドストレージ内の悪意のあるファイルが、Microsoft アプリとサードパーティ製アプリのどちらであるかを識別します。 Microsoft Cloud App Security は、Microsoft の脅威インテリジェンスを使用して、特定のファイルが既知のマルウェア攻撃に関連付けられているかどうかを認識し、悪意を持つ可能性があります。 この組み込みポリシーは、既定では無効になっています。 すべてのファイルがスキャンされるわけではありませんが、ヒューリスティックは、危険である可能性のあるファイルを探すために使用されます。 ファイルが検出されると、感染した**ファイル**の一覧が表示されます。 ファイルドロワーでマルウェアのファイル名をクリックして、マルウェアレポートを開きます。このレポートには、ファイルが感染しているマルウェアの種類に関する情報が表示されます。

    > [!NOTE]
    > * Office 365 のマルウェア検出の場合は、Office 365 Advanced Threat Protection P1 の有効なライセンスが必要です。
    > * Cloud App Security は、次のアプリのマルウェア検出をサポートしています。
    >   * Box
    >   * ドロップボックス
    >   * G Suite
    >   * Office 365

### <a name="activity-from-anonymous-ip-addresses"></a>匿名 IP アドレスからのアクティビティ

* この検出は、匿名プロキシ IP アドレスとして識別された IP アドレスからユーザーがアクティブであったことを識別します。 これらのプロキシは、デバイスの IP アドレスを非表示にするユーザーによって使用され、悪意のある目的で使用される場合があります。 この検出では、組織内のユーザーが広く使用しているタグ付けされていない IP アドレスなど、"誤検知" を減らす機械学習アルゴリズムを使用します。

### <a name="ransomware-activity"></a>ランサムウェアアクティビティ

* Cloud App Security、異常検出を使用してランサムウェア検出機能を拡張し、高度なランサムウェア攻撃に対する包括的なカバレッジを保証します。 セキュリティ研究の専門知識を活用して、ランサムウェアのアクティビティを反映する行動パターンを特定することにより、Cloud App Security は包括的で堅牢な保護を実現します。 たとえば、ファイルのアップロードやファイルの削除の処理率が高いことが Cloud App Security によって特定された場合は、悪影響を及ぼす可能性のある暗号化プロセスを表している可能性があります。 このデータは、接続されている Api から受信したログに収集され、学習した動作パターンと脅威インテリジェンス (既知のランサムウェア拡張機能など) と組み合わされます。 Cloud App Security がランサムウェアを検出する方法の詳細については、「[ランサムウェアから組織を保護](use-case-ransomware.md)する」を参照してください。

### <a name="activity-performed-by-terminated-user"></a>終了したユーザーによって実行されるアクティビティ

* この検出により、退職した従業員が SaaS アプリに対するアクションの実行を継続するタイミングを特定できます。 データは、内部的な脅威のリスクが、退職した従業員からのものであることを示しているため、退職した従業員からのアカウントのアクティビティを監視することが重要です。 従業員が退職したときに、会社のアプリからそれらのアカウントがプロビジョニング解除されることもありますが、多くの場合、特定の企業リソースへのアクセスが維持されます。 これは、特権アカウントを考慮する場合にさらに重要です。これは、従来の管理者が行う可能性のある損害が本質的に大きくなるためです。
この検出では、アプリ間のユーザーの動作を監視するための Cloud App Security の機能を活用します。これにより、ユーザーの通常のアクティビティ、アカウントが終了したこと、および他のアプリでの実際のアクティビティを識別できます。 たとえば、Azure AD アカウントを退職した従業員は、依然として企業の AWS インフラストラクチャにアクセスできますが、大規模な損害をもたらす可能性があります。

この検出は、Azure AD で終了したアカウントを持つユーザーを検索しますが、その他のプラットフォーム (AWS や Salesforce など) でもアクティビティを実行します。 これは、リソースを管理するために (プライマリシングルサインオンアカウントではなく) 別のアカウントを使用するユーザーに特に関連します。これは、ユーザーが退職したときに、これらのアカウントが終了しないことが多いためです。

### <a name="activity-from-suspicious-ip-addresses"></a>疑わしい IP アドレスからのアクティビティ

* この検出は、Microsoft 脅威インテリジェンスによって危険であると識別された IP アドレスからユーザーがアクティブであったことを識別します。 これらの IP アドレスは、ボットネット C & C などの悪意のあるアクティビティに関係し、侵害されたアカウントを示す可能性があります。 この検出では、組織内のユーザーが広く使用しているタグ付けされていない IP アドレスなど、"誤検知" を減らす機械学習アルゴリズムを使用します。

### <a name="suspicious-inbox-forwarding"></a>疑わしい受信トレイの転送

* この検出は、すべての電子メールのコピーを外部アドレスに転送する受信トレイの規則をユーザーが作成した場合など、疑わしい電子メール転送ルールを検索します。

> [!NOTE]
> Cloud App Security は、ユーザーの一般的な動作に基づいて、疑わしいと識別される各転送ルールについてのみアラートを生成します。

### <a name="suspicious-inbox-manipulation-rules"></a>疑わしい受信トレイの操作規則

* この検出は、ユーザーの受信トレイにメッセージやフォルダーを削除または移動する疑わしい規則が設定されている場合に、環境をプロファイルし、警告をトリガーします。 これは、ユーザーのアカウントが侵害されたこと、メッセージが意図的に非表示になっていること、およびメールボックスが組織内のスパムやマルウェアの配布に使用されていることを示している可能性があります。

### <a name="suspicious-email-deletion-activity-preview"></a>疑わしい電子メール削除アクティビティ (プレビュー)

* このポリシーは、ユーザーが1つのセッションで疑わしい電子メール削除アクティビティを実行したときに、環境をプロファイルし、アラートをトリガーします。 このポリシーは、ユーザーのメールボックスが、電子メールでのコマンドと制御通信 (C & C/C2) などの潜在的な攻撃ベクトルによって侵害される可能性があることを示している可能性があります。

### <a name="unusual-activities-by-user"></a>通常とは異なるアクティビティ (ユーザーによる)

これらの検出は、以下を実行するユーザーを識別します。

* 通常とは異なる複数ファイルのダウンロードアクティビティ
* 通常とは異なるファイル共有アクティビティ
* 異常なファイル削除アクティビティ
* 異常な偽装アクティビティ
* 通常とは異なる管理アクティビティ
* 通常とは異なる Power BI レポート共有アクティビティ (プレビュー)
* 通常とは異なる複数の VM 作成アクティビティ (プレビュー)
* 通常とは異なる複数のストレージ削除アクティビティ (プレビュー)

これらのポリシーは、学習したベースラインに対して1つのセッション内のアクティビティを検索します。これは、侵害の試行を示している可能性があります。 これらの検出は、ユーザーのログオンパターンをプロファイルし、誤検知を減らす機械学習アルゴリズムを利用します。 これらの検出は、環境のプロファイルを作成し、組織のアクティビティで学習したベースラインに対してアラートをトリガーするヒューリスティック異常検出エンジンの一部です。

### <a name="multiple-failed-login-attempts"></a>ログイン試行が複数回失敗しました

* この検出は、学習したベースラインに対して、1つのセッションで複数のログイン試行が失敗したユーザーを識別します。これは、侵害の試行を示している可能性があります。

### <a name="data-exfiltration-to-unsanctioned-apps"></a>承認されるアプリに対するデータの除外

* このポリシーは自動的に有効になり、ユーザーまたは IP アドレスが、組織の情報の抜き取るを試行するために承認されていないアプリを使用した場合にアラートを通知します。

### <a name="multiple-delete-vm-activities"></a>複数の VM の削除活動

* このポリシーは、ユーザーが組織内のベースラインを基準として1つのセッションで複数の Vm を削除した場合に、環境をプロファイルし、アラートをトリガーします。 これは、侵害の試行を示している可能性があります。

## 自動ガバナンスを有効にする<a name="adp-automated-gov"></a>

異常検出ポリシーによって生成されたアラートに対して自動修復アクションを有効にすることができます。

1. **[ポリシー]** ページで、検出ポリシーの名前をクリックします。
1. **[異常検出ポリシーの編集]** ウィンドウが開いたら、 **[ガバナンス]** の下で、接続されている各アプリまたはすべてのアプリに対して必要な修復アクションを設定します。
1. **[Update]** をクリックします。

## <a name="tune-anomaly-detection-policies"></a>異常検出ポリシーを調整する

設定に応じてアラートを抑制または表示する異常検出エンジンに影響を与える場合:

* 不可能な移動ポリシーでは、感度スライダーを設定して、アラートがトリガーされるまでに必要となる異常な動作のレベルを決定できます。 たとえば、[低] に設定すると、ユーザーの一般的な場所からの不可能な移動アラートが抑制されます。 [高] に設定すると、このようなアラートが表示されます。 次の秘密度レベルから選択できます。

  * **低**: システム、テナント、およびユーザーの抑制
  * **中**: システムとユーザーの抑制
  * **High**: システム抑制のみ

    この場合、

    | 抑制の種類 | 説明 |
    | --- | --- |
    | **システム** | 常に抑制される組み込みの検出。 |
    | **テナント** | テナント内の以前のアクティビティに基づく一般的なアクティビティ。 たとえば、組織内で以前にアラートが発生していたアクティビティを非表示にすることができます。 |
    | **ユーザー** | 特定のユーザーの以前のアクティビティに基づく一般的なアクティビティ。 たとえば、ユーザーがよく使用する場所からアクティビティを抑制するとします。 |

* また、頻度の低い国、匿名 IP アドレス、疑わしい IP アドレス、および不可能な移動の両方のアラートを分析して、失敗したログインと成功したログインの両方を分析するか、ログインを成功させるかを構成することもできます。

> [!NOTE]
> 既定では、多要素認証 (WS-TRUST など) を使用しない従来のサインインプロトコルは、不可能な移動ポリシーでは監視されません。 組織でレガシプロトコルを使用していて、関連するアクティビティが見つからないようにするには、ポリシーを編集し、 **[詳細構成]** で [**サインインアクティビティ**を**すべてのサインイン**に分析する] を設定します。

## <a name="scope-anomaly-detection-policies"></a>異常検出ポリシーのスコープを限定する

各異常検出ポリシーは、ポリシーに含めるユーザーとグループにのみ適用されるように、個別にスコープを設定することができます。
たとえば、頻度の低い郡の検出から、頻繁に移動する特定のユーザーを無視するように活動を設定できます。

異常検出ポリシーのスコープを次のようにします。

1. [**制御** > **ポリシー**] をクリックし、**種類**フィルターを**異常検出ポリシー**に設定します。
1. スコープを指定するポリシーをクリックします。
1. **[スコープ]** で、 **[すべてのユーザーとグループ]** の既定の設定から **[特定のユーザーとグループ]** にドロップダウンを変更します。
1. このポリシーを適用するユーザーとグループを指定するには、 **[含める]** を選択します。 ここで選択されていないユーザーまたはグループは、脅威とは見なされず、アラートも生成されません。
1. このポリシーが適用されないユーザーを指定するには、 **[除外]** を選択します。 ここで選択したユーザーは脅威とは見なされず、 **[含める]** で選択したグループのメンバーであってもアラートは生成されません。

    ![異常検出のスコープ](media/anomaly-detection-scoping.png)

## <a name="triage-anomaly-detection-alerts"></a>異常検出アラートのトリアージ

新しい異常検出ポリシーによってトリガーされるさまざまなアラートを迅速にトリアージし、最初に対処する必要があるアラートを決定することができます。 これを行うには、アラートのコンテキストが必要であるため、より大きな画像を表示し、悪意のあるものが実際に発生しているかどうかを把握することができます。

1. アクティビティ**ログ**では、アクティビティを開いてアクティビティドロワーを表示できます。 **[ユーザー]** をクリックして、[ユーザーの洞察] タブを表示します。このタブには、アラートの数、アクティビティ、接続した場所などの情報が表示されます。これは調査において重要です。

    ![異常検出アラート 1](media/anomaly-alert-user1.png) ![異常検出アラート 1](media/anomaly-alert-user2.png)

1. これにより、ユーザーが実行した疑わしいアクティビティを把握し、アカウントが侵害されたかどうかについての信頼度を高めることができます。 たとえば、複数の失敗したログインに対するアラートは、疑わしい可能性があり、ブルートフォース攻撃の可能性を示す可能性がありますが、アプリケーションの構成の誤りである可能性があり、アラートが問題のない真陽性になることもあります。 ただし、追加の疑わしいアクティビティを含む複数の失敗したログインの警告が表示された場合は、アカウントが侵害される確率が高くなります。 次の例では、**複数回失敗したログイン試行**アラートの後に、 **TOR IP アドレスからのアクティビティ**、および**不可能な移動アクティビティ**が続くことがわかります。 そうでない場合は、同じユーザーが**大量ダウンロードアクティビティ**を実行したことがわかります。これは、多くの場合、攻撃者がデータの使用を実行したことを示しています。

    ![異常検出アラート1](media/anomaly-alert-user3.png)

1. マルウェアに感染したファイルの場合、ファイルが検出されると、**感染**したファイルの一覧が表示されます。 ファイルドロワーでマルウェアのファイル名をクリックして、マルウェアレポートを開きます。このレポートには、ファイルが感染しているマルウェアの種類に関する情報が表示されます。

## <a name="next-steps"></a>次のステップ:

> [!div class="nextstepaction"]
> [クラウド環境を保護するための日常的な作業](daily-activities-to-protect-your-cloud-environment.md)

[!INCLUDE [Open support ticket](includes/support.md)]
